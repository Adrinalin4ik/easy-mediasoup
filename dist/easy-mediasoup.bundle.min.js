!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.EasyMediasoup=e()}}(function(){var e;return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[a]={exports:{}};t[a][0].call(d.exports,function(e){var r=t[a][1][e];return o(r||e)},d,d.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=n(o),a=e("babel-runtime/helpers/createClass"),s=n(a),c=e("debug"),u=n(c),d="mediasoup",l=function(){function e(t){(0,i.default)(this,e),t?(this._debug=(0,u.default)(d+":"+t),this._warn=(0,u.default)(d+":WARN:"+t),this._error=(0,u.default)(d+":ERROR:"+t)):(this._debug=(0,u.default)(d),this._warn=(0,u.default)(d+":WARN"),this._error=(0,u.default)(d+":ERROR")),this._debug.enabled=!0}return(0,s.default)(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}();r.default=l},{"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,debug:135}],2:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("babel-runtime/core-js/get-iterator"),a=o(i),s=e("babel-runtime/helpers/extends"),c=o(s),u=e("babel-runtime/core-js/array/from"),d=o(u),l=e("babel-runtime/core-js/promise"),p=o(l),f=e("babel-runtime/core-js/map"),h=o(f),m=e("babel-runtime/helpers/classCallCheck"),v=o(m),y=e("babel-runtime/helpers/createClass"),_=o(y),g=e("socket.io-client"),b=o(g),w=e("mediasoup-client"),k=n(w),P=e("./Logger"),S=o(P),E=e("./urlFactory"),x=e("./redux/requestActions"),T=n(x),R=e("./redux/stateActions"),C=n(R),O=new S.default("RoomClient"),j={requestTimeout:1e4,transportOptions:{tcp:!1}},A={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}}},I={low:1e5,medium:3e5,high:15e5},D=[],M=[],N=function(){function e(t){var r=t.media_server_wss,n=t.roomId,o=t.peerName,i=t.displayName,a=t.device,s=t.useSimulcast,c=t.produce,u=t.dispatch,d=t.getState,l=t.turnservers,p=t.args;(0,v.default)(this,e),O.debug('constructor() [roomId:"%s", peerName:"%s", displayName:"%s", device:%s]',n,o,i,a.flag);var f=(0,E.getProtooUrl)(r,o,n);this.connection=b.default.connect(f,{reconnect:!0}),this.wss=this.connection,D=0!=p.video_constrains.length?p.video_constrains:A,M=0!=p.simulcast_options.length?p.simulcast_options:I,this.initially_muted=p.initially_muted,this.is_audio_initialized=!1,this._is_webcam_enabled=!0,this._is_audio_enabled=!this.initially_muted,this._closed=!1,this._produce=c,this._useSimulcast=s,this._dispatch=u,this._getState=d,this._peerName=o,j.turnServers=l,this._room=new k.Room(j),this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._webcams=new h.default,this._webcam={device:null,resolution:"hd"},this.wss.on("room-connected",function(){console.log("roomConnected")}),this.wss.on("pong",function(){console.log("pong")}),this._join({displayName:i,device:a}),this.connection.emit("room",n,o)}return(0,_.default)(e,[{key:"close",value:function(){var e=this;this._closed||(this._closed=!0,O.debug("close()"),this._room.producers.forEach(function(e){e.track.stop()}),this._room.leave(),setTimeout(function(){return e.wss.close()},250),this._dispatch(C.setRoomState("closed")))}},{key:"muteMic",value:function(){O.debug("muteMic()"),this._is_audio_enabled=!1,this._micProducer.pause()}},{key:"unmuteMic",value:function(){O.debug("unmuteMic()"),this._is_audio_enabled=!0,this._micProducer?this._micProducer.resume():this._setMicProducer()}},{key:"enableWebcam",value:function(){O.debug("enableWebcam()"),this._is_webcam_enabled=!0,this._activateWebcam()}},{key:"_activateWebcam",value:function(){var e=this;return O.debug("activateWebcam()"),this._dispatch(C.setWebcamInProgress(!0)),p.default.resolve().then(function(){return e._updateWebcams()}).then(function(){return e._setWebcamProducer()}).then(function(){e._dispatch(C.setWebcamInProgress(!1))}).catch(function(t){O.error("activateWebcam() | failed: %o",t),e._dispatch(C.setWebcamInProgress(!1))})}},{key:"disableWebcam",value:function(){O.debug("disableWebcam()"),this._is_webcam_enabled=!1,this._deactivateWebcam()}},{key:"_deactivateWebcam",value:function(){var e=this;return O.debug("deactivateWebcam()"),this._dispatch(C.setWebcamInProgress(!0)),p.default.resolve().then(function(){e._webcamProducer.close(),e._dispatch(C.setWebcamInProgress(!1))}).catch(function(t){O.error("deactivateWebcam() | failed: %o",t),e._dispatch(C.setWebcamInProgress(!1))})}},{key:"changeWebcam",value:function(){var e=this;return O.debug("changeWebcam()"),this._is_webcam_enabled=!0,this._dispatch(C.setWebcamInProgress(!0)),p.default.resolve().then(function(){return e._updateWebcams()}).then(function(){var t=(0,d.default)(e._webcams.keys()),r=t.length,n=e._webcam.device?e._webcam.device.deviceId:void 0,o=t.indexOf(n);o<r-1?o++:o=0,e._webcam.device=e._webcams.get(t[o]),O.debug("changeWebcam() | new selected webcam [device:%o]",e._webcam.device),e._webcam.resolution="hd"}).then(function(){var t=e._webcam,r=t.device,n=t.resolution;if(!r)throw new Error("no webcam devices");return O.debug("changeWebcam() | calling getUserMedia()"),navigator.mediaDevices.getUserMedia((0,c.default)({deviceId:{exact:r.deviceId},audio:!1},D[n],{video:!0}))}).then(function(t){var r=t.getVideoTracks()[0];return e._webcamProducer.replaceTrack(r).then(function(e){return r.stop(),e})}).then(function(t){e._dispatch(C.setProducerTrack(e._webcamProducer.id,t)),e._dispatch(C.setWebcamInProgress(!1))}).catch(function(t){O.error("changeWebcam() failed: %o",t),e._dispatch(C.setWebcamInProgress(!1))})}},{key:"setWebcamResulution",value:function(e){var t=this;O.debug("setWebcamResulution()");var r=void 0,n=void 0;return this._dispatch(C.setWebcamInProgress(!0)),p.default.resolve().then(function(){r=t._webcam.resolution,n=e,t._webcam.resolution=n}).then(function(){var e=t._webcam,r=e.device,n=e.resolution;return O.debug("setWebcamResulution() | calling getUserMedia()"),navigator.mediaDevices.getUserMedia((0,c.default)({deviceId:{exact:r.deviceId},audio:!1},D[n],{video:!0}))}).then(function(e){var r=e.getVideoTracks()[0];return t._webcamProducer.replaceTrack(r).then(function(e){return r.stop(),e})}).then(function(e){t._dispatch(C.setProducerTrack(t._webcamProducer.id,e)),t._dispatch(C.setWebcamInProgress(!1))}).catch(function(e){O.error("changeWebcamResolution() failed: %o",e),t._dispatch(C.setWebcamInProgress(!1)),t._webcam.resolution=r})}},{key:"changeWebcamResolution",value:function(){var e=this;O.debug("changeWebcamResolution()");var t=void 0,r=void 0;return this._dispatch(C.setWebcamInProgress(!0)),p.default.resolve().then(function(){switch(t=e._webcam.resolution){case"qvga":r="vga";break;case"vga":r="hd";break;case"hd":r="qvga"}e._webcam.resolution=r}).then(function(){var t=e._webcam,r=t.device,n=t.resolution;return O.debug("changeWebcamResolution() | calling getUserMedia()"),navigator.mediaDevices.getUserMedia((0,c.default)({deviceId:{exact:r.deviceId},audio:!1},D[n],{video:!0}))}).then(function(t){var r=t.getVideoTracks()[0];return e._webcamProducer.replaceTrack(r).then(function(e){return r.stop(),e})}).then(function(t){e._dispatch(C.setProducerTrack(e._webcamProducer.id,t)),e._dispatch(C.setWebcamInProgress(!1))}).catch(function(r){O.error("changeWebcamResolution() failed: %o",r),e._dispatch(C.setWebcamInProgress(!1)),e._webcam.resolution=t})}},{key:"enableAudioOnly",value:function(){var e=this;return O.debug("enableAudioOnly()"),this._dispatch(C.setAudioOnlyInProgress(!0)),p.default.resolve().then(function(){e._webcamProducer&&e._webcamProducer.close();var t=!0,r=!1,n=void 0;try{for(var o,i=(0,a.default)(e._room.peers);!(t=(o=i.next()).done);t=!0){var s=o.value,c=!0,u=!1,d=void 0;try{for(var l,p=(0,a.default)(s.consumers);!(c=(l=p.next()).done);c=!0){var f=l.value;"video"===f.kind&&f.pause("audio-only-mode")}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}e._dispatch(C.setAudioOnlyState(!0)),e._dispatch(C.setAudioOnlyInProgress(!1))}).catch(function(t){O.error("enableAudioOnly() failed: %o",t),e._dispatch(C.setAudioOnlyInProgress(!1))})}},{key:"disableAudioOnly",value:function(){var e=this;return O.debug("disableAudioOnly()"),this._dispatch(C.setAudioOnlyInProgress(!0)),p.default.resolve().then(function(){if(!e._webcamProducer&&e._room.canSend("video"))return e._activateWebcam()}).then(function(){var t=!0,r=!1,n=void 0;try{for(var o,i=(0,a.default)(e._room.peers);!(t=(o=i.next()).done);t=!0){var s=o.value,c=!0,u=!1,d=void 0;try{for(var l,p=(0,a.default)(s.consumers);!(c=(l=p.next()).done);c=!0){var f=l.value;"video"===f.kind&&f.supported&&f.resume()}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}e._dispatch(C.setAudioOnlyState(!1)),e._dispatch(C.setAudioOnlyInProgress(!1))}).catch(function(t){O.error("disableAudioOnly() failed: %o",t),e._dispatch(C.setAudioOnlyInProgress(!1))})}},{key:"restartIce",value:function(){var e=this;return O.debug("restartIce()"),this._dispatch(C.setRestartIceInProgress(!0)),p.default.resolve().then(function(){e._room.restartIce(),setTimeout(function(){e._dispatch(C.setRestartIceInProgress(!1))},500)}).catch(function(t){O.error("restartIce() failed: %o",t),e._dispatch(C.setRestartIceInProgress(!1))})}},{key:"_join",value:function(e){var t=this,r=e.displayName,n=e.device;this._dispatch(C.setRoomState("connecting")),this.wss.on("open",function(){console.log("fdf"),O.debug('protoo Peer "open" event'),"joined"!=t._room._state&&t._joinRoom({displayName:r,device:n})}),this.wss.on("disconnected",function(){O.warn('protoo Peer "disconnected" event'),t._dispatch(T.notify({type:"error",text:"WebSocket disconnected"})),t._dispatch(C.setRoomState("connecting"))}),this.wss.on("close",function(){t._closed||(O.warn('protoo Peer "close" event'),"joined"!=t._room._state&&t.close())}),this.wss.on("mediasoup-notification",function(e){O.debug("_handleProtooRequest() [method:%s, data:%o]",e.method,e.data),t._room.receiveNotification(notification)}),this.wss.on("request",function(e,r,n){switch(O.debug("_handleProtooRequest() [method:%s, data:%o]",e.method,e.data),e.method){case"mediasoup-notification":r();var o=e.data;t._room.receiveNotification(o);break;case"active-speaker":r();var i=e.data.peerName;t._dispatch(C.setRoomActiveSpeaker(i));break;case"display-name-changed":r();var a=e.data,s=a.peerName,c=a.displayName,u=a.oldDisplayName,d=t._room.getPeerByName(s);if(!d){O.error("peer not found");break}d.appData.displayName=c,t._dispatch(C.setPeerDisplayName(c,s)),t._dispatch(T.notify({text:u+" is now "+c}));break;default:O.error('unknown protoo method "%s"',e.method),n(404,"unknown method")}})}},{key:"_joinRoom",value:function(e){var t=this,r=e.displayName,n=e.device;O.debug("_joinRoom()"),this._room.removeAllListeners(),this._room.on("close",function(e,r){if("remote"===e)return O.warn("mediasoup Peer/Room remotely closed [appData:%o]",r),void t._dispatch(C.setRoomState("closed"))}),this._room.on("request",function(e,r,n){O.debug("sending mediasoup request [method:%s]:%o",e.method,e),t.wss.emit("mediasoup-request",e).then(r).catch(n)}),this._room.on("notify",function(e){O.debug("sending mediasoup notification [method:%s]:%o",e.method,e),t.wss.emit("mediasoup-notification",e).catch(function(e){O.warn("could not send mediasoup notification:%o",e)})}),this._room.on("newpeer",function(e){O.debug('room "newpeer" event [name:"%s", peer:%o]',e.name,e),t._handlePeer(e)}),this._room.join(this._peerName,{displayName:r,device:n}).then(function(){t._sendTransport=t._room.createTransport("send",{media:"SEND_MIC_WEBCAM"}),t._sendTransport.on("close",function(e){O.debug('Transport "close" event [originator:%s]',e)}),t._recvTransport=t._room.createTransport("recv",{media:"RECV"}),t._recvTransport.on("close",function(e){O.debug('receiving Transport "close" event [originator:%s]',e)})}).then(function(){t._dispatch(C.setMediaCapabilities({canSendMic:t._room.canSend("audio"),canSendWebcam:t._room.canSend("video")}))}).then(function(){t._produce&&p.default.resolve().then(function(){t._room.canSend("audio")&&t._setMicProducer()}).then(function(){t._room.canSend("video")&&t._activateWebcam()})}).then(function(){t._dispatch(C.setRoomState("connected")),t._dispatch(C.removeAllNotifications()),t._dispatch(T.notify({text:"You are in the room",timeout:5e3}));var e=t._room.peers,r=!0,n=!1,o=void 0;try{for(var i,s=(0,a.default)(e);!(r=(i=s.next()).done);r=!0){var c=i.value;t._handlePeer(c,{notify:!1})}}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}}).catch(function(e){O.error("_joinRoom() failed:%o",e),t._dispatch(T.notify({type:"error",text:"Could not join the room: "+e.toString()})),t.close()})}},{key:"_setMicProducer",value:function(){var e=this;if(!this._room.canSend("audio"))return p.default.reject(new Error("cannot send audio"));if(this._micProducer)return p.default.reject(new Error("mic Producer already exists"));var t=void 0;return this._micProducer?this._micProducer:p.default.resolve().then(function(){return O.debug("_setMicProducer() | calling getUserMedia()"),navigator.mediaDevices.getUserMedia({audio:!0,video:!1})}).then(function(r){var n=r.getAudioTracks()[0];return t=e._room.createProducer(n,null,{source:"mic"}),e._is_audio_enabled||(t.pause(),e.is_audio_initialized=!0),n.stop(),t.send(e._sendTransport)}).then(function(){e._micProducer=t,e._dispatch(C.addProducer({id:t.id,source:"mic",locallyPaused:t.locallyPaused,remotelyPaused:t.remotelyPaused,track:t.track,codec:t.rtpParameters.codecs[0].name})),t.on("close",function(r){O.debug('mic Producer "close" event [originator:%s]',r),e._micProducer=null,e._dispatch(C.removeProducer(t.id))}),t.on("pause",function(r){O.debug('mic Producer "pause" event [originator:%s]',r),e._dispatch(C.setProducerPaused(t.id,r))}),t.on("resume",function(r){O.debug('mic Producer "resume" event [originator:%s]',r),e._dispatch(C.setProducerResumed(t.id,r))}),t.on("handled",function(){O.debug('mic Producer "handled" event')}),t.on("unhandled",function(){O.debug('mic Producer "unhandled" event')})}).then(function(){O.debug("_setMicProducer() succeeded")}).catch(function(r){throw O.error("_setMicProducer() failed:%o",r),e._dispatch(T.notify({text:"Mic producer failed: "+r.name+":"+r.message})),t&&t.close(),r})}},{key:"_setWebcamProducer",value:function(){var e=this;if(!this._is_webcam_enabled)return 0;if(this._webcamProducer)return p.default.reject(new Error("webcam Producer already exists"));var t=void 0;return this._room._webcamProducer?this._room._webcamProducer:p.default.resolve().then(function(){var t=e._webcam,r=t.device,n=t.resolution;if(!r)throw new Error("no webcam devices");return O.debug("_setWebcamProducer() | calling getUserMedia()"),navigator.mediaDevices.getUserMedia((0,c.default)({deviceId:{exact:r.deviceId},audio:!1},D[n],{video:!0}))}).then(function(r){var n=r.getVideoTracks()[0];return t=e._room.createProducer(n,{simulcast:!!e._useSimulcast&&M},{source:"webcam"}),n.stop(),t.send(e._sendTransport)}).then(function(){e._webcamProducer=t;var r=e._webcam.device;e._dispatch(C.addProducer({id:t.id,source:"webcam",deviceLabel:r.label,type:e._getWebcamType(r),locallyPaused:t.locallyPaused,remotelyPaused:t.remotelyPaused,track:t.track,codec:t.rtpParameters.codecs[0].name})),t.on("close",function(r){O.debug('webcam Producer "close" event [originator:%s]',r),e._webcamProducer=null,e._dispatch(C.removeProducer(t.id))}),t.on("pause",function(r){O.debug('webcam Producer "pause" event [originator:%s]',r),e._dispatch(C.setProducerPaused(t.id,r))}),t.on("resume",function(r){O.debug('webcam Producer "resume" event [originator:%s]',r),e._dispatch(C.setProducerResumed(t.id,r))}),t.on("handled",function(){O.debug('webcam Producer "handled" event')}),t.on("unhandled",function(){O.debug('webcam Producer "unhandled" event')})}).then(function(){O.debug("_setWebcamProducer() succeeded")}).catch(function(r){throw O.error("_setWebcamProducer() failed:%o",r),e._dispatch(T.notify({text:"Webcam producer failed: "+r.name+":"+r.message})),t&&t.close(),r})}},{key:"_updateWebcams",value:function(){var e=this;return O.debug("_updateWebcams()"),this._webcams=new h.default,p.default.resolve().then(function(){return O.debug("_updateWebcams() | calling enumerateDevices()"),navigator.mediaDevices.enumerateDevices()}).then(function(t){var r=!0,n=!1,o=void 0;try{for(var i,s=(0,a.default)(t);!(r=(i=s.next()).done);r=!0){var c=i.value;"videoinput"===c.kind&&e._webcams.set(c.deviceId,c)}}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}}).then(function(){var t=(0,d.default)(e._webcams.values()),r=t.length,n=e._webcam.device?e._webcam.device.deviceId:void 0;O.debug("_updateWebcams() [webcams:%o]",t),0===r?e._webcam.device=null:e._webcams.has(n)||(e._webcam.device=t[0]),e._dispatch(C.setCanChangeWebcam(e._webcams.size>=2))})}},{key:"_getWebcamType",value:function(e){return/(back|rear)/i.test(e.label)?(O.debug("_getWebcamType() | it seems to be a back camera"),"back"):(O.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"_handlePeer",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.notify,o=void 0===n||n,i=e.appData.displayName;this._dispatch(C.addPeer({name:e.name,displayName:i,device:e.appData.device,consumers:[]})),o&&this._dispatch(T.notify({text:i+" joined the room"}));var s=!0,c=!1,u=void 0;try{for(var d,l=(0,a.default)(e.consumers);!(s=(d=l.next()).done);s=!0){var p=d.value;this._handleConsumer(p)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}e.on("close",function(r){O.debug('peer "close" event [name:"%s", originator:%s]',e.name,r),t._dispatch(C.removePeer(e.name)),t._room.joined&&t._dispatch(T.notify({text:e.appData.displayName+" left the room"}))}),e.on("newconsumer",function(r){O.debug('peer "newconsumer" event [name:"%s", id:%s, consumer:%o]',e.name,r.id,r),t._handleConsumer(r)})}},{key:"_handleConsumer",value:function(e){var t=this,r=e.rtpParameters.codecs[0];this._dispatch(C.addConsumer({id:e.id,peerName:e.peer.name,source:e.appData.source,supported:e.supported,locallyPaused:e.locallyPaused,remotelyPaused:e.remotelyPaused,track:null,codec:r?r.name:null},e.peer.name)),e.on("close",function(r){O.debug('consumer "close" event [id:%s, originator:%s, consumer:%o]',e.id,r,e),t._dispatch(C.removeConsumer(e.id,e.peer.name))}),e.on("pause",function(r){O.debug('consumer "pause" event [id:%s, originator:%s, consumer:%o]',e.id,r,e),t._dispatch(C.setConsumerPaused(e.id,r))}),e.on("resume",function(r){O.debug('consumer "resume" event [id:%s, originator:%s, consumer:%o]',e.id,r,e),t._dispatch(C.setConsumerResumed(e.id,r))}),e.on("effectiveprofilechange",function(r){e.setPreferredProfile(r),O.debug('consumer "effectiveprofilechange" event [id:%s, consumer:%o, profile:%s]',e.id,e,r),t._dispatch(C.setConsumerEffectiveProfile(e.id,r))}),e.supported&&("video"===e.kind&&this._getState().me.audioOnly&&e.pause("audio-only-mode"),e.receive(this._recvTransport).then(function(r){t._dispatch(C.setConsumerTrack(e.id,r))}).catch(function(e){O.error("unexpected error while receiving a new Consumer:%o",e)}))}}]),e}();r.default=N},{"./Logger":1,"./redux/requestActions":11,"./redux/stateActions":13,"./urlFactory":14,"babel-runtime/core-js/array/from":18,"babel-runtime/core-js/get-iterator":19,"babel-runtime/core-js/map":20,"babel-runtime/core-js/promise":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/extends":27,"mediasoup-client":187,"socket.io-client":209}],3:[function(e,t,r){(function(t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.Init=void 0;var a=e("babel-runtime/helpers/classCallCheck"),s=i(a),c=e("redux"),u=e("redux-thunk"),d=i(u),l=e("redux-logger"),p=e("mediasoup-client"),f=e("./Logger"),h=i(f),m=e("./utils"),v=(o(m),e("./redux/requestActions")),y=o(v),_=e("./redux/stateActions"),g=o(_),b=e("./redux/reducers"),w=i(b),k=e("./redux/roomClientMiddleware"),P=i(k),S=e("wildemitter"),E=o(S);r.Init=function e(r){var o=this;(0,s.default)(this,e),console.warn("Easy mediasoup v1.1.2"),n.emitter=this.emitter=new E.default,this.roomClientMiddleware=P.default;new h.default;this.emitter.on("joinRoom",function(e){o.client=e});var i=[d.default,P.default];if("development"===t.env.NODE_ENV){var a=(0,l.createLogger)({duration:!0,timestamp:!1,level:"log",logErrors:!0});i.push(a)}var u=this.store=(0,c.createStore)(w.default,void 0,c.applyMiddleware.apply(void 0,i)),f=r.peerName,m=r.roomId,v=r.produce||!0,_=r.displayName,b=r.sipEndpoint||!1,k=r.useSimulcast||!1,S=r.media_server_wss,x=r.turnservers||[],T=[];T.video_constrains=r.video_constrains||[],T.simulcast_options=r.simulcast_options||[],T.initially_muted=r.initially_muted||!1;var R=void 0;_?R=!0:(_="",R=!1);var C=(0,p.getDeviceInfo)();b&&(C.flag="sipendpoint",C.name="SIP Endpoint",C.version=void 0),u.dispatch(g.setMe({peerName:f,displayName:_,displayNameSet:R,device:C})),u.dispatch(y.joinRoom({media_server_wss:S,roomId:m,peerName:f,displayName:_,device:C,useSimulcast:k,produce:v,turnservers:x,args:T}))}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Logger":1,"./redux/reducers":5,"./redux/requestActions":11,"./redux/roomClientMiddleware":12,"./redux/stateActions":13,"./utils":15,_process:193,"babel-runtime/helpers/classCallCheck":24,"mediasoup-client":187,redux:203,"redux-logger":196,"redux-thunk":197,wildemitter:222}],4:[function(e,t,r){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("babel-runtime/helpers/defineProperty"),i=n(o),a=e("babel-runtime/helpers/extends"),s=n(a),c={},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,r=arguments[1];switch(r.type){case"ADD_CONSUMER":var n=r.payload.consumer;return t.emitter.emit("ADD_CONSUMER",r.payload),(0,s.default)({},e,(0,i.default)({},n.id,n));case"REMOVE_CONSUMER":var o=r.payload.consumerId,a=(0,s.default)({},e);return delete a[o],t.emitter.emit("REMOVE_CONSUMER",r.payload),a;case"SET_CONSUMER_PAUSED":var u=r.payload,d=u.consumerId,l=u.originator,p=e[d],f=void 0;return f="local"===l?(0,s.default)({},p,{locallyPaused:!0}):(0,s.default)({},p,{remotelyPaused:!0}),t.emitter.emit("SET_CONSUMER_PAUSED",r.payload),(0,s.default)({},e,(0,i.default)({},d,f));case"SET_CONSUMER_RESUMED":var h=r.payload,m=h.consumerId,v=h.originator,y=e[m],_=void 0;return _="local"===v?(0,s.default)({},y,{locallyPaused:!1}):(0,s.default)({},y,{remotelyPaused:!1}),t.emitter.emit("SET_CONSUMER_RESUMED",r.payload),(0,s.default)({},e,(0,i.default)({},m,_));case"SET_CONSUMER_EFFECTIVE_PROFILE":var g=r.payload,b=g.consumerId,w=g.profile,k=e[b],P=(0,s.default)({},k,{profile:w});return t.emitter.emit("SET_CONSUMER_EFFECTIVE_PROFILE",P),(0,s.default)({},e,(0,i.default)({},b,P));case"SET_CONSUMER_TRACK":var S=r.payload,E=S.consumerId,x=S.track,T=e[E],R=(0,s.default)({},T,{track:x});return t.emitter.emit("SET_CONSUMER_TRACK",R),(0,s.default)({},e,(0,i.default)({},E,R));default:return e}};r.default=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/defineProperty":26,"babel-runtime/helpers/extends":27}],5:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("redux"),i=e("./room"),a=n(i),s=e("./me"),c=n(s),u=e("./producers"),d=n(u),l=e("./peers"),p=n(l),f=e("./consumers"),h=n(f),m=e("./notifications"),v=n(m),y=(0,o.combineReducers)({room:a.default,me:c.default,producers:d.default,peers:p.default,consumers:h.default,notifications:v.default});r.default=y},{"./consumers":4,"./me":6,"./notifications":7,"./peers":8,"./producers":9,"./room":10,redux:203}],6:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("babel-runtime/helpers/extends"),o=function(e){return e&&e.__esModule?e:{default:e}}(n),i={name:null,displayName:null,displayNameSet:!1,device:null,canSendMic:!1,canSendWebcam:!1,canChangeWebcam:!1,webcamInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,restartIceInProgress:!1},a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,r=arguments[1];switch(r.type){case"SET_ME":var n=r.payload,a=n.peerName,s=n.displayName,c=n.displayNameSet,u=n.device;return t.emitter.emit("SET_ME",r.payload),(0,o.default)({},e,{name:a,displayName:s,displayNameSet:c,device:u});case"SET_MEDIA_CAPABILITIES":var d=r.payload,l=d.canSendMic,p=d.canSendWebcam;return(0,o.default)({},e,{canSendMic:l,canSendWebcam:p});case"SET_CAN_CHANGE_WEBCAM":var f=r.payload;return t.emitter.emit("SET_CAN_CHANGE_WEBCAM",r.payload),(0,o.default)({},e,{canChangeWebcam:f});case"SET_WEBCAM_IN_PROGRESS":var h=r.payload.flag;return t.emitter.emit("SET_WEBCAM_IN_PROGRESS",r.payload),(0,o.default)({},e,{webcamInProgress:h});case"SET_DISPLAY_NAME":var m=r.payload.displayName;return m||(m=e.displayName),(0,o.default)({},e,{displayName:m,displayNameSet:!0});case"SET_AUDIO_ONLY_STATE":var v=r.payload.enabled;return(0,o.default)({},e,{audioOnly:v});case"SET_AUDIO_ONLY_IN_PROGRESS":var y=r.payload.flag;return(0,o.default)({},e,{audioOnlyInProgress:y});case"SET_RESTART_ICE_IN_PROGRESS":var _=r.payload.flag;return(0,o.default)({},e,{restartIceInProgress:_});default:return e}};r.default=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/extends":27}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("babel-runtime/helpers/toConsumableArray"),o=function(e){return e&&e.__esModule?e:{default:e}}(n),i=[],a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments[1];switch(t.type){case"ADD_NOTIFICATION":var r=t.payload.notification;return[].concat((0,o.default)(e),[r]);case"REMOVE_NOTIFICATION":var n=t.payload.notificationId;return e.filter(function(e){return e.id!==n});case"REMOVE_ALL_NOTIFICATIONS":return[];default:return e}};r.default=a},{"babel-runtime/helpers/toConsumableArray":28}],8:[function(e,t,r){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("babel-runtime/helpers/toConsumableArray"),i=n(o),a=e("babel-runtime/helpers/defineProperty"),s=n(a),c=e("babel-runtime/helpers/extends"),u=n(c),d={},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,r=arguments[1];switch(r.type){case"ADD_PEER":var n=r.payload.peer;return t.emitter.emit("peerAdded",n),(0,u.default)({},e,(0,s.default)({},n.name,n));case"REMOVE_PEER":var o=r.payload.peerName,a=(0,u.default)({},e);return delete a[o],t.emitter.emit("peerRemoved",o),a;case"SET_PEER_DISPLAY_NAME":var c=r.payload,l=c.displayName,p=c.peerName,f=e[p];if(!f)throw new Error("no Peer found");var h=(0,u.default)({},f,{displayName:l});return(0,u.default)({},e,(0,s.default)({},h.name,h));case"ADD_CONSUMER":var m=r.payload,v=m.consumer,y=m.peerName,_=e[y];if(!_)throw new Error("no Peer found for new Consumer");var g=[].concat((0,i.default)(_.consumers),[v.id]),b=(0,u.default)({},_,{consumers:g});return t.emitter.emit("peerConsumerAdded",b),(0,u.default)({},e,(0,s.default)({},b.name,b));case"REMOVE_CONSUMER":var w=r.payload,k=w.consumerId,P=w.peerName,S=e[P];if(!S)return e;var E=S.consumers.indexOf(k);if(-1===E)throw new Error("Consumer not found");var x=S.consumers.slice();x.splice(E,1);var T=(0,u.default)({},S,{consumers:x});return t.emitter.emit("peerConsumerRemoved",T),(0,u.default)({},e,(0,s.default)({},T.name,T));default:return e}};r.default=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/defineProperty":26,"babel-runtime/helpers/extends":27,"babel-runtime/helpers/toConsumableArray":28}],9:[function(e,t,r){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("babel-runtime/helpers/defineProperty"),i=n(o),a=e("babel-runtime/helpers/extends"),s=n(a),c={},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,r=arguments[1];switch(r.type){case"ADD_PRODUCER":var n=r.payload.producer;return t.emitter.emit("ADD_PRODUCER",n),(0,s.default)({},e,(0,i.default)({},n.id,n));case"REMOVE_PRODUCER":var o=r.payload.producerId,a=(0,s.default)({},e);return delete a[o],t.emitter.emit("REMOVE_PRODUCER",producer),a;case"SET_PRODUCER_PAUSED":var u=r.payload,d=u.producerId,l=u.originator,p=e[d],f=void 0;return f="local"===l?(0,s.default)({},p,{locallyPaused:!0}):(0,s.default)({},p,{remotelyPaused:!0}),t.emitter.emit("SET_PRODUCER_PAUSED",f),(0,s.default)({},e,(0,i.default)({},d,f));case"SET_PRODUCER_RESUMED":var h=r.payload,m=h.producerId,v=h.originator,y=e[m],_=void 0;return _="local"===v?(0,s.default)({},y,{locallyPaused:!1}):(0,s.default)({},y,{remotelyPaused:!1}),t.emitter.emit("SET_PRODUCER_RESUMED",_),(0,s.default)({},e,(0,i.default)({},m,_));case"SET_PRODUCER_TRACK":var g=r.payload,b=g.producerId,w=g.track,k=e[b],P=(0,s.default)({},k,{track:w});return t.emitter.emit("SET_PRODUCER_TRACK",P),(0,s.default)({},e,(0,i.default)({},b,P));default:return e}};r.default=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/defineProperty":26,"babel-runtime/helpers/extends":27}],10:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("babel-runtime/helpers/extends"),o=function(e){return e&&e.__esModule?e:{default:e}}(n),i={url:null,state:"new",activeSpeakerName:null},a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,r=arguments[1];switch(r.type){case"SET_ROOM_URL":var n=r.payload.url;return(0,o.default)({},e,{url:n});case"SET_ROOM_STATE":var a=r.payload.state;return t.emitter.emit("SET_ROOM_STATE",a),"connected"==a?(0,o.default)({},e,{state:a}):(0,o.default)({},e,{state:a,activeSpeakerName:null});case"SET_ROOM_ACTIVE_SPEAKER":var s=r.payload.peerName;return t.emitter.emit("SET_ROOM_ACTIVE_SPEAKER",s),(0,o.default)({},e,{activeSpeakerName:s});default:return e}};r.default=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/extends":27}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.notify=r.restartIce=r.disableAudioOnly=r.enableAudioOnly=r.changeWebcam=r.disableWebcam=r.enableWebcam=r.unmuteMic=r.muteMic=r.changeDisplayName=r.leaveRoom=r.joinRoom=void 0;var n=e("random-string"),o=function(e){
return e&&e.__esModule?e:{default:e}}(n),i=e("./stateActions"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(i);r.joinRoom=function(e){return{type:"JOIN_ROOM",payload:{media_server_wss:e.media_server_wss,roomId:e.roomId,peerName:e.peerName,displayName:e.displayName,device:e.device,useSimulcast:e.useSimulcast,produce:e.produce,turnservers:e.turnservers,args:e.args}}},r.leaveRoom=function(){return{type:"LEAVE_ROOM"}},r.changeDisplayName=function(e){return{type:"CHANGE_DISPLAY_NAME",payload:{displayName:e}}},r.muteMic=function(){return{type:"MUTE_MIC"}},r.unmuteMic=function(){return{type:"UNMUTE_MIC"}},r.enableWebcam=function(){return{type:"ENABLE_WEBCAM"}},r.disableWebcam=function(){return{type:"DISABLE_WEBCAM"}},r.changeWebcam=function(){return{type:"CHANGE_WEBCAM"}},r.enableAudioOnly=function(){return{type:"ENABLE_AUDIO_ONLY"}},r.disableAudioOnly=function(){return{type:"DISABLE_AUDIO_ONLY"}},r.restartIce=function(){return{type:"RESTART_ICE"}},r.notify=function(e){var t=e.type,r=void 0===t?"info":t,n=e.text,i=e.timeout;if(!i)switch(r){case"info":i=3e3;break;case"error":i=5e3}var s={id:(0,o.default)({length:6}).toLowerCase(),type:r,text:n,timeout:i};return function(e){e(a.addNotification(s)),setTimeout(function(){e(a.removeNotification(s.id))},i)}}},{"./stateActions":13,"random-string":195}],12:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("../RoomClient"),o=function(e){return e&&e.__esModule?e:{default:e}}(n);r.default=function(e){var r=e.dispatch,n=e.getState;return function(e){var i=void 0;return function(a){switch(a.type){case"JOIN_ROOM":var s=a.payload,c=s.media_server_wss,u=s.roomId,d=s.peerName,l=s.displayName,p=s.device,f=s.useSimulcast,h=s.produce,m=s.turnservers,v=s.args;i=new o.default({media_server_wss:c,roomId:u,peerName:d,displayName:l,device:p,useSimulcast:f,produce:h,dispatch:r,getState:n,turnservers:m,args:v}),t.CLIENT=i,t.emitter.emit("joinRoom",i);break;case"LEAVE_ROOM":i.close(),t.emitter.emit("leaveRoom",i);break;case"CHANGE_DISPLAY_NAME":var y=a.payload.displayName;i.changeDisplayName(y),t.emitter.emit("changeDisplayName",i);break;case"MUTE_MIC":i.muteMic(),t.emitter.emit("muteMic",i);break;case"UNMUTE_MIC":i.unmuteMic(),t.emitter.emit("unmuteMic",i);break;case"ENABLE_WEBCAM":i.enableWebcam(),t.emitter.emit("enableWebcam",i);break;case"DISABLE_WEBCAM":i.disableWebcam(),t.emitter.emit("disableWebcam",i);break;case"CHANGE_WEBCAM":i.changeWebcam(),t.emitter.emit("changeWebcam",i);break;case"ENABLE_AUDIO_ONLY":i.enableAudioOnly(),t.emitter.emit("enableAudioOnly",i);break;case"DISABLE_AUDIO_ONLY":i.disableAudioOnly(),t.emitter.emit("disableAudioOnly",i);break;case"RESTART_ICE":i.restartIce(),t.emitter.emit("restartIce",i)}return e(a)}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../RoomClient":2}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.setRoomUrl=function(e){return{type:"SET_ROOM_URL",payload:{url:e}}},r.setRoomState=function(e){return{type:"SET_ROOM_STATE",payload:{state:e}}},r.setRoomActiveSpeaker=function(e){return{type:"SET_ROOM_ACTIVE_SPEAKER",payload:{peerName:e}}},r.setMe=function(e){return{type:"SET_ME",payload:{peerName:e.peerName,displayName:e.displayName,displayNameSet:e.displayNameSet,device:e.device}}},r.setMediaCapabilities=function(e){return{type:"SET_MEDIA_CAPABILITIES",payload:{canSendMic:e.canSendMic,canSendWebcam:e.canSendWebcam}}},r.setCanChangeWebcam=function(e){return{type:"SET_CAN_CHANGE_WEBCAM",payload:e}},r.setDisplayName=function(e){return{type:"SET_DISPLAY_NAME",payload:{displayName:e}}},r.setAudioOnlyState=function(e){return{type:"SET_AUDIO_ONLY_STATE",payload:{enabled:e}}},r.setAudioOnlyInProgress=function(e){return{type:"SET_AUDIO_ONLY_IN_PROGRESS",payload:{flag:e}}},r.setRestartIceInProgress=function(e){return{type:"SET_RESTART_ICE_IN_PROGRESS",payload:{flag:e}}},r.addProducer=function(e){return{type:"ADD_PRODUCER",payload:{producer:e}}},r.removeProducer=function(e){return{type:"REMOVE_PRODUCER",payload:{producerId:e}}},r.setProducerPaused=function(e,t){return{type:"SET_PRODUCER_PAUSED",payload:{producerId:e,originator:t}}},r.setProducerResumed=function(e,t){return{type:"SET_PRODUCER_RESUMED",payload:{producerId:e,originator:t}}},r.setProducerTrack=function(e,t){return{type:"SET_PRODUCER_TRACK",payload:{producerId:e,track:t}}},r.setWebcamInProgress=function(e){return{type:"SET_WEBCAM_IN_PROGRESS",payload:{flag:e}}},r.addPeer=function(e){return{type:"ADD_PEER",payload:{peer:e}}},r.removePeer=function(e){return{type:"REMOVE_PEER",payload:{peerName:e}}},r.setPeerDisplayName=function(e,t){return{type:"SET_PEER_DISPLAY_NAME",payload:{displayName:e,peerName:t}}},r.addConsumer=function(e,t){return{type:"ADD_CONSUMER",payload:{consumer:e,peerName:t}}},r.removeConsumer=function(e,t){return{type:"REMOVE_CONSUMER",payload:{consumerId:e,peerName:t}}},r.setConsumerPaused=function(e,t){return{type:"SET_CONSUMER_PAUSED",payload:{consumerId:e,originator:t}}},r.setConsumerResumed=function(e,t){return{type:"SET_CONSUMER_RESUMED",payload:{consumerId:e,originator:t}}},r.setConsumerEffectiveProfile=function(e,t){return{type:"SET_CONSUMER_EFFECTIVE_PROFILE",payload:{consumerId:e,profile:t}}},r.setConsumerTrack=function(e,t){return{type:"SET_CONSUMER_TRACK",payload:{consumerId:e,track:t}}},r.addNotification=function(e){return{type:"ADD_NOTIFICATION",payload:{notification:e}}},r.removeNotification=function(e){return{type:"REMOVE_NOTIFICATION",payload:{notificationId:e}}},r.removeAllNotifications=function(){return{type:"REMOVE_ALL_NOTIFICATIONS"}}},{}],14:[function(e,t,r){"use strict";function n(e,t,r){window.location.hostname;return e||console.error("config.media_server_wss don't set."),e+"/?peerName="+t+"&roomId="+r}Object.defineProperty(r,"__esModule",{value:!0}),r.getProtooUrl=n},{}],15:[function(e,t,r){"use strict";function n(){return c=document.getElementById("mediasoup-demo-app-media-query-detector"),s.default.resolve()}function o(){return Boolean(c.offsetParent)}function i(){return!c.offsetParent}Object.defineProperty(r,"__esModule",{value:!0});var a=e("babel-runtime/core-js/promise"),s=function(e){return e&&e.__esModule?e:{default:e}}(a);r.initialize=n,r.isDesktop=o,r.isMobile=i;var c=void 0},{"babel-runtime/core-js/promise":23}],16:[function(e,t,r){function n(e,t,r){function n(e,o){if(n.count<=0)throw new Error("after called too many times");--n.count,e?(i=!0,t(e),t=r):0!==n.count||i||t(null,o)}var i=!1;return r=r||o,n.count=e,0===e?t():n}function o(){}t.exports=n},{}],17:[function(e,t,r){t.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(r-t),a=t,s=0;a<r;a++,s++)i[s]=o[a];return i.buffer}},{}],18:[function(e,t,r){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":37}],19:[function(e,t,r){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":38}],20:[function(e,t,r){t.exports={default:e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":39}],21:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":40}],22:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":41}],23:[function(e,t,r){t.exports={default:e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":42}],24:[function(e,t,r){"use strict";r.__esModule=!0,r.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],25:[function(e,t,r){"use strict";r.__esModule=!0;var n=e("../core-js/object/define-property"),o=function(e){return e&&e.__esModule?e:{default:e}}(n);r.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,o.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},{"../core-js/object/define-property":22}],26:[function(e,t,r){"use strict";r.__esModule=!0;var n=e("../core-js/object/define-property"),o=function(e){return e&&e.__esModule?e:{default:e}}(n);r.default=function(e,t,r){return t in e?(0,o.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},{"../core-js/object/define-property":22}],27:[function(e,t,r){"use strict";r.__esModule=!0;var n=e("../core-js/object/assign"),o=function(e){return e&&e.__esModule?e:{default:e}}(n);r.default=o.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},{"../core-js/object/assign":21}],28:[function(e,t,r){"use strict";r.__esModule=!0;var n=e("../core-js/array/from"),o=function(e){return e&&e.__esModule?e:{default:e}}(n);r.default=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return(0,o.default)(e)}},{"../core-js/array/from":18}],29:[function(e,t,r){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},{}],30:[function(e,t,r){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=new Uint8Array(256),n=0;n<e.length;n++)t[e.charCodeAt(n)]=n;r.encode=function(t){var r,n=new Uint8Array(t),o=n.length,i="";for(r=0;r<o;r+=3)i+=e[n[r]>>2],i+=e[(3&n[r])<<4|n[r+1]>>4],i+=e[(15&n[r+1])<<2|n[r+2]>>6],i+=e[63&n[r+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},r.decode=function(e){var r,n,o,i,a,s=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var d=new ArrayBuffer(s),l=new Uint8Array(d);for(r=0;r<c;r+=4)n=t[e.charCodeAt(r)],o=t[e.charCodeAt(r+1)],i=t[e.charCodeAt(r+2)],a=t[e.charCodeAt(r+3)],l[u++]=n<<2|o>>4,l[u++]=(15&o)<<4|i>>2,l[u++]=(3&i)<<6|63&a;return d}}()},{}],31:[function(e,t,r){(function(e){function r(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var o=new Uint8Array(r.byteLength);o.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=o.buffer}e[t]=n}}}function n(e,t){t=t||{};var n=new i;r(e);for(var o=0;o<e.length;o++)n.append(e[o]);return t.type?n.getBlob(t.type):n.getBlob()}function o(e,t){return r(e),new Blob(e,t||{})}var i=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,a=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),s=a&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=i&&i.prototype.append&&i.prototype.getBlob;t.exports=function(){return a?s?e.Blob:o:c?n:void 0}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],32:[function(t,r,n){!function(t,n,o){void 0!==r&&r.exports?r.exports=o():"function"==typeof e&&e.amd?e("bowser",o):t.bowser=o()}(this,0,function(){function e(e){function t(t){var r=e.match(t);return r&&r.length>1&&r[1]||""}function r(t){var r=e.match(t);return r&&r.length>1&&r[2]||""}var n,o=t(/(ipod|iphone|ipad)/i).toLowerCase(),i=/like android/i.test(e),s=!i&&/android/i.test(e),c=/nexus\s*[0-6]\s*/i.test(e),u=!c&&/nexus\s*[0-9]+/i.test(e),d=/CrOS/.test(e),l=/silk/i.test(e),p=/sailfish/i.test(e),f=/tizen/i.test(e),h=/(web|hpw)os/i.test(e),m=/windows phone/i.test(e),v=(/SamsungBrowser/i.test(e),!m&&/windows/i.test(e)),y=!o&&!l&&/macintosh/i.test(e),_=!s&&!p&&!f&&!h&&/linux/i.test(e),g=r(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),b=t(/version\/(\d+(\.\d+)?)/i),w=/tablet/i.test(e)&&!/tablet pc/i.test(e),k=!w&&/[^-]mobi/i.test(e),P=/xbox/i.test(e);/opera/i.test(e)?n={name:"Opera",opera:a,version:b||t(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(e)?n={name:"Opera",opera:a,version:t(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||b}:/SamsungBrowser/i.test(e)?n={name:"Samsung Internet for Android",samsungBrowser:a,version:b||t(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(e)?n={name:"Opera Coast",coast:a,version:b||t(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?n={name:"Yandex Browser",yandexbrowser:a,version:b||t(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(e)?n={name:"UC Browser",ucbrowser:a,version:t(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(e)?n={name:"Maxthon",maxthon:a,version:t(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(e)?n={name:"Epiphany",epiphany:a,version:t(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(e)?n={name:"Puffin",puffin:a,version:t(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(e)?n={name:"Sleipnir",sleipnir:a,version:t(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(e)?n={name:"K-Meleon",kMeleon:a,version:t(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:m?(n={name:"Windows Phone",osname:"Windows Phone",windowsphone:a},g?(n.msedge=a,n.version=g):(n.msie=a,n.version=t(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?n={name:"Internet Explorer",msie:a,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:d?n={name:"Chrome",osname:"Chrome OS",chromeos:a,chromeBook:a,chrome:a,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(e)?n={name:"Microsoft Edge",msedge:a,version:g}:/vivaldi/i.test(e)?n={name:"Vivaldi",vivaldi:a,version:t(/vivaldi\/(\d+(\.\d+)?)/i)||b}:p?n={name:"Sailfish",osname:"Sailfish OS",sailfish:a,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?n={name:"SeaMonkey",seamonkey:a,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(e)?(n={name:"Firefox",firefox:a,version:t(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(n.firefoxos=a,n.osname="Firefox OS")):l?n={name:"Amazon Silk",silk:a,version:t(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(e)?n={name:"PhantomJS",phantom:a,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(e)?n={name:"SlimerJS",slimer:a,version:t(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?n={name:"BlackBerry",osname:"BlackBerry OS",blackberry:a,version:b||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:h?(n={name:"WebOS",osname:"WebOS",webos:a,version:b||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(n.touchpad=a)):/bada/i.test(e)?n={name:"Bada",osname:"Bada",bada:a,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:f?n={name:"Tizen",osname:"Tizen",tizen:a,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||b}:/qupzilla/i.test(e)?n={name:"QupZilla",qupzilla:a,version:t(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||b}:/chromium/i.test(e)?n={name:"Chromium",chromium:a,version:t(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||b}:/chrome|crios|crmo/i.test(e)?n={name:"Chrome",chrome:a,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:s?n={name:"Android",version:b}:/safari|applewebkit/i.test(e)?(n={name:"Safari",safari:a},b&&(n.version=b)):o?(n={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},b&&(n.version=b)):n=/googlebot/i.test(e)?{name:"Googlebot",googlebot:a,version:t(/googlebot\/(\d+(\.\d+))/i)||b}:{name:t(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!n.msedge&&/(apple)?webkit/i.test(e)?(/(apple)?webkit\/537\.36/i.test(e)?(n.name=n.name||"Blink",n.blink=a):(n.name=n.name||"Webkit",n.webkit=a),!n.version&&b&&(n.version=b)):!n.opera&&/gecko\//i.test(e)&&(n.name=n.name||"Gecko",n.gecko=a,n.version=n.version||t(/gecko\/(\d+(\.\d+)?)/i)),n.windowsphone||!s&&!n.silk?!n.windowsphone&&o?(n[o]=a,n.ios=a,n.osname="iOS"):y?(n.mac=a,n.osname="macOS"):P?(n.xbox=a,n.osname="Xbox"):v?(n.windows=a,n.osname="Windows"):_&&(n.linux=a,n.osname="Linux"):(n.android=a,n.osname="Android");var S="";n.windows?S=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(t(/Windows ((NT|XP)( \d\d?.\d)?)/i)):n.windowsphone?S=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.mac?(S=t(/Mac OS X (\d+([_\.\s]\d+)*)/i),S=S.replace(/[_\s]/g,".")):o?(S=t(/os (\d+([_\s]\d+)*) like mac os x/i),S=S.replace(/[_\s]/g,".")):s?S=t(/android[ \/-](\d+(\.\d+)*)/i):n.webos?S=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?S=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?S=t(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(S=t(/tizen[\/\s](\d+(\.\d+)*)/i)),S&&(n.osversion=S);var E=!n.windows&&S.split(".")[0];return w||u||"ipad"==o||s&&(3==E||E>=4&&!k)||n.silk?n.tablet=a:(k||"iphone"==o||"ipod"==o||s||c||n.blackberry||n.webos||n.bada)&&(n.mobile=a),n.msedge||n.msie&&n.version>=10||n.yandexbrowser&&n.version>=15||n.vivaldi&&n.version>=1||n.chrome&&n.version>=20||n.samsungBrowser&&n.version>=4||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1||n.chromium&&n.version>=20?n.a=a:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6||n.chromium&&n.version<20?n.c=a:n.x=a,n}function t(e){return e.split(".").length}function r(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function n(e){for(var n=Math.max(t(e[0]),t(e[1])),o=r(e,function(e){var o=n-t(e);return e+=new Array(o+1).join(".0"),r(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--n>=0;){if(o[0][n]>o[1][n])return 1;if(o[0][n]!==o[1][n])return-1;if(0===n)return 0}}function o(t,r,o){var i=s;"string"==typeof r&&(o=r,r=void 0),void 0===r&&(r=!1),o&&(i=e(o));var a=""+i.version;for(var c in t)if(t.hasOwnProperty(c)&&i[c]){if("string"!=typeof t[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(t));return n([a,t[c]])<0}return r}function i(e,t,r){return!o(e,t,r)}var a=!0,s=e("undefined"!=typeof navigator?navigator.userAgent||"":"");return s.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if("string"==typeof r&&r in s)return!0}return!1},s.isUnsupportedBrowser=o,s.compareVersions=n,s.check=i,s._detect=e,s.detect=e,s})},{}],33:[function(e,t,r){},{}],34:[function(e,t,r){var n=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},{}],35:[function(e,t,r){function n(e){if(e)return o(e)}function o(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}void 0!==t&&(t.exports=n),n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n,o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var n=0,o=r.length;n<o;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],36:[function(e,t,r){t.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],37:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":57,"../../modules/es6.array.from":121,"../../modules/es6.string.iterator":128}],38:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":120,"../modules/es6.string.iterator":128,"../modules/web.dom.iterable":134}],39:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),e("../modules/es7.map.of"),e("../modules/es7.map.from"),t.exports=e("../modules/_core").Map},{"../modules/_core":57,"../modules/es6.map":123,"../modules/es6.object.to-string":126,"../modules/es6.string.iterator":128,"../modules/es7.map.from":129,"../modules/es7.map.of":130,"../modules/es7.map.to-json":131,"../modules/web.dom.iterable":134}],40:[function(e,t,r){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":57,"../../modules/es6.object.assign":124}],41:[function(e,t,r){e("../../modules/es6.object.define-property");var n=e("../../modules/_core").Object;t.exports=function(e,t,r){return n.defineProperty(e,t,r)}},{"../../modules/_core":57,"../../modules/es6.object.define-property":125}],42:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":57,"../modules/es6.object.to-string":126,"../modules/es6.promise":127,"../modules/es6.string.iterator":128,"../modules/es7.promise.finally":132,"../modules/es7.promise.try":133,"../modules/web.dom.iterable":134}],43:[function(e,t,r){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],44:[function(e,t,r){t.exports=function(){}},{}],45:[function(e,t,r){t.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},{}],46:[function(e,t,r){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":76}],47:[function(e,t,r){var n=e("./_for-of");t.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},{"./_for-of":66}],48:[function(e,t,r){var n=e("./_to-iobject"),o=e("./_to-length"),i=e("./_to-absolute-index");t.exports=function(e){return function(t,r,a){var s,c=n(t),u=o(c.length),d=i(a,u);if(e&&r!=r){for(;u>d;)if((s=c[d++])!=s)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===r)return e||d||0;return!e&&-1}}},{"./_to-absolute-index":110,"./_to-iobject":112,"./_to-length":113}],49:[function(e,t,r){var n=e("./_ctx"),o=e("./_iobject"),i=e("./_to-object"),a=e("./_to-length"),s=e("./_array-species-create");t.exports=function(e,t){var r=1==e,c=2==e,u=3==e,d=4==e,l=6==e,p=5==e||l,f=t||s;return function(t,s,h){for(var m,v,y=i(t),_=o(y),g=n(s,h,3),b=a(_.length),w=0,k=r?f(t,b):c?f(t,0):void 0;b>w;w++)if((p||w in _)&&(m=_[w],v=g(m,w,y),e))if(r)k[w]=v;else if(v)switch(e){case 3:return!0;case 5:return m;case 6:return w;case 2:k.push(m)}else if(d)return!1;return l?-1:u||d?d:k}}},{"./_array-species-create":51,"./_ctx":59,"./_iobject":73,"./_to-length":113,"./_to-object":114}],50:[function(e,t,r){var n=e("./_is-object"),o=e("./_is-array"),i=e("./_wks")("species");t.exports=function(e){var t;return o(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!o(t.prototype)||(t=void 0),n(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},{"./_is-array":75,"./_is-object":76,"./_wks":118}],51:[function(e,t,r){var n=e("./_array-species-constructor");t.exports=function(e,t){return new(n(e))(t)}},{"./_array-species-constructor":50}],52:[function(e,t,r){var n=e("./_cof"),o=e("./_wks")("toStringTag"),i="Arguments"==n(function(){return arguments}()),a=function(e,t){try{return e[t]}catch(e){}};t.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=a(t=Object(e),o))?r:i?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},{"./_cof":53,"./_wks":118}],53:[function(e,t,r){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],54:[function(e,t,r){"use strict";var n=e("./_object-dp").f,o=e("./_object-create"),i=e("./_redefine-all"),a=e("./_ctx"),s=e("./_an-instance"),c=e("./_for-of"),u=e("./_iter-define"),d=e("./_iter-step"),l=e("./_set-species"),p=e("./_descriptors"),f=e("./_meta").fastKey,h=e("./_validate-collection"),m=p?"_s":"size",v=function(e,t){var r,n=f(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};t.exports={getConstructor:function(e,t,r,u){var d=e(function(e,n){s(e,d,t,"_i"),e._t=t,e._i=o(null),e._f=void 0,e._l=void 0,e[m]=0,void 0!=n&&c(n,r,e[u],e)});return i(d.prototype,{clear:function(){for(var e=h(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var r=h(this,t),n=v(r,e);if(n){var o=n.n,i=n.p;delete r._i[n.i],n.r=!0,i&&(i.n=o),o&&(o.p=i),r._f==n&&(r._f=o),r._l==n&&(r._l=i),r[m]--}return!!n},forEach:function(e){h(this,t);for(var r,n=a(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!v(h(this,t),e)}}),p&&n(d.prototype,"size",{get:function(){return h(this,t)[m]}}),d},def:function(e,t,r){var n,o,i=v(e,t);return i?i.v=r:(e._l=i={i:o=f(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=i),n&&(n.n=i),e[m]++,"F"!==o&&(e._i[o]=i)),e},getEntry:v,setStrong:function(e,t,r){u(e,t,function(e,r){this._t=h(e,t),this._k=r,this._l=void 0},function(){for(var e=this,t=e._k,r=e._l;r&&r.r;)r=r.p;return e._t&&(e._l=r=r?r.n:e._t._f)?"keys"==t?d(0,r.k):"values"==t?d(0,r.v):d(0,[r.k,r.v]):(e._t=void 0,d(1))},r?"entries":"values",!r,!0),l(t)}}},{"./_an-instance":45,"./_ctx":59,"./_descriptors":61,"./_for-of":66,"./_iter-define":79,"./_iter-step":81,"./_meta":84,"./_object-create":88,"./_object-dp":89,"./_redefine-all":99,"./_set-species":103,"./_validate-collection":117}],55:[function(e,t,r){var n=e("./_classof"),o=e("./_array-from-iterable");t.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return o(this)}}},{"./_array-from-iterable":47,"./_classof":52}],56:[function(e,t,r){"use strict";var n=e("./_global"),o=e("./_export"),i=e("./_meta"),a=e("./_fails"),s=e("./_hide"),c=e("./_redefine-all"),u=e("./_for-of"),d=e("./_an-instance"),l=e("./_is-object"),p=e("./_set-to-string-tag"),f=e("./_object-dp").f,h=e("./_array-methods")(0),m=e("./_descriptors");t.exports=function(e,t,r,v,y,_){var g=n[e],b=g,w=y?"set":"add",k=b&&b.prototype,P={};return m&&"function"==typeof b&&(_||k.forEach&&!a(function(){(new b).entries().next()}))?(b=t(function(t,r){d(t,b,e,"_c"),t._c=new g,void 0!=r&&u(r,y,t[w],t)}),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in k&&(!_||"clear"!=e)&&s(b.prototype,e,function(r,n){if(d(this,b,e),!t&&_&&!l(r))return"get"==e&&void 0;var o=this._c[e](0===r?0:r,n);return t?this:o})}),_||f(b.prototype,"size",{get:function(){return this._c.size}})):(b=v.getConstructor(t,e,y,w),c(b.prototype,r),i.NEED=!0),p(b,e),P[e]=b,o(o.G+o.W+o.F,P),_||v.setStrong(b,e,y),b}},{"./_an-instance":45,"./_array-methods":49,"./_descriptors":61,"./_export":64,"./_fails":65,"./_for-of":66,"./_global":67,"./_hide":69,"./_is-object":76,"./_meta":84,"./_object-dp":89,"./_redefine-all":99,"./_set-to-string-tag":104}],57:[function(e,t,r){var n=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=n)},{}],58:[function(e,t,r){"use strict";var n=e("./_object-dp"),o=e("./_property-desc");t.exports=function(e,t,r){t in e?n.f(e,t,o(0,r)):e[t]=r}},{"./_object-dp":89,"./_property-desc":98}],59:[function(e,t,r){var n=e("./_a-function");t.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":43}],60:[function(e,t,r){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],61:[function(e,t,r){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":65}],62:[function(e,t,r){var n=e("./_is-object"),o=e("./_global").document,i=n(o)&&n(o.createElement);t.exports=function(e){return i?o.createElement(e):{}}},{"./_global":67,"./_is-object":76}],63:[function(e,t,r){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],64:[function(e,t,r){var n=e("./_global"),o=e("./_core"),i=e("./_ctx"),a=e("./_hide"),s=function(e,t,r){var c,u,d,l=e&s.F,p=e&s.G,f=e&s.S,h=e&s.P,m=e&s.B,v=e&s.W,y=p?o:o[t]||(o[t]={}),_=y.prototype,g=p?n:f?n[t]:(n[t]||{}).prototype;p&&(r=t);for(c in r)(u=!l&&g&&void 0!==g[c])&&c in y||(d=u?g[c]:r[c],y[c]=p&&"function"!=typeof g[c]?r[c]:m&&u?i(d,n):v&&g[c]==d?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):h&&"function"==typeof d?i(Function.call,d):d,h&&((y.virtual||(y.virtual={}))[c]=d,e&s.R&&_&&!_[c]&&a(_,c,d)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,t.exports=s},{"./_core":57,"./_ctx":59,"./_global":67,"./_hide":69}],65:[function(e,t,r){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],66:[function(e,t,r){var n=e("./_ctx"),o=e("./_iter-call"),i=e("./_is-array-iter"),a=e("./_an-object"),s=e("./_to-length"),c=e("./core.get-iterator-method"),u={},d={},r=t.exports=function(e,t,r,l,p){var f,h,m,v,y=p?function(){return e}:c(e),_=n(r,l,t?2:1),g=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(i(y)){for(f=s(e.length);f>g;g++)if((v=t?_(a(h=e[g])[0],h[1]):_(e[g]))===u||v===d)return v}else for(m=y.call(e);!(h=m.next()).done;)if((v=o(m,_,h.value,t))===u||v===d)return v};r.BREAK=u,r.RETURN=d},{"./_an-object":46,"./_ctx":59,"./_is-array-iter":74,"./_iter-call":77,"./_to-length":113,"./core.get-iterator-method":119}],67:[function(e,t,r){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],68:[function(e,t,r){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],69:[function(e,t,r){var n=e("./_object-dp"),o=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},{"./_descriptors":61,"./_object-dp":89,"./_property-desc":98}],70:[function(e,t,r){var n=e("./_global").document;t.exports=n&&n.documentElement},{"./_global":67}],71:[function(e,t,r){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":61,"./_dom-create":62,"./_fails":65}],72:[function(e,t,r){t.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r)
;case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},{}],73:[function(e,t,r){var n=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},{"./_cof":53}],74:[function(e,t,r){var n=e("./_iterators"),o=e("./_wks")("iterator"),i=Array.prototype;t.exports=function(e){return void 0!==e&&(n.Array===e||i[o]===e)}},{"./_iterators":82,"./_wks":118}],75:[function(e,t,r){var n=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==n(e)}},{"./_cof":53}],76:[function(e,t,r){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],77:[function(e,t,r){var n=e("./_an-object");t.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){var i=e.return;throw void 0!==i&&n(i.call(e)),t}}},{"./_an-object":46}],78:[function(e,t,r){"use strict";var n=e("./_object-create"),o=e("./_property-desc"),i=e("./_set-to-string-tag"),a={};e("./_hide")(a,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,r){e.prototype=n(a,{next:o(1,r)}),i(e,t+" Iterator")}},{"./_hide":69,"./_object-create":88,"./_property-desc":98,"./_set-to-string-tag":104,"./_wks":118}],79:[function(e,t,r){"use strict";var n=e("./_library"),o=e("./_export"),i=e("./_redefine"),a=e("./_hide"),s=e("./_has"),c=e("./_iterators"),u=e("./_iter-create"),d=e("./_set-to-string-tag"),l=e("./_object-gpo"),p=e("./_wks")("iterator"),f=!([].keys&&"next"in[].keys()),h=function(){return this};t.exports=function(e,t,r,m,v,y,_){u(r,t,m);var g,b,w,k=function(e){if(!f&&e in x)return x[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},P=t+" Iterator",S="values"==v,E=!1,x=e.prototype,T=x[p]||x["@@iterator"]||v&&x[v],R=!f&&T||k(v),C=v?S?k("entries"):R:void 0,O="Array"==t?x.entries||T:T;if(O&&(w=l(O.call(new e)))!==Object.prototype&&w.next&&(d(w,P,!0),n||s(w,p)||a(w,p,h)),S&&T&&"values"!==T.name&&(E=!0,R=function(){return T.call(this)}),n&&!_||!f&&!E&&x[p]||a(x,p,R),c[t]=R,c[P]=h,v)if(g={values:S?R:k("values"),keys:y?R:k("keys"),entries:C},_)for(b in g)b in x||i(x,b,g[b]);else o(o.P+o.F*(f||E),t,g);return g}},{"./_export":64,"./_has":68,"./_hide":69,"./_iter-create":78,"./_iterators":82,"./_library":83,"./_object-gpo":92,"./_redefine":100,"./_set-to-string-tag":104,"./_wks":118}],80:[function(e,t,r){var n=e("./_wks")("iterator"),o=!1;try{var i=[7][n]();i.return=function(){o=!0},Array.from(i,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!o)return!1;var r=!1;try{var i=[7],a=i[n]();a.next=function(){return{done:r=!0}},i[n]=function(){return a},e(i)}catch(e){}return r}},{"./_wks":118}],81:[function(e,t,r){t.exports=function(e,t){return{value:t,done:!!e}}},{}],82:[function(e,t,r){t.exports={}},{}],83:[function(e,t,r){t.exports=!0},{}],84:[function(e,t,r){var n=e("./_uid")("meta"),o=e("./_is-object"),i=e("./_has"),a=e("./_object-dp").f,s=0,c=Object.isExtensible||function(){return!0},u=!e("./_fails")(function(){return c(Object.preventExtensions({}))}),d=function(e){a(e,n,{value:{i:"O"+ ++s,w:{}}})},l=function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,n)){if(!c(e))return"F";if(!t)return"E";d(e)}return e[n].i},p=function(e,t){if(!i(e,n)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[n].w},f=function(e){return u&&h.NEED&&c(e)&&!i(e,n)&&d(e),e},h=t.exports={KEY:n,NEED:!1,fastKey:l,getWeak:p,onFreeze:f}},{"./_fails":65,"./_has":68,"./_is-object":76,"./_object-dp":89,"./_uid":116}],85:[function(e,t,r){var n=e("./_global"),o=e("./_task").set,i=n.MutationObserver||n.WebKitMutationObserver,a=n.process,s=n.Promise,c="process"==e("./_cof")(a);t.exports=function(){var e,t,r,u=function(){var n,o;for(c&&(n=a.domain)&&n.exit();e;){o=e.fn,e=e.next;try{o()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){a.nextTick(u)};else if(!i||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var d=s.resolve();r=function(){d.then(u)}}else r=function(){o.call(n,u)};else{var l=!0,p=document.createTextNode("");new i(u).observe(p,{characterData:!0}),r=function(){p.data=l=!l}}return function(n){var o={fn:n,next:void 0};t&&(t.next=o),e||(e=o,r()),t=o}}},{"./_cof":53,"./_global":67,"./_task":109}],86:[function(e,t,r){"use strict";function n(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=o(t),this.reject=o(r)}var o=e("./_a-function");t.exports.f=function(e){return new n(e)}},{"./_a-function":43}],87:[function(e,t,r){"use strict";var n=e("./_object-keys"),o=e("./_object-gops"),i=e("./_object-pie"),a=e("./_to-object"),s=e("./_iobject"),c=Object.assign;t.exports=!c||e("./_fails")(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=c({},e)[r]||Object.keys(c({},t)).join("")!=n})?function(e,t){for(var r=a(e),c=arguments.length,u=1,d=o.f,l=i.f;c>u;)for(var p,f=s(arguments[u++]),h=d?n(f).concat(d(f)):n(f),m=h.length,v=0;m>v;)l.call(f,p=h[v++])&&(r[p]=f[p]);return r}:c},{"./_fails":65,"./_iobject":73,"./_object-gops":91,"./_object-keys":94,"./_object-pie":95,"./_to-object":114}],88:[function(e,t,r){var n=e("./_an-object"),o=e("./_object-dps"),i=e("./_enum-bug-keys"),a=e("./_shared-key")("IE_PROTO"),s=function(){},c=function(){var t,r=e("./_dom-create")("iframe"),n=i.length;for(r.style.display="none",e("./_html").appendChild(r),r.src="javascript:",t=r.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),c=t.F;n--;)delete c.prototype[i[n]];return c()};t.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[a]=e):r=c(),void 0===t?r:o(r,t)}},{"./_an-object":46,"./_dom-create":62,"./_enum-bug-keys":63,"./_html":70,"./_object-dps":90,"./_shared-key":105}],89:[function(e,t,r){var n=e("./_an-object"),o=e("./_ie8-dom-define"),i=e("./_to-primitive"),a=Object.defineProperty;r.f=e("./_descriptors")?Object.defineProperty:function(e,t,r){if(n(e),t=i(t,!0),n(r),o)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},{"./_an-object":46,"./_descriptors":61,"./_ie8-dom-define":71,"./_to-primitive":115}],90:[function(e,t,r){var n=e("./_object-dp"),o=e("./_an-object"),i=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){o(e);for(var r,a=i(t),s=a.length,c=0;s>c;)n.f(e,r=a[c++],t[r]);return e}},{"./_an-object":46,"./_descriptors":61,"./_object-dp":89,"./_object-keys":94}],91:[function(e,t,r){r.f=Object.getOwnPropertySymbols},{}],92:[function(e,t,r){var n=e("./_has"),o=e("./_to-object"),i=e("./_shared-key")("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=o(e),n(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},{"./_has":68,"./_shared-key":105,"./_to-object":114}],93:[function(e,t,r){var n=e("./_has"),o=e("./_to-iobject"),i=e("./_array-includes")(!1),a=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var r,s=o(e),c=0,u=[];for(r in s)r!=a&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~i(u,r)||u.push(r));return u}},{"./_array-includes":48,"./_has":68,"./_shared-key":105,"./_to-iobject":112}],94:[function(e,t,r){var n=e("./_object-keys-internal"),o=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return n(e,o)}},{"./_enum-bug-keys":63,"./_object-keys-internal":93}],95:[function(e,t,r){r.f={}.propertyIsEnumerable},{}],96:[function(e,t,r){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],97:[function(e,t,r){var n=e("./_an-object"),o=e("./_is-object"),i=e("./_new-promise-capability");t.exports=function(e,t){if(n(e),o(t)&&t.constructor===e)return t;var r=i.f(e);return(0,r.resolve)(t),r.promise}},{"./_an-object":46,"./_is-object":76,"./_new-promise-capability":86}],98:[function(e,t,r){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],99:[function(e,t,r){var n=e("./_hide");t.exports=function(e,t,r){for(var o in t)r&&e[o]?e[o]=t[o]:n(e,o,t[o]);return e}},{"./_hide":69}],100:[function(e,t,r){t.exports=e("./_hide")},{"./_hide":69}],101:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_a-function"),i=e("./_ctx"),a=e("./_for-of");t.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,s,c=arguments[1];return o(this),t=void 0!==c,t&&o(c),void 0==e?new this:(r=[],t?(n=0,s=i(c,arguments[2],2),a(e,!1,function(e){r.push(s(e,n++))})):a(e,!1,r.push,r),new this(r))}})}},{"./_a-function":43,"./_ctx":59,"./_export":64,"./_for-of":66}],102:[function(e,t,r){"use strict";var n=e("./_export");t.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},{"./_export":64}],103:[function(e,t,r){"use strict";var n=e("./_global"),o=e("./_core"),i=e("./_object-dp"),a=e("./_descriptors"),s=e("./_wks")("species");t.exports=function(e){var t="function"==typeof o[e]?o[e]:n[e];a&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},{"./_core":57,"./_descriptors":61,"./_global":67,"./_object-dp":89,"./_wks":118}],104:[function(e,t,r){var n=e("./_object-dp").f,o=e("./_has"),i=e("./_wks")("toStringTag");t.exports=function(e,t,r){e&&!o(e=r?e:e.prototype,i)&&n(e,i,{configurable:!0,value:t})}},{"./_has":68,"./_object-dp":89,"./_wks":118}],105:[function(e,t,r){var n=e("./_shared")("keys"),o=e("./_uid");t.exports=function(e){return n[e]||(n[e]=o(e))}},{"./_shared":106,"./_uid":116}],106:[function(e,t,r){var n=e("./_global"),o=n["__core-js_shared__"]||(n["__core-js_shared__"]={});t.exports=function(e){return o[e]||(o[e]={})}},{"./_global":67}],107:[function(e,t,r){var n=e("./_an-object"),o=e("./_a-function"),i=e("./_wks")("species");t.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||void 0==(r=n(a)[i])?t:o(r)}},{"./_a-function":43,"./_an-object":46,"./_wks":118}],108:[function(e,t,r){var n=e("./_to-integer"),o=e("./_defined");t.exports=function(e){return function(t,r){var i,a,s=String(o(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(i=s.charCodeAt(c),i<55296||i>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):i:e?s.slice(c,c+2):a-56320+(i-55296<<10)+65536)}}},{"./_defined":60,"./_to-integer":111}],109:[function(e,t,r){var n,o,i,a=e("./_ctx"),s=e("./_invoke"),c=e("./_html"),u=e("./_dom-create"),d=e("./_global"),l=d.process,p=d.setImmediate,f=d.clearImmediate,h=d.MessageChannel,m=d.Dispatch,v=0,y={},_=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},g=function(e){_.call(e.data)};p&&f||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return y[++v]=function(){s("function"==typeof e?e:Function(e),t)},n(v),v},f=function(e){delete y[e]},"process"==e("./_cof")(l)?n=function(e){l.nextTick(a(_,e,1))}:m&&m.now?n=function(e){m.now(a(_,e,1))}:h?(o=new h,i=o.port2,o.port1.onmessage=g,n=a(i.postMessage,i,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(n=function(e){d.postMessage(e+"","*")},d.addEventListener("message",g,!1)):n="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),_.call(e)}}:function(e){setTimeout(a(_,e,1),0)}),t.exports={set:p,clear:f}},{"./_cof":53,"./_ctx":59,"./_dom-create":62,"./_global":67,"./_html":70,"./_invoke":72}],110:[function(e,t,r){var n=e("./_to-integer"),o=Math.max,i=Math.min;t.exports=function(e,t){return e=n(e),e<0?o(e+t,0):i(e,t)}},{"./_to-integer":111}],111:[function(e,t,r){var n=Math.ceil,o=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?o:n)(e)}},{}],112:[function(e,t,r){var n=e("./_iobject"),o=e("./_defined");t.exports=function(e){return n(o(e))}},{"./_defined":60,"./_iobject":73}],113:[function(e,t,r){var n=e("./_to-integer"),o=Math.min;t.exports=function(e){return e>0?o(n(e),9007199254740991):0}},{"./_to-integer":111}],114:[function(e,t,r){var n=e("./_defined");t.exports=function(e){return Object(n(e))}},{"./_defined":60}],115:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e))return e;var r,o;if(t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if(!t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":76}],116:[function(e,t,r){var n=0,o=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+o).toString(36))}},{}],117:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},{"./_is-object":76}],118:[function(e,t,r){var n=e("./_shared")("wks"),o=e("./_uid"),i=e("./_global").Symbol,a="function"==typeof i;(t.exports=function(e){return n[e]||(n[e]=a&&i[e]||(a?i:o)("Symbol."+e))}).store=n},{"./_global":67,"./_shared":106,"./_uid":116}],119:[function(e,t,r){var n=e("./_classof"),o=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(void 0!=e)return e[o]||e["@@iterator"]||i[n(e)]}},{"./_classof":52,"./_core":57,"./_iterators":82,"./_wks":118}],120:[function(e,t,r){var n=e("./_an-object"),o=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=o(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},{"./_an-object":46,"./_core":57,"./core.get-iterator-method":119}],121:[function(e,t,r){"use strict";var n=e("./_ctx"),o=e("./_export"),i=e("./_to-object"),a=e("./_iter-call"),s=e("./_is-array-iter"),c=e("./_to-length"),u=e("./_create-property"),d=e("./core.get-iterator-method");o(o.S+o.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,o,l,p=i(e),f="function"==typeof this?this:Array,h=arguments.length,m=h>1?arguments[1]:void 0,v=void 0!==m,y=0,_=d(p);if(v&&(m=n(m,h>2?arguments[2]:void 0,2)),void 0==_||f==Array&&s(_))for(t=c(p.length),r=new f(t);t>y;y++)u(r,y,v?m(p[y],y):p[y]);else for(l=_.call(p),r=new f;!(o=l.next()).done;y++)u(r,y,v?a(l,m,[o.value,y],!0):o.value);return r.length=y,r}})},{"./_create-property":58,"./_ctx":59,"./_export":64,"./_is-array-iter":74,"./_iter-call":77,"./_iter-detect":80,"./_to-length":113,"./_to-object":114,"./core.get-iterator-method":119}],122:[function(e,t,r){"use strict";var n=e("./_add-to-unscopables"),o=e("./_iter-step"),i=e("./_iterators"),a=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,o(1)):"keys"==t?o(0,r):"values"==t?o(0,e[r]):o(0,[r,e[r]])},"values"),i.Arguments=i.Array,n("keys"),n("values"),n("entries")},{"./_add-to-unscopables":44,"./_iter-define":79,"./_iter-step":81,"./_iterators":82,"./_to-iobject":112}],123:[function(e,t,r){"use strict";var n=e("./_collection-strong"),o=e("./_validate-collection");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(o(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(o(this,"Map"),0===e?0:e,t)}},n,!0)},{"./_collection":56,"./_collection-strong":54,"./_validate-collection":117}],124:[function(e,t,r){var n=e("./_export");n(n.S+n.F,"Object",{assign:e("./_object-assign")})},{"./_export":64,"./_object-assign":87}],125:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":61,"./_export":64,"./_object-dp":89}],126:[function(e,t,r){arguments[4][33][0].apply(r,arguments)},{dup:33}],127:[function(e,t,r){"use strict";var n,o,i,a,s=e("./_library"),c=e("./_global"),u=e("./_ctx"),d=e("./_classof"),l=e("./_export"),p=e("./_is-object"),f=e("./_a-function"),h=e("./_an-instance"),m=e("./_for-of"),v=e("./_species-constructor"),y=e("./_task").set,_=e("./_microtask")(),g=e("./_new-promise-capability"),b=e("./_perform"),w=e("./_promise-resolve"),k=c.TypeError,P=c.process,S=c.Promise,E="process"==d(P),x=function(){},T=o=g.f,R=!!function(){try{var t=S.resolve(1),r=(t.constructor={})[e("./_wks")("species")]=function(e){e(x,x)};return(E||"function"==typeof PromiseRejectionEvent)&&t.then(x)instanceof r}catch(e){}}(),C=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var r=e._c;_(function(){for(var n=e._v,o=1==e._s,i=0;r.length>i;)!function(t){var r,i,a=o?t.ok:t.fail,s=t.resolve,c=t.reject,u=t.domain;try{a?(o||(2==e._h&&I(e),e._h=1),!0===a?r=n:(u&&u.enter(),r=a(n),u&&u.exit()),r===t.promise?c(k("Promise-chain cycle")):(i=C(r))?i.call(r,s,c):s(r)):c(n)}catch(e){c(e)}}(r[i++]);e._c=[],e._n=!1,t&&!e._h&&j(e)})}},j=function(e){y.call(c,function(){var t,r,n,o=e._v,i=A(e);if(i&&(t=b(function(){E?P.emit("unhandledRejection",o,e):(r=c.onunhandledrejection)?r({promise:e,reason:o}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",o)}),e._h=E||A(e)?2:1),e._a=void 0,i&&t.e)throw t.v})},A=function(e){return 1!==e._h&&0===(e._a||e._c).length},I=function(e){y.call(c,function(){var t;E?P.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},D=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},M=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw k("Promise can't be resolved itself");(t=C(e))?_(function(){var n={_w:r,_d:!1};try{t.call(e,u(M,n,1),u(D,n,1))}catch(e){D.call(n,e)}}):(r._v=e,r._s=1,O(r,!1))}catch(e){D.call({_w:r,_d:!1},e)}}};R||(S=function(e){h(this,S,"Promise","_h"),f(e),n.call(this);try{e(u(M,this,1),u(D,this,1))}catch(e){D.call(this,e)}},n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},n.prototype=e("./_redefine-all")(S.prototype,{then:function(e,t){var r=T(v(this,S));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=E?P.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&O(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n;this.promise=e,this.resolve=u(M,e,1),this.reject=u(D,e,1)},g.f=T=function(e){return e===S||e===a?new i(e):o(e)}),l(l.G+l.W+l.F*!R,{Promise:S}),e("./_set-to-string-tag")(S,"Promise"),e("./_set-species")("Promise"),a=e("./_core").Promise,l(l.S+l.F*!R,"Promise",{reject:function(e){var t=T(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!R),"Promise",{resolve:function(e){return w(s&&this===a?S:this,e)}}),l(l.S+l.F*!(R&&e("./_iter-detect")(function(e){S.all(e).catch(x)})),"Promise",{all:function(e){var t=this,r=T(t),n=r.resolve,o=r.reject,i=b(function(){var r=[],i=0,a=1;m(e,!1,function(e){var s=i++,c=!1;r.push(void 0),a++,t.resolve(e).then(function(e){c||(c=!0,r[s]=e,--a||n(r))},o)}),--a||n(r)});return i.e&&o(i.v),r.promise},race:function(e){var t=this,r=T(t),n=r.reject,o=b(function(){m(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return o.e&&n(o.v),r.promise}})},{"./_a-function":43,"./_an-instance":45,"./_classof":52,"./_core":57,"./_ctx":59,"./_export":64,"./_for-of":66,"./_global":67,"./_is-object":76,"./_iter-detect":80,"./_library":83,"./_microtask":85,"./_new-promise-capability":86,"./_perform":96,"./_promise-resolve":97,"./_redefine-all":99,"./_set-species":103,"./_set-to-string-tag":104,"./_species-constructor":107,"./_task":109,"./_wks":118}],128:[function(e,t,r){"use strict";var n=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":79,"./_string-at":108}],129:[function(e,t,r){e("./_set-collection-from")("Map")},{"./_set-collection-from":101}],130:[function(e,t,r){e("./_set-collection-of")("Map")},{"./_set-collection-of":102}],131:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":55,"./_export":64}],132:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_core"),i=e("./_global"),a=e("./_species-constructor"),s=e("./_promise-resolve");n(n.P+n.R,"Promise",{finally:function(e){var t=a(this,o.Promise||i.Promise),r="function"==typeof e;return this.then(r?function(r){return s(t,e()).then(function(){return r})}:e,r?function(r){return s(t,e()).then(function(){throw r})}:e)}})},{"./_core":57,"./_export":64,"./_global":67,"./_promise-resolve":97,"./_species-constructor":107}],133:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_new-promise-capability"),i=e("./_perform");n(n.S,"Promise",{try:function(e){var t=o.f(this),r=i(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},{"./_export":64,"./_new-promise-capability":86,"./_perform":96}],134:[function(e,t,r){e("./es6.array.iterator");for(var n=e("./_global"),o=e("./_hide"),i=e("./_iterators"),a=e("./_wks")("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var u=s[c],d=n[u],l=d&&d.prototype;l&&!l[a]&&o(l,a,u),i[u]=i.Array}},{"./_global":67,"./_hide":69,"./_iterators":82,"./_wks":118,"./es6.array.iterator":122}],135:[function(e,t,r){(function(n){function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function i(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),t){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,n)}}function a(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}}function c(){var e;try{e=r.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}r=t.exports=e("./debug"),r.log=a,r.formatArgs=i,r.save=s,r.load=c,r.useColors=o,r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(c())}).call(this,e("_process"))},{"./debug":136,_process:193}],136:[function(e,t,r){function n(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}function o(e){function t(){if(t.enabled){var e=t,n=+new Date,i=n-(o||n);e.diff=i,e.prev=o,e.curr=n,o=n;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=r.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;c++;var o=r.formatters[n];if("function"==typeof o){var i=a[c];t=o.call(e,i),a.splice(c,1),c--}return t}),r.formatArgs.call(e,a);(t.log||r.log||console.log.bind(console)).apply(e,a)}}var o;return t.namespace=e,t.enabled=r.enabled(e),t.useColors=r.useColors(),t.color=n(e),t.destroy=i,"function"==typeof r.init&&r.init(t),r.instances.push(t),t}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function a(e){r.save(e),r.names=[],r.skips=[];var t,n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(t=0;t<o;t++)n[t]&&(e=n[t].replace(/\*/g,".*?"),"-"===e[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var i=r.instances[t];i.enabled=r.enabled(i.namespace)}}function s(){r.enable("")}function c(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}r=t.exports=o.debug=o.default=o,r.coerce=u,r.disable=s,r.enable=a,r.enabled=c,r.humanize=e("ms"),r.instances=[],r.names=[],r.skips=[],r.formatters={}},{ms:190}],137:[function(e,t,r){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":138,"engine.io-parser":146}],138:[function(e,t,r){(function(r){function n(e,t){if(!(this instanceof n))return new n(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=d(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=d(t.host).host),this.secure=null!=t.secure?t.secure:r.location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(r.location?location.hostname:"localhost"),this.port=t.port||(r.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode;var o="object"==typeof r&&r;o.global===o&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function o(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var i=e("./transports/index"),a=e("component-emitter"),s=e("debug")("engine.io-client:socket"),c=e("indexof"),u=e("engine.io-parser"),d=e("parseuri"),l=e("parseqs");t.exports=n,n.priorWebsocketSuccess=!1,a(n.prototype),n.protocol=u.protocol,n.Socket=n,n.Transport=e("./transport"),n.transports=e("./transports/index"),n.parser=e("engine.io-parser"),n.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=o(this.query);t.EIO=u.protocol,t.transport=e;var r=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new i[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0})},n.prototype.open=function(){var e;if(this.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},n.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},n.prototype.probe=function(e){function t(){if(p.onlyBinaryUpgrades){var t=!this.supportsBinary&&p.transport.supportsBinary;l=l||t}l||(s('probe transport "%s" opened',e),d.send([{type:"ping",data:"probe"}]),d.once("packet",function(t){if(!l)if("pong"===t.type&&"probe"===t.data){if(s('probe transport "%s" pong',e),p.upgrading=!0,p.emit("upgrading",d),!d)return;n.priorWebsocketSuccess="websocket"===d.name,s('pausing current transport "%s"',p.transport.name),p.transport.pause(function(){l||"closed"!==p.readyState&&(s("changing transport and sending upgrade packet"),u(),p.setTransport(d),d.send([{type:"upgrade"}]),p.emit("upgrade",d),d=null,p.upgrading=!1,p.flush())})}else{s('probe transport "%s" failed',e);var r=new Error("probe error");r.transport=d.name,p.emit("upgradeError",r)}}))}function r(){l||(l=!0,u(),d.close(),d=null)}function o(t){var n=new Error("probe error: "+t);n.transport=d.name,r(),s('probe transport "%s" failed because of error: %s',e,t),p.emit("upgradeError",n)}function i(){o("transport closed")}function a(){o("socket closed")}function c(e){d&&e.name!==d.name&&(s('"%s" works - aborting "%s"',e.name,d.name),r())}function u(){d.removeListener("open",t),d.removeListener("error",o),d.removeListener("close",i),p.removeListener("close",a),p.removeListener("upgrading",c)}s('probing transport "%s"',e)
;var d=this.createTransport(e,{probe:1}),l=!1,p=this;n.priorWebsocketSuccess=!1,d.once("open",t),d.once("error",o),d.once("close",i),this.once("close",a),this.once("upgrading",c),d.open()},n.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},n.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},n.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},n.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},n.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},n.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},n.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},n.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},n.prototype.write=n.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},n.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){r=r||{},r.compress=!1!==r.compress;var o={type:e,data:t,options:r};this.emit("packetCreate",o),this.writeBuffer.push(o),n&&this.once("flush",n),this.flush()}},n.prototype.close=function(){function e(){n.onClose("forced close"),s("socket closing - telling transport to close"),n.transport.close()}function t(){n.removeListener("upgrade",t),n.removeListener("upgradeError",t),e()}function r(){n.once("upgrade",t),n.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var n=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():e()}):this.upgrading?r():e()}return this},n.prototype.onError=function(e){s("socket error %j",e),n.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},n.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},n.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~c(this.transports,e[r])&&t.push(e[r]);return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":139,"./transports/index":140,"component-emitter":35,debug:135,"engine.io-parser":146,indexof:153,parseqs:191,parseuri:192}],139:[function(e,t,r){function n(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var o=e("engine.io-parser"),i=e("component-emitter");t.exports=n,i(n.prototype),n.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},n.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},n.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},n.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},n.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},n.prototype.onData=function(e){var t=o.decodePacket(e,this.socket.binaryType);this.onPacket(t)},n.prototype.onPacket=function(e){this.emit("packet",e)},n.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":35,"engine.io-parser":146}],140:[function(e,t,r){(function(t){function n(e){var r=!1,n=!1,s=!1!==e.jsonp;if(t.location){var c="https:"===location.protocol,u=location.port;u||(u=c?443:80),r=e.hostname!==location.hostname||u!==e.port,n=e.secure!==c}if(e.xdomain=r,e.xscheme=n,"open"in new o(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new a(e)}var o=e("xmlhttprequest-ssl"),i=e("./polling-xhr"),a=e("./polling-jsonp"),s=e("./websocket");r.polling=n,r.websocket=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":141,"./polling-xhr":142,"./websocket":144,"xmlhttprequest-ssl":145}],141:[function(e,t,r){(function(r){function n(){}function o(e){i.call(this,e),this.query=this.query||{},s||(r.___eio||(r.___eio=[]),s=r.___eio),this.index=s.length;var t=this;s.push(function(e){t.onData(e)}),this.query.j=this.index,r.document&&r.addEventListener&&r.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=n)},!1)}var i=e("./polling"),a=e("component-inherit");t.exports=o;var s,c=/\n/g,u=/\\n/g;a(o,i),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),i.prototype.doClose.call(this)},o.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},o.prototype.doWrite=function(e,t){function r(){n(),t()}function n(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(e){o.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+o.iframeId+'">';i=document.createElement(e)}catch(e){i=document.createElement("iframe"),i.name=o.iframeId,i.src="javascript:0"}i.id=o.iframeId,o.form.appendChild(i),o.iframe=i}var o=this;if(!this.form){var i,a=document.createElement("form"),s=document.createElement("textarea"),d=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=d,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),n(),e=e.replace(u,"\\\n"),this.area.value=e.replace(c,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===o.iframe.readyState&&r()}:this.iframe.onload=r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":143,"component-inherit":36}],142:[function(e,t,r){(function(r){function n(){}function o(e){if(c.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,r.location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd=e.hostname!==r.location.hostname||n!==e.port,this.xs=e.secure!==t}}function i(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function a(){for(var e in i.requests)i.requests.hasOwnProperty(e)&&i.requests[e].abort()}var s=e("xmlhttprequest-ssl"),c=e("./polling"),u=e("component-emitter"),d=e("component-inherit"),l=e("debug")("engine.io-client:polling-xhr");t.exports=o,t.exports.Request=i,d(o,c),o.prototype.supportsBinary=!0,o.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new i(e)},o.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),o=this;n.on("success",t),n.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=n},o.prototype.doPoll=function(){l("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},u(i.prototype),i.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new s(e),n=this;try{l("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(var o in this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&t.setRequestHeader(o,this.extraHeaders[o])}}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout(function(){n.onError(t.status)},0))},l("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){n.onError(e)},0)}r.document&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},i.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},i.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=n:this.xhr.onreadystatechange=n,e)try{this.xhr.abort()}catch(e){}r.document&&delete i.requests[this.index],this.xhr=null}},i.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},i.prototype.hasXDR=function(){return void 0!==r.XDomainRequest&&!this.xs&&this.enablesXDR},i.prototype.abort=function(){this.cleanup()},i.requestsCount=0,i.requests={},r.document&&(r.attachEvent?r.attachEvent("onunload",a):r.addEventListener&&r.addEventListener("beforeunload",a,!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":143,"component-emitter":35,"component-inherit":36,debug:135,"xmlhttprequest-ssl":145}],143:[function(e,t,r){function n(e){var t=e&&e.forceBase64;d&&!t||(this.supportsBinary=!1),o.call(this,e)}var o=e("../transport"),i=e("parseqs"),a=e("engine.io-parser"),s=e("component-inherit"),c=e("yeast"),u=e("debug")("engine.io-client:polling");t.exports=n;var d=function(){return null!=new(e("xmlhttprequest-ssl"))({xdomain:!1}).responseType}();s(n,o),n.prototype.name="polling",n.prototype.doOpen=function(){this.poll()},n.prototype.pause=function(e){function t(){u("paused"),r.readyState="paused",e()}var r=this;if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(u("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){u("pre-pause polling complete"),--n||t()})),this.writable||(u("we are currently writing - waiting to pause"),n++,this.once("drain",function(){u("pre-pause writing complete"),--n||t()}))}else t()},n.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},n.prototype.onData=function(e){var t=this;u("polling got data %s",e);var r=function(e,r,n){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)};a.decodePayload(e,this.socket.binaryType,r),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},n.prototype.doClose=function(){function e(){u("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(u("transport open - closing"),e()):(u("transport not open - deferring close"),this.once("open",e))},n.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};a.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},{"../transport":139,"component-inherit":36,debug:135,"engine.io-parser":146,parseqs:191,"xmlhttprequest-ssl":145,yeast:223}],144:[function(e,t,r){(function(r){function n(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=l&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(p=o),i.call(this,e)}var o,i=e("../transport"),a=e("engine.io-parser"),s=e("parseqs"),c=e("component-inherit"),u=e("yeast"),d=e("debug")("engine.io-client:websocket"),l=r.WebSocket||r.MozWebSocket;if("undefined"==typeof window)try{o=e("ws")}catch(e){}var p=l;p||"undefined"!=typeof window||(p=o),t.exports=n,c(n,i),n.prototype.name="websocket",n.prototype.supportsBinary=!0,n.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new p(e,t):new p(e):new p(e,t,r)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},n.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},n.prototype.write=function(e){function t(){n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0)}var n=this;this.writable=!1;for(var o=e.length,i=0,s=o;i<s;i++)!function(e){a.encodePacket(e,n.supportsBinary,function(i){if(!n.usingBrowserWebSocket){var a={};if(e.options&&(a.compress=e.options.compress),n.perMessageDeflate){("string"==typeof i?r.Buffer.byteLength(i):i.length)<n.perMessageDeflate.threshold&&(a.compress=!1)}}try{n.usingBrowserWebSocket?n.ws.send(i):n.ws.send(i,a)}catch(e){d("websocket closed before onclose event")}--o||t()})}(e[i])},n.prototype.onClose=function(){i.prototype.onClose.call(this)},n.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=u()),this.supportsBinary||(e.b64=1),e=s.encode(e),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},n.prototype.check=function(){return!(!p||"__initialize"in p&&this.name===n.prototype.name)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../transport":139,"component-inherit":36,debug:135,"engine.io-parser":146,parseqs:191,ws:33,yeast:223}],145:[function(e,t,r){(function(r){var n=e("has-cors");t.exports=function(e){var t=e.xdomain,o=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!o&&i)return new XDomainRequest}catch(e){}if(!t)try{return new(r[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"has-cors":152}],146:[function(e,t,r){(function(t){function n(e,t){return t("b"+r.packets[e.type]+e.data.data)}function o(e,t,n){if(!t)return r.encodeBase64Packet(e,n);var o=e.data,i=new Uint8Array(o),a=new Uint8Array(1+o.byteLength);a[0]=_[e.type];for(var s=0;s<i.length;s++)a[s+1]=i[s];return n(a.buffer)}function i(e,t,n){if(!t)return r.encodeBase64Packet(e,n);var o=new FileReader;return o.onload=function(){e.data=o.result,r.encodePacket(e,t,!0,n)},o.readAsArrayBuffer(e.data)}function a(e,t,n){if(!t)return r.encodeBase64Packet(e,n);if(y)return i(e,t,n);var o=new Uint8Array(1);return o[0]=_[e.type],n(new w([o.buffer,e.data]))}function s(e){try{e=h.decode(e,{strict:!1})}catch(e){return!1}return e}function c(e,t,r){for(var n=new Array(e.length),o=f(e.length,r),i=0;i<e.length;i++)!function(e,r,o){t(r,function(t,r){n[e]=r,o(t,n)})}(i,e[i],o)}var u,d=e("./keys"),l=e("has-binary2"),p=e("arraybuffer.slice"),f=e("after"),h=e("./utf8");t&&t.ArrayBuffer&&(u=e("base64-arraybuffer"));var m="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),v="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),y=m||v;r.protocol=3;var _=r.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},g=d(_),b={type:"error",data:"parser error"},w=e("blob");r.encodePacket=function(e,r,i,s){"function"==typeof r&&(s=r,r=!1),"function"==typeof i&&(s=i,i=null);var c=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&c instanceof ArrayBuffer)return o(e,r,s);if(w&&c instanceof t.Blob)return a(e,r,s);if(c&&c.base64)return n(e,s);var u=_[e.type];return void 0!==e.data&&(u+=i?h.encode(String(e.data),{strict:!1}):String(e.data)),s(""+u)},r.encodeBase64Packet=function(e,n){var o="b"+r.packets[e.type];if(w&&e.data instanceof t.Blob){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(o+e)},i.readAsDataURL(e.data)}var a;try{a=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),c=new Array(s.length),u=0;u<s.length;u++)c[u]=s[u];a=String.fromCharCode.apply(null,c)}return o+=t.btoa(a),n(o)},r.decodePacket=function(e,t,n){if(void 0===e)return b;if("string"==typeof e){if("b"===e.charAt(0))return r.decodeBase64Packet(e.substr(1),t);if(n&&!1===(e=s(e)))return b;var o=e.charAt(0);return Number(o)==o&&g[o]?e.length>1?{type:g[o],data:e.substring(1)}:{type:g[o]}:b}var i=new Uint8Array(e),o=i[0],a=p(e,1);return w&&"blob"===t&&(a=new w([a])),{type:g[o],data:a}},r.decodeBase64Packet=function(e,t){var r=g[e.charAt(0)];if(!u)return{type:r,data:{base64:!0,data:e.substr(1)}};var n=u.decode(e.substr(1));return"blob"===t&&w&&(n=new w([n])),{type:r,data:n}},r.encodePayload=function(e,t,n){function o(e){return e.length+":"+e}function i(e,n){r.encodePacket(e,!!a&&t,!1,function(e){n(null,o(e))})}"function"==typeof t&&(n=t,t=null);var a=l(e);return t&&a?w&&!y?r.encodePayloadAsBlob(e,n):r.encodePayloadAsArrayBuffer(e,n):e.length?void c(e,i,function(e,t){return n(t.join(""))}):n("0:")},r.decodePayload=function(e,t,n){if("string"!=typeof e)return r.decodePayloadAsBinary(e,t,n);"function"==typeof t&&(n=t,t=null);var o;if(""===e)return n(b,0,1);for(var i,a,s="",c=0,u=e.length;c<u;c++){var d=e.charAt(c);if(":"===d){if(""===s||s!=(i=Number(s)))return n(b,0,1);if(a=e.substr(c+1,i),s!=a.length)return n(b,0,1);if(a.length){if(o=r.decodePacket(a,t,!1),b.type===o.type&&b.data===o.data)return n(b,0,1);if(!1===n(o,c+i,u))return}c+=i,s=""}else s+=d}return""!==s?n(b,0,1):void 0},r.encodePayloadAsArrayBuffer=function(e,t){function n(e,t){r.encodePacket(e,!0,!0,function(e){return t(null,e)})}if(!e.length)return t(new ArrayBuffer(0));c(e,n,function(e,r){var n=r.reduce(function(e,t){var r;return r="string"==typeof t?t.length:t.byteLength,e+r.toString().length+r+2},0),o=new Uint8Array(n),i=0;return r.forEach(function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),a=0;a<e.length;a++)n[a]=e.charCodeAt(a);r=n.buffer}o[i++]=t?0:1;for(var s=r.byteLength.toString(),a=0;a<s.length;a++)o[i++]=parseInt(s[a]);o[i++]=255;for(var n=new Uint8Array(r),a=0;a<n.length;a++)o[i++]=n[a]}),t(o.buffer)})},r.encodePayloadAsBlob=function(e,t){function n(e,t){r.encodePacket(e,!0,!0,function(e){var r=new Uint8Array(1);if(r[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);e=n.buffer,r[0]=0}for(var i=e instanceof ArrayBuffer?e.byteLength:e.size,a=i.toString(),s=new Uint8Array(a.length+1),o=0;o<a.length;o++)s[o]=parseInt(a[o]);if(s[a.length]=255,w){var c=new w([r.buffer,s.buffer,e]);t(null,c)}})}c(e,n,function(e,r){return t(new w(r))})},r.decodePayloadAsBinary=function(e,t,n){"function"==typeof t&&(n=t,t=null);for(var o=e,i=[];o.byteLength>0;){for(var a=new Uint8Array(o),s=0===a[0],c="",u=1;255!==a[u];u++){if(c.length>310)return n(b,0,1);c+=a[u]}o=p(o,2+c.length),c=parseInt(c);var d=p(o,0,c);if(s)try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(e){var l=new Uint8Array(d);d="";for(var u=0;u<l.length;u++)d+=String.fromCharCode(l[u])}i.push(d),o=p(o,c)}var f=i.length;i.forEach(function(e,o){n(r.decodePacket(e,t,!0),o,f)})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":147,"./utf8":148,after:16,"arraybuffer.slice":17,"base64-arraybuffer":30,blob:31,"has-binary2":150}],147:[function(e,t,r){t.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},{}],148:[function(t,r,n){(function(t){!function(o){function i(e){for(var t,r,n=[],o=0,i=e.length;o<i;)t=e.charCodeAt(o++),t>=55296&&t<=56319&&o<i?(r=e.charCodeAt(o++),56320==(64512&r)?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--)):n.push(t);return n}function a(e){for(var t,r=e.length,n=-1,o="";++n<r;)t=e[n],t>65535&&(t-=65536,o+=b(t>>>10&1023|55296),t=56320|1023&t),o+=b(t);return o}function s(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function c(e,t){return b(e>>t&63|128)}function u(e,t){if(0==(4294967168&e))return b(e);var r="";return 0==(4294965248&e)?r=b(e>>6&31|192):0==(4294901760&e)?(s(e,t)||(e=65533),r=b(e>>12&15|224),r+=c(e,6)):0==(4292870144&e)&&(r=b(e>>18&7|240),r+=c(e,12),r+=c(e,6)),r+=b(63&e|128)}function d(e,t){t=t||{};for(var r,n=!1!==t.strict,o=i(e),a=o.length,s=-1,c="";++s<a;)r=o[s],c+=u(r,n);return c}function l(){if(g>=_)throw Error("Invalid byte index");var e=255&y[g];if(g++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function p(e){var t,r,n,o,i;if(g>_)throw Error("Invalid byte index");if(g==_)return!1;if(t=255&y[g],g++,0==(128&t))return t;if(192==(224&t)){if(r=l(),(i=(31&t)<<6|r)>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&t)){if(r=l(),n=l(),(i=(15&t)<<12|r<<6|n)>=2048)return s(i,e)?i:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(r=l(),n=l(),o=l(),(i=(7&t)<<18|r<<12|n<<6|o)>=65536&&i<=1114111))return i;throw Error("Invalid UTF-8 detected")}function f(e,t){t=t||{};var r=!1!==t.strict;y=i(e),_=y.length,g=0;for(var n,o=[];!1!==(n=p(r));)o.push(n);return a(o)}var h="object"==typeof n&&n,m="object"==typeof r&&r&&r.exports==h&&r,v="object"==typeof t&&t;v.global!==v&&v.window!==v||(o=v);var y,_,g,b=String.fromCharCode,w={version:"2.1.2",encode:d,decode:f};if("function"==typeof e&&"object"==typeof e.amd&&e.amd)e(function(){return w});else if(h&&!h.nodeType)if(m)m.exports=w;else{var k={},P=k.hasOwnProperty;for(var S in w)P.call(w,S)&&(h[S]=w[S])}else o.utf8=w}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],149:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function i(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,i,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(r=this._events[e],s(r))return!1;if(o(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),r.apply(this,i)}else if(a(r))for(i=Array.prototype.slice.call(arguments,1),u=r.slice(),n=u.length,c=0;c<n;c++)u[c].apply(this,i);return!0},n.prototype.addListener=function(e,t){var r;if(!o(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,i,s;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],i=r.length,n=-1,r===t||o(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(r)){for(s=i;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){n=s;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],o(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(o(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],150:[function(e,t,r){(function(r){function n(e){if(!e||"object"!=typeof e)return!1;if(o(e)){for(var t=0,i=e.length;t<i;t++)if(n(e[t]))return!0;return!1}if("function"==typeof r.Buffer&&r.Buffer.isBuffer&&r.Buffer.isBuffer(e)||"function"==typeof r.ArrayBuffer&&e instanceof ArrayBuffer||a&&e instanceof Blob||s&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return n(e.toJSON(),!0);for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)&&n(e[c]))return!0;return!1}var o=e("isarray"),i=Object.prototype.toString,a="function"==typeof r.Blob||"[object BlobConstructor]"===i.call(r.Blob),s="function"==typeof r.File||"[object FileConstructor]"===i.call(r.File);t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:151}],151:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],152:[function(e,t,r){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},{}],153:[function(e,t,r){var n=[].indexOf;t.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},{}],154:[function(e,t,r){var n=e("./_root"),o=n.Symbol;t.exports=o},{"./_root":161}],155:[function(e,t,r){function n(e){
return null==e?void 0===e?c:s:u&&u in Object(e)?i(e):a(e)}var o=e("./_Symbol"),i=e("./_getRawTag"),a=e("./_objectToString"),s="[object Null]",c="[object Undefined]",u=o?o.toStringTag:void 0;t.exports=n},{"./_Symbol":154,"./_getRawTag":158,"./_objectToString":159}],156:[function(e,t,r){(function(e){var r="object"==typeof e&&e&&e.Object===Object&&e;t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],157:[function(e,t,r){var n=e("./_overArg"),o=n(Object.getPrototypeOf,Object);t.exports=o},{"./_overArg":160}],158:[function(e,t,r){function n(e){var t=a.call(e,c),r=e[c];try{e[c]=void 0;var n=!0}catch(e){}var o=s.call(e);return n&&(t?e[c]=r:delete e[c]),o}var o=e("./_Symbol"),i=Object.prototype,a=i.hasOwnProperty,s=i.toString,c=o?o.toStringTag:void 0;t.exports=n},{"./_Symbol":154}],159:[function(e,t,r){function n(e){return i.call(e)}var o=Object.prototype,i=o.toString;t.exports=n},{}],160:[function(e,t,r){function n(e,t){return function(r){return e(t(r))}}t.exports=n},{}],161:[function(e,t,r){var n=e("./_freeGlobal"),o="object"==typeof self&&self&&self.Object===Object&&self,i=n||o||Function("return this")();t.exports=i},{"./_freeGlobal":156}],162:[function(e,t,r){function n(e){return null!=e&&"object"==typeof e}t.exports=n},{}],163:[function(e,t,r){function n(e){if(!a(e)||o(e)!=s)return!1;var t=i(e);if(null===t)return!0;var r=l.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&d.call(r)==p}var o=e("./_baseGetTag"),i=e("./_getPrototype"),a=e("./isObjectLike"),s="[object Object]",c=Function.prototype,u=Object.prototype,d=c.toString,l=u.hasOwnProperty,p=d.call(Object);t.exports=n},{"./_baseGetTag":155,"./_getPrototype":157,"./isObjectLike":162}],164:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=e("events"),c=e("./Logger"),u=function(e){return e&&e.__esModule?e:{default:e}}(c),d=e("./errors"),l=new u.default("CommandQueue"),p=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}return i(t,e),a(t,[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var r=this,n=Object.assign({method:e},t);return l.debug("push() [method:%s]",e),new Promise(function(e,t){var o=r._queue;n.resolve=e,n.reject=t,o.push(n),r._handlePendingCommands()})}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then(function(){e._busy=!1,t.shift(),e._handlePendingCommands()}))}}},{key:"_handleCommand",value:function(e){var t=this;if(l.debug("_handleCommand() [method:%s]",e.method),this._closed)return e.reject(new d.InvalidStateError("closed")),Promise.resolve();var r={promise:null};return this.emit("exec",e,r),Promise.resolve().then(function(){return r.promise}).then(function(r){if(l.debug("_handleCommand() | command succeeded [method:%s]",e.method),t._closed)return void e.reject(new d.InvalidStateError("closed"));e.resolve(r)}).catch(function(t){l.error("_handleCommand() | command failed [method:%s]: %o",e.method,t),e.reject(t)})}}]),t}(s.EventEmitter);r.default=p},{"./Logger":168,"./errors":173,events:149}],165:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./Logger"),d=n(u),l=e("./EnhancedEventEmitter"),p=n(l),f=e("./errors"),h=new Set(["default","low","medium","high"]),m=1e3,v=new d.default("Consumer"),y=function(e){function t(e,r,n,a,s){o(this,t);var c=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,v));return c._id=e,c._closed=!1,c._kind=r,c._rtpParameters=n,c._peer=a,c._appData=s,c._supported=!1,c._transport=null,c._track=null,c._locallyPaused=!1,c._remotelyPaused=!1,c._statsEnabled=!1,c._statsInterval=m,c._preferredProfile="default",c._effectiveProfile=null,c}return a(t,e),c(t,[{key:"close",value:function(){v.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit("@close"),this.safeEmit("close","local"),this._destroy())}},{key:"remoteClose",value:function(){v.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit("@close"),this.safeEmit("close","remote"))}},{key:"_destroy",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:"receive",value:function(e){var t=this;return v.debug("receive() [transport:%o]",e),this._closed?Promise.reject(new f.InvalidStateError("Consumer closed")):this._supported?this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":s(e))?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addConsumer(this).then(function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once("@close",function(){if(!t._closed&&t._transport===e){t._transport=null;try{t._track.stop()}catch(e){}t._track=null,t.safeEmit("unhandled")}}),t.safeEmit("handled"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r}).catch(function(e){throw t._transport=null,e})):Promise.reject(new Error("unsupported codecs"))}},{key:"pause",value:function(e){return v.debug("pause()"),this._closed?(v.error("pause() | Consumer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){v.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return v.debug("resume()"),this._closed?(v.error("resume() | Consumer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){v.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"setPreferredProfile",value:function(e){if(v.debug("setPreferredProfile() [profile:%s]",e),this._closed)return void v.error("setPreferredProfile() | Consumer closed");if(e!==this._preferredProfile){if(!h.has(e))return void v.error('setPreferredProfile() | invalid profile "%s"',e);this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)}}},{key:"remoteSetPreferredProfile",value:function(e){v.debug("remoteSetPreferredProfile() [profile:%s]",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:"remoteEffectiveProfileChanged",value:function(e){v.debug("remoteEffectiveProfileChanged() [profile:%s]",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit("effectiveprofilechange",this._effectiveProfile))}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m;if(v.debug("enableStats() [interval:%s]",e),this._closed)return void v.error("enableStats() | Consumer closed");this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?m:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){if(v.debug("disableStats()"),this._closed)return void v.error("disableStats() | Consumer closed");this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:"setSupported",value:function(e){this._supported=e}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"peer",get:function(){return this._peer}},{key:"appData",get:function(){return this._appData}},{key:"supported",get:function(){return this._supported}},{key:"transport",get:function(){return this._transport}},{key:"track",get:function(){return this._track}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"preferredProfile",get:function(){return this._preferredProfile}},{key:"effectiveProfile",get:function(){return this._effectiveProfile}}]),t}(p.default);r.default=y},{"./EnhancedEventEmitter":167,"./Logger":168,"./errors":173}],166:[function(e,t,r){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("bowser"),s=n(a),c=e("./Logger"),u=n(c),d=e("./handlers/Chrome55"),l=n(d),p=e("./handlers/Chrome67"),f=n(p),h=e("./handlers/Safari11"),m=n(h),v=e("./handlers/Firefox50"),y=n(v),_=e("./handlers/Firefox59"),g=n(_),b=e("./handlers/Edge11"),w=n(b),k=e("./handlers/ReactNative"),P=n(k),S=new u.default("Device"),E=function(){function e(){o(this,e)}return i(e,null,[{key:"getFlag",value:function(){return e._detected||e._detect(),e._flag}},{key:"getName",value:function(){return e._detected||e._detect(),e._name}},{key:"getVersion",value:function(){return e._detected||e._detect(),e._version}},{key:"getBowser",value:function(){return e._detected||e._detect(),e._bowser}},{key:"isSupported",value:function(){return e._detected||e._detect(),Boolean(e._handlerClass)}},{key:"_detect",value:function(){if(e._detected=!0,t.navigator&&"ReactNative"===t.navigator.product)e._flag="react-native",e._name="ReactNative",e._version=void 0,e._bowser={},e._handlerClass=P.default;else if(t.navigator&&"string"==typeof t.navigator.userAgent){var r=t.navigator.userAgent,n=s.default.detect(r);e._flag=void 0,e._name=n.name||void 0,e._version=n.version||void 0,e._bowser=n,e._handlerClass=null,s.default.check({chrome:"67",chromium:"67"},!0,r)?(e._flag="chrome",e._handlerClass=f.default):s.default.check({chrome:"55",chromium:"55"},!0,r)?(e._flag="chrome",e._handlerClass=l.default):s.default.check({firefox:"59"},!0,r)?(e._flag="firefox",e._handlerClass=g.default):s.default.check({firefox:"50"},!0,r)?(e._flag="firefox",e._handlerClass=y.default):s.default.check({safari:"11"},!0,r)?(e._flag="safari",e._handlerClass=m.default):s.default.check({msedge:"11"},!0,r)&&(e._flag="msedge",e._handlerClass=w.default),s.default.check({opera:"44"},!0,r)&&(e._flag="opera",e._handlerClass=l.default),e.isSupported()?S.debug('browser supported [flag:%s, name:"%s", version:%s, handler:%s]',e._flag,e._name,e._version,e._handlerClass.tag):S.warn("browser not supported [name:%s, version:%s]",e._name,e._version)}else S.warn("device not supported")}},{key:"Handler",get:function(){return e._detected||e._detect(),e._handlerClass}}]),e}();r.default=E,E._detected=!1,E._flag=void 0,E._name=void 0,E._version=void 0,E._bowser=void 0,E._handlerClass=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Logger":168,"./handlers/Chrome55":174,"./handlers/Chrome67":175,"./handlers/Edge11":176,"./handlers/Firefox50":177,"./handlers/Firefox59":178,"./handlers/ReactNative":179,"./handlers/Safari11":180,bowser:32}],167:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=e("events"),c=e("./Logger"),u=function(e){return e&&e.__esModule?e:{default:e}}(c),d=function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setMaxListeners(1/0),r._logger=e||new u.default("EnhancedEventEmitter"),r}return i(t,e),a(t,[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return new Promise(function(r,o){var i=function(e){r(e)},a=function(r){t._logger.error("safeEmitAsPromise() | errback called [event:%s]:%o",e,r),o(r)};t.safeEmit.apply(t,[e].concat(n,[i,a]))})}}]),t}(s.EventEmitter);r.default=d},{"./Logger":168,events:149}],168:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=e("debug"),a=function(e){return e&&e.__esModule?e:{default:e}}(i),s="mediasoup-client",c=function(){function e(t){n(this,e),t?(this._debug=(0,a.default)(s+":"+t),this._warn=(0,a.default)(s+":WARN:"+t),this._error=(0,a.default)(s+":ERROR:"+t)):(this._debug=(0,a.default)(s),this._warn=(0,a.default)(s+":WARN"),this._error=(0,a.default)(s+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return o(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}();r.default=c},{debug:135}],169:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=e("./Logger"),u=n(c),d=e("./EnhancedEventEmitter"),l=n(d),p=new u.default("Peer"),f=function(e){function t(e,r){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,p));return n._name=e,n._closed=!1,n._appData=r,n._consumers=new Map,n}return a(t,e),s(t,[{key:"close",value:function(){if(p.debug("close()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","local");var e=!0,t=!1,r=void 0;try{for(var n,o=this._consumers.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.close()}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}}},{key:"remoteClose",value:function(e){if(p.debug("remoteClose()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,i=this._consumers.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}}}},{key:"getConsumerById",value:function(e){return this._consumers.get(e)}},{key:"addConsumer",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error("Consumer already exists [id:"+e.id+"]");this._consumers.set(e.id,e),e.on("@close",function(){t._consumers.delete(e.id)}),this.safeEmit("newconsumer",e)}},{key:"name",get:function(){return this._name}},{key:"closed",get:function(){return this._closed}},{key:"appData",get:function(){return this._appData}},{key:"consumers",get:function(){return Array.from(this._consumers.values())}}]),t}(l.default);r.default=f},{"./EnhancedEventEmitter":167,"./Logger":168}],170:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./Logger"),d=n(u),l=e("./EnhancedEventEmitter"),p=n(l),f=e("./errors"),h=e("./utils"),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(h),v=1e3,y={low:1e5,medium:3e5,high:15e5},_=new d.default("Producer"),g=function(e){function t(e,r,n){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,_));a._id=m.randomNumber(),a._closed=!1,a._originalTrack=e;try{a._track=e.clone()}catch(t){a._track=e}return a._appData=n,a._simulcast=!1,"object"===s(r.simulcast)?a._simulcast=Object.assign({},y,r.simulcast):!0===r.simulcast&&(a._simulcast=Object.assign({},y)),a._transport=null,a._rtpParameters=null,a._locallyPaused=!a._track.enabled,a._remotelyPaused=!1,a._statsEnabled=!1,a._statsInterval=v,a._handleTrack(),a}return a(t,e),c(t,[{key:"close",value:function(e){_.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,"local",e),this._destroy(),this.emit("@close","local",e),this.safeEmit("close","local",e))}},{key:"remoteClose",value:function(e){_.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,"remote",e),this._destroy(),this.emit("@close","remote",e),this.safeEmit("close","remote",e))}},{key:"_destroy",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:"send",value:function(e){var t=this;return _.debug("send() [transport:%o]",e),this._closed?Promise.reject(new f.InvalidStateError("Producer closed")):this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":s(e))?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addProducer(this).then(function(){e.once("@close",function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,"local"),t._transport=null,t._rtpParameters=null,t.safeEmit("unhandled"))}),t.safeEmit("handled"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)}).catch(function(e){throw t._transport=null,e}))}},{key:"pause",value:function(e){return _.debug("pause()"),this._closed?(_.error("pause() | Producer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){_.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return _.debug("resume()"),this._closed?(_.error("resume() | Producer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){_.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"replaceTrack",value:function(e){var t=this;if(_.debug("replaceTrack() [track:%o]",e),this._closed)return Promise.reject(new f.InvalidStateError("Producer closed"));if(!(e instanceof MediaStreamTrack))return Promise.reject(new TypeError("track is not a MediaStreamTrack"));if("ended"===e.readyState)return Promise.reject(new Error('track.readyState is "ended"'));var r=void 0;try{r=e.clone()}catch(t){r=e}return Promise.resolve().then(function(){if(t._transport)return t._transport.replaceProducerTrack(t,r)}).then(function(){try{t._track.onended=null,t._track.stop()}catch(e){}return t.paused?r.enabled=!1:r.enabled=!0,t._originalTrack=e,t._track=r,t._handleTrack(),t._track})}},{key:"setRtpParameters",value:function(e){this._rtpParameters=e}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;if(_.debug("enableStats() [interval:%s]",e),this._closed)return void _.error("enableStats() | Producer closed");this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?v:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){if(_.debug("disableStats()"),this._closed)return void _.error("disableStats() | Producer closed");this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_handleTrack",value:function(){var e=this;this._track.onended=function(){e._closed||(_.warn('track "ended" event'),e.safeEmit("trackended"))}}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"track",get:function(){return this._track}},{key:"originalTrack",get:function(){return this._originalTrack}},{key:"simulcast",get:function(){return this._simulcast}},{key:"appData",get:function(){return this._appData}},{key:"transport",get:function(){return this._transport}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}}]),t}(p.default);r.default=g},{"./EnhancedEventEmitter":167,"./Logger":168,"./errors":173,"./utils":189}],171:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./Logger"),d=n(u),l=e("./EnhancedEventEmitter"),p=n(l),f=e("./errors"),h=e("./ortc"),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(h),v=e("./Device"),y=n(v),_=e("./Transport"),g=n(_),b=e("./Producer"),w=n(b),k=e("./Peer"),P=n(k),S=e("./Consumer"),E=n(S),x=new d.default("Room"),T={new:"new",joining:"joining",joined:"joined",closed:"closed"},R=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,x));if(x.debug("constructor() [options:%o]",e),!y.default.isSupported())throw new Error("current browser/device not supported");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||1e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[]},r._state=T.new,r._peerName=null,r._transports=new Map,r._producers=new Map,r._peers=new Map,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}return a(t,e),c(t,[{key:"getTransportById",value:function(e){return this._transports.get(e)}},{key:"getProducerById",value:function(e){return this._producers.get(e)}},{key:"getPeerByName",value:function(e){return this._peers.get(e)}},{key:"join",value:function(e,t){var r=this;if(x.debug('join() [peerName:"%s"]',e),"string"!=typeof e)return Promise.reject(new TypeError("invalid peerName"));if(this._state!==T.new&&this._state!==T.closed)return Promise.reject(new f.InvalidStateError('invalid state "'+this._state+'"'));this._peerName=e,this._state=T.joining;var n=void 0;return Promise.resolve().then(function(){return r._settings.roomSettings?void(n=r._settings.roomSettings):r._sendRequest("queryRoom",{target:"room"}).then(function(e){n=e,x.debug("join() | got Room settings:%o",n)})}).then(function(){return y.default.Handler.getNativeRtpCapabilities()}).then(function(e){x.debug("join() | native RTP capabilities:%o",e),r._extendedRtpCapabilities=m.getExtendedRtpCapabilities(e,n.rtpCapabilities),x.debug("join() | extended RTP capabilities:%o",r._extendedRtpCapabilities);var o=m.getUnsupportedCodecs(n.rtpCapabilities,n.mandatoryCodecPayloadTypes,r._extendedRtpCapabilities);if(o.length>0)throw x.error("%s mandatory room codecs not supported:%o",o.length,o),new f.UnsupportedError("mandatory room codecs not supported",o);r._canSendByKind.audio=m.canSend("audio",r._extendedRtpCapabilities),r._canSendByKind.video=m.canSend("video",r._extendedRtpCapabilities);var i=m.getRtpCapabilities(r._extendedRtpCapabilities);x.debug("join() | effective local RTP capabilities for receiving:%o",i);var a={target:"room",peerName:r._peerName,rtpCapabilities:i,appData:t};return r._sendRequest("join",a).then(function(e){return e.peers})}).then(function(e){var t=!0,n=!1,o=void 0;try{for(var i,a=(e||[])[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;try{r._handlePeerData(s)}catch(e){x.error("join() | error handling Peer:%o",e)}}}catch(e){n=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw o}}return r._state=T.joined,x.debug("join() | joined the Room"),r.peers}).catch(function(e){throw r._state=T.new,e})}},{key:"leave",value:function(e){if(x.debug("leave()"),!this.closed){this._sendNotification("leave",{appData:e}),this._state=T.closed,this.safeEmit("close","local",e);var t=!0,r=!1,n=void 0;try{for(var o,i=this._transports.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.close()}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}var a=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){u.value.close()}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var h,m=this._peers.values()[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){h.value.close()}}catch(e){p=!0,f=e}finally{try{!l&&m.return&&m.return()}finally{if(p)throw f}}}}},{key:"remoteClose",value:function(e){if(x.debug("remoteClose()"),!this.closed){this._state=T.closed,this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,i=this._transports.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}var a=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){u.value.remoteClose()}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var h,m=this._peers.values()[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){h.value.remoteClose()}}catch(e){p=!0,f=e}finally{try{!l&&m.return&&m.return()}finally{if(p)throw f}}}}},{key:"canSend",value:function(e){if(!this.joined)throw new f.InvalidStateError('invalid state "'+this._state+'"')
;if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'+e+'"');return this._canSendByKind[e]}},{key:"createTransport",value:function(e,t){var r=this;if(x.debug("createTransport() [direction:%s]",e),!this.joined)throw new f.InvalidStateError('invalid state "'+this._state+'"');if("send"!==e&&"recv"!==e)throw new TypeError('invalid direction "'+e+'"');var n=new g.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on("@request",function(e,t,n,o){r._sendRequest(e,t).then(n).catch(o)}),n.on("@notify",function(e,t){r._sendNotification(e,t)}),n.on("@close",function(){r._transports.delete(n.id)}),n}},{key:"createProducer",value:function(e,t,r){var n=this;if(x.debug("createProducer() [track:%o, options:%o]",e,t),!this.joined)throw new f.InvalidStateError('invalid state "'+this._state+'"');if(!(e instanceof MediaStreamTrack))throw new TypeError("track is not a MediaStreamTrack");if(!this._canSendByKind[e.kind])throw new Error("cannot send "+e.kind);if("ended"===e.readyState)throw new Error('track.readyState is "ended"');t=t||{};var o=new w.default(e,t,r);return this._producers.set(o.id,o),o.on("@close",function(){n._producers.delete(o.id)}),o}},{key:"restartIce",value:function(){if(!this.joined)throw new f.InvalidStateError('invalid state "'+this._state+'"');var e=!0,t=!1,r=void 0;try{for(var n,o=this._transports.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.restartIce()}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}},{key:"receiveNotification",value:function(e){var t=this;if(this.closed)return Promise.reject(new f.InvalidStateError("Room closed"));if("object"!==(void 0===e?"undefined":s(e)))return Promise.reject(new TypeError("wrong notification Object"));if(!0!==e.notification)return Promise.reject(new TypeError("not a notification"));if("string"!=typeof e.method)return Promise.reject(new TypeError("wrong/missing notification method"));var r=e.method;return x.debug("receiveNotification() [method:%s, notification:%o]",r,e),Promise.resolve().then(function(){switch(r){case"closed":var n=e.appData;t.remoteClose(n);break;case"transportClosed":var o=e.id,i=e.appData,a=t._transports.get(o);if(!a)throw new Error('Transport not found [id:"'+o+'"]');a.remoteClose(i);break;case"transportStats":var s=e.id,c=e.stats,u=t._transports.get(s);if(!u)throw new Error("transport not found [id:"+s+"]");u.remoteStats(c);break;case"newPeer":var d=e.name;if(t._peers.has(d))throw new Error('Peer already exists [name:"'+d+'"]');var l=e;t._handlePeerData(l);break;case"peerClosed":var p=e.name,f=e.appData,h=t._peers.get(p);if(!h)throw new Error('no Peer found [name:"'+p+'"]');h.remoteClose(f);break;case"producerPaused":var m=e.id,v=e.appData,y=t._producers.get(m);if(!y)throw new Error("Producer not found [id:"+m+"]");y.remotePause(v);break;case"producerResumed":var _=e.id,g=e.appData,b=t._producers.get(_);if(!b)throw new Error("Producer not found [id:"+_+"]");b.remoteResume(g);break;case"producerClosed":var w=e.id,k=e.appData,P=t._producers.get(w);if(!P)throw new Error("Producer not found [id:"+w+"]");P.remoteClose(k);break;case"producerStats":var S=e.id,E=e.stats,x=t._producers.get(S);if(!x)throw new Error("Producer not found [id:"+S+"]");x.remoteStats(E);break;case"newConsumer":var T=e.peerName,R=t._peers.get(T);if(!R)throw new Error('no Peer found [name:"'+T+'"]');var C=e;t._handleConsumerData(C,R);break;case"consumerClosed":var O=e.id,j=e.peerName,A=e.appData,I=t._peers.get(j);if(!I)throw new Error('no Peer found [name:"'+j+'"]');var D=I.getConsumerById(O);if(!D)throw new Error("Consumer not found [id:"+O+"]");D.remoteClose(A);break;case"consumerPaused":var M=e.id,N=e.peerName,L=e.appData,B=t._peers.get(N);if(!B)throw new Error('no Peer found [name:"'+N+'"]');var F=B.getConsumerById(M);if(!F)throw new Error("Consumer not found [id:"+M+"]");F.remotePause(L);break;case"consumerResumed":var U=e.id,q=e.peerName,W=e.appData,z=t._peers.get(q);if(!z)throw new Error('no Peer found [name:"'+q+'"]');var G=z.getConsumerById(U);if(!G)throw new Error("Consumer not found [id:"+U+"]");G.remoteResume(W);break;case"consumerPreferredProfileSet":var V=e.id,K=e.peerName,H=e.profile,X=t._peers.get(K);if(!X)throw new Error('no Peer found [name:"'+K+'"]');var Y=X.getConsumerById(V);if(!Y)throw new Error("Consumer not found [id:"+V+"]");Y.remoteSetPreferredProfile(H);break;case"consumerEffectiveProfileChanged":var J=e.id,$=e.peerName,Q=e.profile,Z=t._peers.get($);if(!Z)throw new Error('no Peer found [name:"'+$+'"]');var ee=Z.getConsumerById(J);if(!ee)throw new Error("Consumer not found [id:"+J+"]");ee.remoteEffectiveProfileChanged(Q);break;case"consumerStats":var te=e.id,re=e.peerName,ne=e.stats,oe=t._peers.get(re);if(!oe)throw new Error('no Peer found [name:"'+re+'"]');var ie=oe.getConsumerById(te);if(!ie)throw new Error("Consumer not found [id:"+te+"]");ie.remoteStats(ne);break;default:throw new Error('unknown notification method "'+r+'"')}}).catch(function(t){x.error("receiveNotification() failed [notification:%o]: %s",e,t)})}},{key:"_sendRequest",value:function(e,t){var r=this,n=Object.assign({method:e,target:"peer"},t);return this.closed?(x.error("_sendRequest() | Room closed [method:%s, request:%o]",e,n),Promise.reject(new f.InvalidStateError("Room closed"))):(x.debug("_sendRequest() [method:%s, request:%o]",e,n),new Promise(function(t,o){var i=!1,a=setTimeout(function(){x.error("request failed [method:%s]: timeout",e),i=!0,o(new f.TimeoutError("timeout"))},r._settings.requestTimeout),s=function(n){if(!i){if(i=!0,clearTimeout(a),r.closed)return x.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));x.debug("request succeeded [method:%s, response:%o]",e,n),t(n)}},c=function(t){if(!i){if(i=!0,clearTimeout(a),r.closed)return x.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));t instanceof Error||(t=new Error(String(t))),x.error("request failed [method:%s]:%o",e,t),o(t)}};r.safeEmit("request",n,s,c)}))}},{key:"_sendNotification",value:function(e,t){if(!this.closed){var r=Object.assign({method:e,target:"peer",notification:!0},t);x.debug("_sendNotification() [method:%s, notification:%o]",e,r),this.safeEmit("notify",r)}}},{key:"_handlePeerData",value:function(e){var t=this,r=e.name,n=e.consumers,o=e.appData,i=new P.default(r,o);this._peers.set(i.name,i),i.on("@close",function(){t._peers.delete(i.name)});var a=!0,s=!1,c=void 0;try{for(var u,d=n[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var l=u.value;try{this._handleConsumerData(l,i)}catch(e){x.error("error handling existing Consumer in Peer:%o",e)}}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}this.joined&&this.safeEmit("newpeer",i)}},{key:"_handleConsumerData",value:function(e,t){var r=e.id,n=e.kind,o=e.rtpParameters,i=e.paused,a=e.appData,s=new E.default(r,n,o,t,a);m.canReceive(s.rtpParameters,this._extendedRtpCapabilities)&&s.setSupported(!0),i&&s.remotePause(),t.addConsumer(s)}},{key:"joined",get:function(){return this._state===T.joined}},{key:"closed",get:function(){return this._state===T.closed}},{key:"peerName",get:function(){return this._peerName}},{key:"transports",get:function(){return Array.from(this._transports.values())}},{key:"producers",get:function(){return Array.from(this._producers.values())}},{key:"peers",get:function(){return Array.from(this._peers.values())}}]),t}(p.default);r.default=R},{"./Consumer":165,"./Device":166,"./EnhancedEventEmitter":167,"./Logger":168,"./Peer":169,"./Producer":170,"./Transport":172,"./errors":173,"./ortc":188}],172:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=e("./Logger"),u=n(c),d=e("./EnhancedEventEmitter"),l=n(d),p=e("./errors"),f=e("./utils"),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(f),m=e("./Device"),v=n(m),y=e("./CommandQueue"),_=n(y),g=new u.default("Transport"),b=function(e){function t(e,r,n,a){o(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,g));return g.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),s._id=h.randomNumber(),s._closed=!1,s._direction=e,s._settings=n,s._appData=a,s._statsEnabled=!1,s._commandQueue=new _.default,s._handler=new v.default.Handler(e,r,n),s._connectionState="new",s._commandQueue.on("exec",s._execCommand.bind(s)),s._handleHandler(),s}return a(t,e),s(t,[{key:"close",value:function(e){g.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit("@notify","closeTransport",{id:this._id,appData:e}),this.emit("@close"),this.safeEmit("close","local",e),this._destroy())}},{key:"remoteClose",value:function(e){g.debug("remoteClose()"),this._closed||(this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e),this._destroy())}},{key:"_destroy",value:function(){this._commandQueue.close(),this._handler.close()}},{key:"restartIce",value:function(){var e=this;g.debug("restartIce()"),this._closed||"new"!==this._connectionState&&Promise.resolve().then(function(){var t={id:e._id};return e.safeEmitAsPromise("@request","restartTransport",t)}).then(function(t){var r=t.iceParameters;return e._commandQueue.push("restartIce",{remoteIceParameters:r})}).catch(function(e){g.error("restartIce() | failed: %o",e)})}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;g.debug("enableStats() [interval:%s]",e),("number"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit("@notify","enableTransportStats",t)}},{key:"disableStats",value:function(){g.debug("disableStats()"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit("@notify","disableTransportStats",e)}},{key:"_handleHandler",value:function(){var e=this,t=this._handler;t.on("@connectionstatechange",function(t){e._connectionState!==t&&(g.debug("Transport connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))}),t.on("@needcreatetransport",function(t,r,n){var o={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(o.dtlsParameters=t.dtlsParameters),e.safeEmit("@request","createTransport",o,r,n)}),t.on("@needupdatetransport",function(t){var r={id:e._id,dtlsParameters:t.dtlsParameters};e.safeEmit("@notify","updateTransport",r)}),t.on("@needupdateproducer",function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit("@notify","updateProducer",n)})}},{key:"addProducer",value:function(e){return g.debug("addProducer() [producer:%o]",e),this._closed?Promise.reject(new p.InvalidStateError("Transport closed")):"send"!==this._direction?Promise.reject(new Error("not a sending Transport")):this._commandQueue.push("addProducer",{producer:e})}},{key:"removeProducer",value:function(e,t,r){g.debug("removeProducer() [producer:%o]",e),this._closed||this._commandQueue.push("removeProducer",{producer:e}).catch(function(){}),"local"===t&&this.safeEmit("@notify","closeProducer",{id:e.id,appData:r})}},{key:"pauseProducer",value:function(e,t){g.debug("pauseProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseProducer",r)}},{key:"resumeProducer",value:function(e,t){g.debug("resumeProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeProducer",r)}},{key:"replaceProducerTrack",value:function(e,t){return g.debug("replaceProducerTrack() [producer:%o]",e),this._commandQueue.push("replaceProducerTrack",{producer:e,track:t})}},{key:"enableProducerStats",value:function(e,t){g.debug("enableProducerStats() [producer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableProducerStats",r)}},{key:"disableProducerStats",value:function(e){g.debug("disableProducerStats() [producer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableProducerStats",t)}},{key:"addConsumer",value:function(e){return g.debug("addConsumer() [consumer:%o]",e),this._closed?Promise.reject(new p.InvalidStateError("Transport closed")):"recv"!==this._direction?Promise.reject(new Error("not a receiving Transport")):this._commandQueue.push("addConsumer",{consumer:e})}},{key:"removeConsumer",value:function(e){g.debug("removeConsumer() [consumer:%o]",e),this._commandQueue.push("removeConsumer",{consumer:e}).catch(function(){})}},{key:"pauseConsumer",value:function(e,t){g.debug("pauseConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseConsumer",r)}},{key:"resumeConsumer",value:function(e,t){g.debug("resumeConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeConsumer",r)}},{key:"setConsumerPreferredProfile",value:function(e,t){g.debug("setConsumerPreferredProfile() [consumer:%o]",e);var r={id:e.id,profile:t};this.safeEmit("@notify","setConsumerPreferredProfile",r)}},{key:"enableConsumerStats",value:function(e,t){g.debug("enableConsumerStats() [consumer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableConsumerStats",r)}},{key:"disableConsumerStats",value:function(e){g.debug("disableConsumerStats() [consumer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableConsumerStats",t)}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_execCommand",value:function(e,t){var r=void 0;try{switch(e.method){case"addProducer":var n=e.producer;r=this._execAddProducer(n);break;case"removeProducer":var o=e.producer;r=this._execRemoveProducer(o);break;case"replaceProducerTrack":var i=e.producer,a=e.track;r=this._execReplaceProducerTrack(i,a);break;case"addConsumer":var s=e.consumer;r=this._execAddConsumer(s);break;case"removeConsumer":var c=e.consumer;r=this._execRemoveConsumer(c);break;case"restartIce":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=Promise.reject(new Error('unknown command method "'+e.method+'"'))}}catch(e){r=Promise.reject(e)}t.promise=r}},{key:"_execAddProducer",value:function(e){var t=this;g.debug("_execAddProducer()");var r=void 0;return Promise.resolve().then(function(){return t._handler.addProducer(e)}).then(function(n){r=n;var o={id:e.id,kind:e.kind,transportId:t._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return t.safeEmitAsPromise("@request","createProducer",o)}).then(function(){e.setRtpParameters(r)})}},{key:"_execRemoveProducer",value:function(e){return g.debug("_execRemoveProducer()"),this._handler.removeProducer(e)}},{key:"_execReplaceProducerTrack",value:function(e,t){return g.debug("_execReplaceProducerTrack()"),this._handler.replaceProducerTrack(e,t)}},{key:"_execAddConsumer",value:function(e){var t=this;g.debug("_execAddConsumer()");var r=void 0;return Promise.resolve().then(function(){return t._handler.addConsumer(e)}).then(function(n){r=n;var o={id:e.id,transportId:t.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return t.safeEmitAsPromise("@request","enableConsumer",o)}).then(function(t){var n=t.paused,o=t.preferredProfile,i=t.effectiveProfile;return n&&e.remotePause(),o&&e.remoteSetPreferredProfile(o),i&&e.remoteEffectiveProfileChanged(i),r})}},{key:"_execRemoveConsumer",value:function(e){return g.debug("_execRemoveConsumer()"),this._handler.removeConsumer(e)}},{key:"_execRestartIce",value:function(e){return g.debug("_execRestartIce()"),this._handler.restartIce(e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"appData",get:function(){return this._appData}},{key:"connectionState",get:function(){return this._connectionState}}]),t}(l.default);r.default=b},{"./CommandQueue":164,"./Device":166,"./EnhancedEventEmitter":167,"./Logger":168,"./errors":173,"./utils":189}],173:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e){var t=e.getPrototypeOf||function(e){return e.__proto__},r=e.setPrototypeOf||function(e,t){return e.__proto__=t,e},n="object"===("undefined"==typeof Reflect?"undefined":a(Reflect))?Reflect.construct:function(e,t,n){var o,i=[null];return i.push.apply(i,t),o=e.bind.apply(e,i),r(new o,n.prototype)};return function(e){var o=t(e);return r(e,r(function(){return n(o,arguments,t(this).constructor)},o))}}(Object),c=r.InvalidStateError=s(function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,t):r.stack=new Error(e).stack,r}return i(t,e),t}(Error));r.TimeoutError=s(function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name="TimeoutError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,c):r.stack=new Error(e).stack,r}return i(t,e),t}(Error)),r.UnsupportedError=s(function(e){function t(e,r){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(i,c):i.stack=new Error(e).stack,i.data=r,i}return i(t,e),t}(Error))},{}],174:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("sdp-transform"),d=o(u),l=e("../Logger"),p=o(l),f=e("../EnhancedEventEmitter"),h=o(f),m=e("../utils"),v=n(m),y=e("../ortc"),_=n(y),g=e("./sdp/commonUtils"),b=n(g),w=e("./sdp/planBUtils"),k=n(w),P=e("./sdp/RemotePlanBSdp"),S=o(P),E=new p.default("Chrome55"),x=function(e){function t(e,r,n){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,E));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new S.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return s(t,e),c(t,[{key:"close",value:function(){E.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(h.default),T=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return s(t,e),c(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(E.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject(new Error("track already added"));var n=void 0;return Promise.resolve().then(function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(n){if(e.simulcast){E.debug("addProducer() | enabling simulcast");var o=d.default.parse(n.sdp);k.addSimulcastForTrack(o,r);n={type:"offer",sdp:d.default.write(o)}}return E.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",n),t._pc.setLocalDescription(n)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){n=d.default.parse(t._pc.localDescription.sdp);var e=t._remoteSdp.createAnswerSdp(n),r={type:"answer",sdp:e};return E.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){var o=v.clone(t._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(o,n,r),o}).catch(function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return E.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(e){return E.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0===t._stream.getTracks().length)return void E.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString());throw e}).then(function(){if("stable"!==t._pc.signalingState){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;E.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track,o=void 0;return Promise.resolve().then(function(){return r._stream.removeTrack(n),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(n){if(e.simulcast){E.debug("addProducer() | enabling simulcast");var o=d.default.parse(n.sdp);k.addSimulcastForTrack(o,t);n={type:"offer",sdp:d.default.write(o)}}return E.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",n),r._pc.setLocalDescription(n)}).then(function(){o=d.default.parse(r._pc.localDescription.sdp);var e=r._remoteSdp.createAnswerSdp(o),t={type:"answer",sdp:e};return E.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)}).then(function(){var n=v.clone(r._rtpParametersByKind[e.kind]);k.fillRtpParametersForTrack(n,o,t),r.safeEmit("@needupdateproducer",e,n)}).catch(function(e){throw r._stream.removeTrack(t),r._stream.addTrack(n),r._pc.addStream(r._stream),e})}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=d.default.parse(r),o=b.extractDtlsParameters(n);return o.role="server",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(x),R=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return s(t,e),c(t,[{key:"addConsumer",value:function(e){var t=this;if(E.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}),r=e.getTrackById(o.trackId);if(!r)throw new Error("remote track not found");return r})}},{key:"removeConsumer",value:function(e){var t=this;return E.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){E.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=d.default.parse(e),r=b.extractDtlsParameters(t),n={dtlsParameters:r};this.safeEmit("@needupdatetransport",n),this._transportUpdated=!0}}]),t}(x),C=function(){function e(t,r,n){i(this,e),E.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)},new T(o,n);case"recv":return o={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return c(e,null,[{key:"getNativeRtpCapabilities",value:function(){E.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=d.default.parse(t.sdp);return b.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome55"}}]),e}();r.default=C},{"../EnhancedEventEmitter":167,"../Logger":168,"../ortc":188,"../utils":189,"./sdp/RemotePlanBSdp":182,"./sdp/commonUtils":184,"./sdp/planBUtils":185,"sdp-transform":206}],175:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("sdp-transform"),d=o(u),l=e("../Logger"),p=o(l),f=e("../EnhancedEventEmitter"),h=o(f),m=e("../utils"),v=n(m),y=e("../ortc"),_=n(y),g=e("./sdp/commonUtils"),b=n(g),w=e("./sdp/planBUtils"),k=n(w),P=e("./sdp/RemotePlanBSdp"),S=o(P),E=new p.default("Chrome67"),x=function(e){function t(e,r,n){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,E));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new S.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return s(t,e),c(t,[{key:"close",value:function(){E.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(h.default),T=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r))
;return n._transportReady=!1,n._stream=new MediaStream,n}return s(t,e),c(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(E.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject(new Error("track already added"));var n=void 0;return Promise.resolve().then(function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(n){if(e.simulcast){E.debug("addProducer() | enabling simulcast");var o=d.default.parse(n.sdp);k.addSimulcastForTrack(o,r);n={type:"offer",sdp:d.default.write(o)}}return E.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",n),t._pc.setLocalDescription(n)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){n=d.default.parse(t._pc.localDescription.sdp);var e=t._remoteSdp.createAnswerSdp(n),r={type:"answer",sdp:e};return E.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){var o=v.clone(t._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(o,n,r),o}).catch(function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return E.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(e){return E.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0===t._stream.getTracks().length)return void E.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString());throw e}).then(function(){if("stable"!==t._pc.signalingState){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;E.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=d.default.parse(r),o=b.extractDtlsParameters(n);return o.role="server",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(x),R=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return s(t,e),c(t,[{key:"addConsumer",value:function(e){var t=this;if(E.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}),r=e.getTrackById(o.trackId);if(!r)throw new Error("remote track not found");return r})}},{key:"removeConsumer",value:function(e){var t=this;return E.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){E.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=d.default.parse(e),r=b.extractDtlsParameters(t),n={dtlsParameters:r};this.safeEmit("@needupdatetransport",n),this._transportUpdated=!0}}]),t}(x),C=function(){function e(t,r,n){i(this,e),E.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)},new T(o,n);case"recv":return o={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return c(e,null,[{key:"getNativeRtpCapabilities",value:function(){E.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=d.default.parse(t.sdp);return b.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome67"}}]),e}();r.default=C},{"../EnhancedEventEmitter":167,"../Logger":168,"../ortc":188,"../utils":189,"./sdp/RemotePlanBSdp":182,"./sdp/commonUtils":184,"./sdp/planBUtils":185,"sdp-transform":206}],176:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("../Logger"),d=o(u),l=e("../EnhancedEventEmitter"),p=o(l),f=e("../utils"),h=n(f),m=e("../ortc"),v=n(m),y=e("./ortc/edgeUtils"),_=n(y),g="CNAME-EDGE-"+h.randomNumber(),b=new d.default("Edge11"),w=function(e){function t(e,r,n){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,b));return b.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),o._rtpParametersByKind={audio:v.getSendingRtpParameters("audio",r),video:v.getSendingRtpParameters("video",r)},o._transportReady=!1,o._iceGatherer=null,o._iceTransport=null,o._dtlsTransport=null,o._rtpSenders=new Map,o._rtpReceivers=new Map,o._transportRemoteParameters=null,o._setIceGatherer(n),o._setIceTransport(),o._setDtlsTransport(),o}return s(t,e),c(t,null,[{key:"getNativeRtpCapabilities",value:function(){return b.debug("getNativeRtpCapabilities()"),_.getCapabilities()}},{key:"tag",get:function(){return"Edge11"}}]),c(t,[{key:"close",value:function(){b.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var n,o=this._rtpSenders.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var i=n.value;try{i.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}var a=!0,s=!1,c=void 0;try{for(var u,d=this._rtpReceivers.values()[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var l=u.value;try{l.stop()}catch(e){}}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}}},{key:"addProducer",value:function(e){var t=this,r=e.track;return b.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?Promise.reject(new Error("Producer already added")):Promise.resolve().then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){b.debug("addProducer() | calling new RTCRtpSender()");var n=new RTCRtpSender(r,t._dtlsTransport),o=h.clone(t._rtpParametersByKind[e.kind]),i={ssrc:h.randomNumber()};o.codecs.some(function(e){return"rtx"===e.name})&&(i.rtx={ssrc:h.randomNumber()}),o.encodings.push(i),o.rtcp={cname:g,reducedSize:!0,mux:!0};var a=_.mangleRtpParameters(o);return b.debug("addProducer() | calling rtpSender.send() [params:%o]",a),n.send(a),t._rtpSenders.set(e.id,n),o})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return b.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error("RTCRtpSender not found");t._rtpSenders.delete(e.id);try{b.debug("removeProducer() | calling rtpSender.stop()"),r.stop()}catch(e){b.warn("rtpSender.stop() failed:%o",e)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;return b.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error("RTCRtpSender not found");n.setTrack(t)})}},{key:"addConsumer",value:function(e){var t=this;return b.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._rtpReceivers.has(e.id)?Promise.reject(new Error("Consumer already added")):Promise.resolve().then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){b.debug("addProducer() | calling new RTCRtpReceiver()");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener("error",function(e){b.error('iceGatherer "error" event [event:%o]',e)});var n=_.mangleRtpParameters(e.rtpParameters);return b.debug("addProducer() | calling rtpReceiver.receive() [params:%o]",n),r.receive(n),t._rtpReceivers.set(e.id,r),r.track})}},{key:"removeConsumer",value:function(e){var t=this;return b.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),Promise.resolve().then(function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error("RTCRtpReceiver not found");t._rtpReceivers.delete(e.id);try{b.debug("removeConsumer() | calling rtpReceiver.stop()"),r.stop()}catch(e){b.warn("rtpReceiver.stop() failed:%o",e)}})}},{key:"restartIce",value:function(e){var t=this;b.debug("restartIce()"),Promise.resolve().then(function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;b.debug("restartIce() | calling iceTransport.start()"),t._iceTransport.start(t._iceGatherer,e,"controlling");var n=!0,o=!1,i=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;t._iceTransport.addRemoteCandidate(c)}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}t._iceTransport.addRemoteCandidate({})})}},{key:"_setIceGatherer",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:"all"});t.addEventListener("error",function(e){b.error('iceGatherer "error" event [event:%o]',e)});try{t.gather()}catch(e){b.debug("iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=t}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("icestatechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("candidatepairchange",function(e){b.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",function(){b.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",function(){b.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state)}),e.addEventListener("error",function(e){b.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}},{key:"_setupTransport",value:function(){var e=this;return b.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role="server",t.dtlsParameters=r,e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._transportRemoteParameters=t;var r=t.iceParameters,n=t.iceCandidates,o=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,"controlling");var i=!0,a=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var d=c.value;e._iceTransport.addRemoteCandidate(d)}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}e._iceTransport.addRemoteCandidate({}),o.fingerprints=o.fingerprints.filter(function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm}),e._dtlsTransport.start(o),e._transportReady=!0})}}]),t}(p.default);r.default=w},{"../EnhancedEventEmitter":167,"../Logger":168,"../ortc":188,"../utils":189,"./ortc/edgeUtils":181}],177:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("sdp-transform"),d=o(u),l=e("../Logger"),p=o(l),f=e("../EnhancedEventEmitter"),h=o(f),m=e("../utils"),v=n(m),y=e("../ortc"),_=n(y),g=e("./sdp/commonUtils"),b=n(g),w=e("./sdp/unifiedPlanUtils"),k=n(w),P=e("./sdp/RemoteUnifiedPlanSdp"),S=o(P),E=new p.default("Firefox50"),x=function(e){function t(e,r,n){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,E));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new S.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return s(t,e),c(t,[{key:"close",value:function(){E.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(h.default),T=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return s(t,e),c(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(E.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject(new Error("track already added"));var n=void 0,o=void 0;return Promise.resolve().then(function(){t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream)}).then(function(){if(e.simulcast){E.debug("addProducer() | enabling simulcast");var r=[];return e.simulcast.high&&r.push({rid:"high"+t._nextRid,active:!0,priority:"high",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium"+t._nextRid,active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low"+t._nextRid,active:!0,priority:"low",maxBitrate:e.simulcast.low}),t._nextRid++,n.setParameters({encodings:r})}}).then(function(){return t._pc.createOffer()}).then(function(e){return E.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){o=d.default.parse(t._pc.localDescription.sdp);var e=t._remoteSdp.createAnswerSdp(o),r={type:"answer",sdp:e};return E.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){var n=v.clone(t._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(n,o,r),n}).catch(function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return E.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),Promise.resolve().then(function(){return t._pc.createOffer()}).then(function(e){return E.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})}).then(function(){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;E.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=d.default.parse(r),o=b.extractDtlsParameters(n);return o.role="server",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(x),R=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map;var o={mid:"fake-dc",kind:"application",closed:!1,cname:null};return n._consumerInfos.set(555,o),n}return s(t,e),c(t,[{key:"addConsumer",value:function(e){var t=this;if(E.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;E.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){E.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=d.default.parse(e),r=b.extractDtlsParameters(t),n={dtlsParameters:r};this.safeEmit("@needupdatetransport",n),this._transportUpdated=!0}}]),t}(x),C=function(){function e(t,r,n){i(this,e),E.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)},new T(o,n);case"recv":return o={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return c(e,null,[{key:"getNativeRtpCapabilities",value:function(){E.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(r){try{t.remove()}catch(e){}try{e.close()}catch(e){}var n=d.default.parse(r.sdp);return b.extractRtpCapabilities(n)}).catch(function(r){try{t.remove()}catch(e){}try{e.close()}catch(e){}throw r})}},{key:"tag",get:function(){return"Firefox50"}}]),e}();r.default=C},{"../EnhancedEventEmitter":167,"../Logger":168,"../ortc":188,"../utils":189,"./sdp/RemoteUnifiedPlanSdp":183,"./sdp/commonUtils":184,"./sdp/unifiedPlanUtils":186,"sdp-transform":206}],178:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("sdp-transform"),d=o(u),l=e("../Logger"),p=o(l),f=e("../EnhancedEventEmitter"),h=o(f),m=e("../utils"),v=n(m),y=e("../ortc"),_=n(y),g=e("./sdp/commonUtils"),b=n(g),w=e("./sdp/unifiedPlanUtils"),k=n(w),P=e("./sdp/RemoteUnifiedPlanSdp"),S=o(P),E=new p.default("Firefox59"),x=function(e){function t(e,r,n){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,E));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new S.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return s(t,e),c(t,[{key:"close",value:function(){E.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(h.default),T=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return s(t,e),c(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(E.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject(new Error("track already added"));var n=void 0,o=void 0;return Promise.resolve().then(function(){t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream)}).then(function(){if(e.simulcast){E.debug("addProducer() | enabling simulcast");var r=[];return e.simulcast.high&&r.push({rid:"high"+t._nextRid,active:!0,priority:"high",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium"+t._nextRid,active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low"+t._nextRid,active:!0,priority:"low",maxBitrate:e.simulcast.low}),t._nextRid++,n.setParameters({encodings:r})}}).then(function(){return t._pc.createOffer()}).then(function(e){return E.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){o=d.default.parse(t._pc.localDescription.sdp);var e=t._remoteSdp.createAnswerSdp(o),r={type:"answer",sdp:e};return E.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){var n=v.clone(t._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(n,o,r),n}).catch(function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return E.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),Promise.resolve().then(function(){return t._pc.createOffer()}).then(function(e){return E.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})}).then(function(){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;E.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){
r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=d.default.parse(r),o=b.extractDtlsParameters(n);return o.role="server",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(x),R=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return s(t,e),c(t,[{key:"addConsumer",value:function(e){var t=this;if(E.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getTransceivers().find(function(e){var t=e.receiver;return!!t&&(!!t.track&&e.mid===o.mid)});if(!e)throw new Error("remote track not found");return e.receiver.track})}},{key:"removeConsumer",value:function(e){var t=this;E.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){E.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=d.default.parse(e),r=b.extractDtlsParameters(t),n={dtlsParameters:r};this.safeEmit("@needupdatetransport",n),this._transportUpdated=!0}}]),t}(x),C=function(){function e(t,r,n){i(this,e),E.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)},new T(o,n);case"recv":return o={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return c(e,null,[{key:"getNativeRtpCapabilities",value:function(){E.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(r){try{t.remove()}catch(e){}try{e.close()}catch(e){}var n=d.default.parse(r.sdp);return b.extractRtpCapabilities(n)}).catch(function(r){try{t.remove()}catch(e){}try{e.close()}catch(e){}throw r})}},{key:"tag",get:function(){return"Firefox59"}}]),e}();r.default=C},{"../EnhancedEventEmitter":167,"../Logger":168,"../ortc":188,"../utils":189,"./sdp/RemoteUnifiedPlanSdp":183,"./sdp/commonUtils":184,"./sdp/unifiedPlanUtils":186,"sdp-transform":206}],179:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("sdp-transform"),d=o(u),l=e("../Logger"),p=o(l),f=e("../EnhancedEventEmitter"),h=o(f),m=e("../utils"),v=n(m),y=e("../ortc"),_=n(y),g=e("./sdp/commonUtils"),b=n(g),w=e("./sdp/planBUtils"),k=n(w),P=e("./sdp/RemotePlanBSdp"),S=o(P),E=new p.default("ReactNative"),x=function(e){function t(e,r,n){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,E));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new S.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return s(t,e),c(t,[{key:"close",value:function(){E.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(h.default),T=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._tracks=new Set,n}return s(t,e),c(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(E.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._tracks.has(r))return Promise.reject(new Error("track already added"));if(!r.streamReactTag)return Promise.reject(new Error("no track.streamReactTag property"));var n=void 0,o=void 0;return Promise.resolve().then(function(){return t._tracks.add(r),n=new MediaStream(r.streamReactTag),n.addTrack(r),t._pc.addStream(n),t._pc.createOffer()}).then(function(n){if(e.simulcast){E.debug("addProducer() | enabling simulcast");var o=d.default.parse(n.sdp);k.addSimulcastForTrack(o,r);n={type:"offer",sdp:d.default.write(o)}}E.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",n);var i=new RTCSessionDescription(n);return t._pc.setLocalDescription(i)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){o=d.default.parse(t._pc.localDescription.sdp);var e=t._remoteSdp.createAnswerSdp(o),r={type:"answer",sdp:e};E.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}).then(function(){var n=v.clone(t._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(n,o,r),n}).catch(function(e){throw t._tracks.delete(r),n.removeTrack(r),t._pc.addStream(n),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return E.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),r.streamReactTag?Promise.resolve().then(function(){t._tracks.delete(r);var e=new MediaStream(r.streamReactTag);return e.addTrack(r),t._pc.addStream(e),t._pc.createOffer()}).then(function(e){return E.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0===t._tracks.size)return void E.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString());throw e}).then(function(){if("stable"!==t._pc.signalingState){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};E.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",n);var o=new RTCSessionDescription(n);return t._pc.setRemoteDescription(o)}}):Promise.reject(new Error("no track.streamReactTag property"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;if(E.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),!t.streamReactTag)return Promise.reject(new Error("no track.streamReactTag property"));var n=e.track,o=void 0,i=void 0;return Promise.resolve().then(function(){return r._tracks.add(t),r._tracks.delete(n),o=new MediaStream(t.streamReactTag),o.addTrack(t),o.removeTrack(n),r._pc.addStream(o),r._pc.createOffer()}).then(function(n){if(e.simulcast){E.debug("addProducer() | enabling simulcast");var o=d.default.parse(n.sdp);k.addSimulcastForTrack(o,t);n={type:"offer",sdp:d.default.write(o)}}E.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",n);var i=new RTCSessionDescription(n);return r._pc.setLocalDescription(i)}).then(function(){i=d.default.parse(r._pc.localDescription.sdp);var e=r._remoteSdp.createAnswerSdp(i),t={type:"answer",sdp:e};E.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",t);var n=new RTCSessionDescription(t);return r._pc.setRemoteDescription(n)}).then(function(){var n=v.clone(r._rtpParametersByKind[e.kind]);k.fillRtpParametersForTrack(n,i,t),r.safeEmit("@needupdateproducer",e,n)}).catch(function(e){throw r._tracks.delete(t),o.removeTrack(t),r._pc.addStream(o),e})}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n);var o=new RTCSessionDescription(n);return t._pc.setRemoteDescription(o)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=d.default.parse(r),o=b.extractDtlsParameters(n);return o.role="server",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(x),R=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return s(t,e),c(t,[{key:"addConsumer",value:function(e){var t=this;if(E.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};E.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}),r=e.getTrackById(o.trackId);if(r.streamReactTag=e.reactTag,!r)throw new Error("remote track not found");return r})}},{key:"removeConsumer",value:function(e){var t=this;return E.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};E.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){E.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=d.default.parse(e),r=b.extractDtlsParameters(t),n={dtlsParameters:r};this.safeEmit("@needupdatetransport",n),this._transportUpdated=!0}}]),t}(x),C=function(){function e(t,r,n){i(this,e),E.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)},new T(o,n);case"recv":return o={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return c(e,null,[{key:"getNativeRtpCapabilities",value:function(){E.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=d.default.parse(t.sdp);return b.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"ReactNative"}}]),e}();r.default=C},{"../EnhancedEventEmitter":167,"../Logger":168,"../ortc":188,"../utils":189,"./sdp/RemotePlanBSdp":182,"./sdp/commonUtils":184,"./sdp/planBUtils":185,"sdp-transform":206}],180:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("sdp-transform"),d=o(u),l=e("../Logger"),p=o(l),f=e("../EnhancedEventEmitter"),h=o(f),m=e("../utils"),v=n(m),y=e("../ortc"),_=n(y),g=e("./sdp/commonUtils"),b=n(g),w=e("./sdp/planBUtils"),k=n(w),P=e("./sdp/RemotePlanBSdp"),S=o(P),E=new p.default("Safari11"),x=function(e){function t(e,r,n){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,E));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new S.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return s(t,e),c(t,[{key:"close",value:function(){E.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(h.default),T=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return s(t,e),c(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(E.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject(new Error("track already added"));var n=void 0,o=void 0;return Promise.resolve().then(function(){return t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream),t._pc.createOffer()}).then(function(e){return E.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){o=d.default.parse(t._pc.localDescription.sdp);var e=t._remoteSdp.createAnswerSdp(o),r={type:"answer",sdp:e};return E.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){var n=v.clone(t._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(n,o,r),n}).catch(function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return E.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()}).then(function(e){return E.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0===t._stream.getTracks().length)return void E.warn("removeLocalTrack() | ignoring expected error due no sending tracks: %s",e.toString());throw e}).then(function(){if("stable"!==t._pc.signalingState){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;E.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=d.default.parse(t._pc.localDescription.sdp),r=t._remoteSdp.createAnswerSdp(e),n={type:"answer",sdp:r};return E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=d.default.parse(r),o=b.extractDtlsParameters(n);return o.role="server",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(x),R=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return s(t,e),c(t,[{key:"addConsumer",value:function(e){var t=this;if(E.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;return E.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return E.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e=t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values())),r={type:"offer",sdp:e};return E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return E.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){E.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=d.default.parse(e),r=b.extractDtlsParameters(t),n={dtlsParameters:r};this.safeEmit("@needupdatetransport",n),this._transportUpdated=!0}}]),t}(x),C=function(){function e(t,r,n){i(this,e),E.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)},new T(o,n);case"recv":return o={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return c(e,null,[{key:"getNativeRtpCapabilities",value:function(){E.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then(function(t){try{e.close()}catch(e){}var r=d.default.parse(t.sdp);return b.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Safari11"}}]),e}();r.default=C},{"../EnhancedEventEmitter":167,"../Logger":168,"../ortc":188,"../utils":189,"./sdp/RemotePlanBSdp":182,"./sdp/commonUtils":184,"./sdp/planBUtils":185,"sdp-transform":206}],181:[function(e,t,r){"use strict";function n(){var e=RTCRtpReceiver.getCapabilities(),t=a.clone(e),r=!0,n=!1,o=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;if(c.channels=c.numChannels,delete c.numChannels,"audio"!==c.kind?delete c.channels:c.channels||(c.channels=1),c.mimeType=c.kind+"/"+c.name,c.parameters){var u=c.parameters;u.apt&&(u.apt=Number(u.apt)),u["packetization-mode"]&&(u["packetization-mode"]=Number(u["packetization-mode"]))}var d=!0,l=!1,p=void 0;try{for(var f,h=(c.rtcpFeedback||[])[Symbol.iterator]();!(d=(f=h.next()).done);d=!0){var m=f.value;m.parameter||delete m.parameter}}catch(e){l=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(l)throw p}}}}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return t}function o(e){var t=a.clone(e),r=!0,n=!1,o=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;c.channels&&(c.numChannels=c.channels,delete c.channels),delete c.mimeType}}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return t}Object.defineProperty(r,"__esModule",{value:!0}),r.getCapabilities=n,r.mangleRtpParameters=o;var i=e("../../utils"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(i)},{"../../utils":189}],182:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=e("sdp-transform"),u=n(c),d=e("../../Logger"),l=n(d),p=e("../../utils"),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(p),h=new l.default("RemotePlanBSdp"),m=function(){function e(t){a(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:f.randomNumber(),version:0}}return s(e,[{key:"setTransportLocalParameters",value:function(e){h.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){h.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){h.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),s(t,[{key:"createAnswerSdp",value:function(e){if(h.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},i=(e.media||[]).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},o.groups=[{type:"BUNDLE",mids:i.join(" ")}],o.media=[];var a=n.fingerprints.length;o.fingerprint={type:n.fingerprints[a-1].algorithm,hash:n.fingerprints[a-1].value};var s=!0,c=!1,d=void 0;try{for(var l,p=(e.media||[])[Symbol.iterator]();!(s=(l=p.next()).done);s=!0){var f=l.value,m=f.type,v=this._rtpParametersByKind[m].codecs,y=this._rtpParametersByKind[m].headerExtensions,_={};_.type=f.type,_.port=7,_.protocol="RTP/SAVPF",_.connection={ip:"127.0.0.1",version:4},_.mid=f.mid,_.iceUfrag=t.usernameFragment,_.icePwd=t.password,_.candidates=[];var g=!0,b=!1,w=void 0;try{
for(var k,P=r[Symbol.iterator]();!(g=(k=P.next()).done);g=!0){var S=k.value,E={};E.component=1,E.foundation=S.foundation,E.ip=S.ip,E.port=S.port,E.priority=S.priority,E.transport=S.protocol,E.type=S.type,S.tcpType&&(E.tcptype=S.tcpType),_.candidates.push(E)}}catch(e){b=!0,w=e}finally{try{!g&&P.return&&P.return()}finally{if(b)throw w}}switch(_.endOfCandidates="end-of-candidates",_.iceOptions="renomination",n.role){case"client":_.setup="active";break;case"server":_.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":_.direction="recvonly";break;case"recvonly":case"inactive":_.direction="inactive"}"video"===m&&(_.xGoogleFlag="conference"),_.rtp=[],_.rtcpFb=[],_.fmtp=[];var x=!0,T=!1,R=void 0;try{for(var C,O=v[Symbol.iterator]();!(x=(C=O.next()).done);x=!0){var j=C.value,A={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(j.channels>1&&(A.encoding=j.channels),_.rtp.push(A),j.parameters){var I={payload:j.payloadType,config:""},D=!0,M=!1,N=void 0;try{for(var L,B=Object.keys(j.parameters)[Symbol.iterator]();!(D=(L=B.next()).done);D=!0){var F=L.value;I.config&&(I.config+=";"),I.config+=F+"="+j.parameters[F]}}catch(e){M=!0,N=e}finally{try{!D&&B.return&&B.return()}finally{if(M)throw N}}I.config&&_.fmtp.push(I)}if(j.rtcpFeedback){var U=!0,q=!1,W=void 0;try{for(var z,G=j.rtcpFeedback[Symbol.iterator]();!(U=(z=G.next()).done);U=!0){var V=z.value;_.rtcpFb.push({payload:j.payloadType,type:V.type,subtype:V.parameter||""})}}catch(e){q=!0,W=e}finally{try{!U&&G.return&&G.return()}finally{if(q)throw W}}}}}catch(e){T=!0,R=e}finally{try{!x&&O.return&&O.return()}finally{if(T)throw R}}_.payloads=v.map(function(e){return e.payloadType}).join(" "),_.ext=[];var K=!0,H=!1,X=void 0;try{for(var Y,J=y[Symbol.iterator]();!(K=(Y=J.next()).done);K=!0){var $=Y.value;(function(e){if(!(f.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";_.ext.push({uri:e.uri,value:e.id})})($)}}catch(e){H=!0,X=e}finally{try{!K&&J.return&&J.return()}finally{if(H)throw X}}_.rtcpMux="rtcp-mux",_.rtcpRsize="rtcp-rsize",o.media.push(_)}}catch(e){c=!0,d=e}finally{try{!s&&p.return&&p.return()}finally{if(c)throw d}}return u.default.write(o)}}]),t}(m),y=function(e){function t(e){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),s(t,[{key:"createOfferSdp",value:function(e,t){var r=this;if(h.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var n=this._transportRemoteParameters.iceParameters,o=this._transportRemoteParameters.iceCandidates,i=this._transportRemoteParameters.dtlsParameters,a={},s=e;this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=n.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},a.groups=[{type:"BUNDLE",mids:s.join(" ")}],a.media=[];var c=i.fingerprints.length;a.fingerprint={type:i.fingerprints[c-1].algorithm,hash:i.fingerprints[c-1].value};var d=!0,l=!1,p=void 0;try{for(var f,m=e[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var v=f.value;!function(e){var i=r._rtpParametersByKind[e].codecs,s=r._rtpParametersByKind[e].headerExtensions,c={};c.type=e,c.port=7,c.protocol="RTP/SAVPF",c.connection={ip:"127.0.0.1",version:4},c.mid=e,c.iceUfrag=n.usernameFragment,c.icePwd=n.password,c.candidates=[];var u=!0,d=!1,l=void 0;try{for(var p,f=o[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value,m={};m.component=1,m.foundation=h.foundation,m.ip=h.ip,m.port=h.port,m.priority=h.priority,m.transport=h.protocol,m.type=h.type,h.tcpType&&(m.tcptype=h.tcpType),c.candidates.push(m)}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}c.endOfCandidates="end-of-candidates",c.iceOptions="renomination",c.setup="actpass",t.some(function(t){return t.kind===e})?c.direction="sendonly":c.direction="inactive",c.rtp=[],c.rtcpFb=[],c.fmtp=[];var v=!0,y=!1,_=void 0;try{for(var g,b=i[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value,k={payload:w.payloadType,codec:w.name,rate:w.clockRate};if(w.channels>1&&(k.encoding=w.channels),c.rtp.push(k),w.parameters){var P={payload:w.payloadType,config:""},S=!0,E=!1,x=void 0;try{for(var T,R=Object.keys(w.parameters)[Symbol.iterator]();!(S=(T=R.next()).done);S=!0){var C=T.value;P.config&&(P.config+=";"),P.config+=C+"="+w.parameters[C]}}catch(e){E=!0,x=e}finally{try{!S&&R.return&&R.return()}finally{if(E)throw x}}P.config&&c.fmtp.push(P)}if(w.rtcpFeedback){var O=!0,j=!1,A=void 0;try{for(var I,D=w.rtcpFeedback[Symbol.iterator]();!(O=(I=D.next()).done);O=!0){var M=I.value;c.rtcpFb.push({payload:w.payloadType,type:M.type,subtype:M.parameter||""})}}catch(e){j=!0,A=e}finally{try{!O&&D.return&&D.return()}finally{if(j)throw A}}}}}catch(e){y=!0,_=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw _}}c.payloads=i.map(function(e){return e.payloadType}).join(" "),c.ext=[];var N=!0,L=!1,B=void 0;try{for(var F,U=s[Symbol.iterator]();!(N=(F=U.next()).done);N=!0){var q=F.value;c.ext.push({uri:q.uri,value:q.id})}}catch(e){L=!0,B=e}finally{try{!N&&U.return&&U.return()}finally{if(L)throw B}}c.rtcpMux="rtcp-mux",c.rtcpRsize="rtcp-rsize",c.ssrcs=[],c.ssrcGroups=[];var W=!0,z=!1,G=void 0;try{for(var V,K=t[Symbol.iterator]();!(W=(V=K.next()).done);W=!0){var H=V.value;H.kind===e&&(c.ssrcs.push({id:H.ssrc,attribute:"msid",value:H.streamId+" "+H.trackId}),c.ssrcs.push({id:H.ssrc,attribute:"mslabel",value:H.streamId}),c.ssrcs.push({id:H.ssrc,attribute:"label",value:H.trackId}),c.ssrcs.push({id:H.ssrc,attribute:"cname",value:H.cname}),H.rtxSsrc&&(c.ssrcs.push({id:H.rtxSsrc,attribute:"msid",value:H.streamId+" "+H.trackId}),c.ssrcs.push({id:H.rtxSsrc,attribute:"mslabel",value:H.streamId}),c.ssrcs.push({id:H.rtxSsrc,attribute:"label",value:H.trackId}),c.ssrcs.push({id:H.rtxSsrc,attribute:"cname",value:H.cname}),c.ssrcGroups.push({semantics:"FID",ssrcs:H.ssrc+" "+H.rtxSsrc})))}}catch(e){z=!0,G=e}finally{try{!W&&K.return&&K.return()}finally{if(z)throw G}}a.media.push(c)}(v)}}catch(e){l=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(l)throw p}}return u.default.write(a)}}]),t}(m),_=function e(t,r){switch(a(this,e),h.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new v(r);case"recv":return new y(r)}};r.default=_},{"../../Logger":168,"../../utils":189,"sdp-transform":206}],183:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=e("sdp-transform"),u=n(c),d=e("../../Logger"),l=n(d),p=e("../../utils"),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(p),h=new l.default("RemoteUnifiedPlanSdp"),m=function(){function e(t){a(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:f.randomNumber(),version:0}}return s(e,[{key:"setTransportLocalParameters",value:function(e){h.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){h.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){h.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),s(t,[{key:"createAnswerSdp",value:function(e){if(h.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},i=(e.media||[]).filter(function(e){return e.mid}).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},i.length>0&&(o.groups=[{type:"BUNDLE",mids:i.join(" ")}]),o.media=[];var a=n.fingerprints.length;o.fingerprint={type:n.fingerprints[a-1].algorithm,hash:n.fingerprints[a-1].value};var s=!0,c=!1,d=void 0;try{for(var l,p=(e.media||[])[Symbol.iterator]();!(s=(l=p.next()).done);s=!0){var f=l.value,m="inactive"===f.direction,v=f.type,y=this._rtpParametersByKind[v].codecs,_=this._rtpParametersByKind[v].headerExtensions,g={};g.type=f.type,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid,g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,w=!1,k=void 0;try{for(var P,S=r[Symbol.iterator]();!(b=(P=S.next()).done);b=!0){var E=P.value,x={};x.component=1,x.foundation=E.foundation,x.ip=E.ip,x.port=E.port,x.priority=E.priority,x.transport=E.protocol,x.type=E.type,E.tcpType&&(x.tcptype=E.tcpType),g.candidates.push(x)}}catch(e){w=!0,k=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw k}}switch(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",n.role){case"client":g.setup="active";break;case"server":g.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":g.direction="recvonly";break;case"recvonly":case"inactive":g.direction="inactive"}g.rtp=[],g.rtcpFb=[],g.fmtp=[];var T=!0,R=!1,C=void 0;try{for(var O,j=y[Symbol.iterator]();!(T=(O=j.next()).done);T=!0){var A=O.value,I={payload:A.payloadType,codec:A.name,rate:A.clockRate};if(A.channels>1&&(I.encoding=A.channels),g.rtp.push(I),A.parameters){var D={payload:A.payloadType,config:""},M=!0,N=!1,L=void 0;try{for(var B,F=Object.keys(A.parameters)[Symbol.iterator]();!(M=(B=F.next()).done);M=!0){var U=B.value;D.config&&(D.config+=";"),D.config+=U+"="+A.parameters[U]}}catch(e){N=!0,L=e}finally{try{!M&&F.return&&F.return()}finally{if(N)throw L}}D.config&&g.fmtp.push(D)}if(A.rtcpFeedback){var q=!0,W=!1,z=void 0;try{for(var G,V=A.rtcpFeedback[Symbol.iterator]();!(q=(G=V.next()).done);q=!0){var K=G.value;g.rtcpFb.push({payload:A.payloadType,type:K.type,subtype:K.parameter||""})}}catch(e){W=!0,z=e}finally{try{!q&&V.return&&V.return()}finally{if(W)throw z}}}}}catch(e){R=!0,C=e}finally{try{!T&&j.return&&j.return()}finally{if(R)throw C}}if(g.payloads=y.map(function(e){return e.payloadType}).join(" "),!m){g.ext=[];var H=!0,X=!1,Y=void 0;try{for(var J,$=_[Symbol.iterator]();!(H=(J=$.next()).done);H=!0){var Q=J.value;(function(e){if(!(f.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";g.ext.push({uri:e.uri,value:e.id})})(Q)}}catch(e){X=!0,Y=e}finally{try{!H&&$.return&&$.return()}finally{if(X)throw Y}}}if(f.simulcast_03){g.simulcast_03={value:f.simulcast_03.value.replace(/send/g,"recv")},g.rids=[];var Z=!0,ee=!1,te=void 0;try{for(var re,ne=(f.rids||[])[Symbol.iterator]();!(Z=(re=ne.next()).done);Z=!0){var oe=re.value;"send"===oe.direction&&g.rids.push({id:oe.id,direction:"recv"})}}catch(e){ee=!0,te=e}finally{try{!Z&&ne.return&&ne.return()}finally{if(ee)throw te}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",o.media.push(g)}}catch(e){c=!0,d=e}finally{try{!s&&p.return&&p.return()}finally{if(c)throw d}}return u.default.write(o)}}]),t}(m),y=function(e){function t(e){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),s(t,[{key:"createOfferSdp",value:function(e){if(h.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},i=e.map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},i.length>0&&(o.groups=[{type:"BUNDLE",mids:i.join(" ")}]),o.media=[];var a=n.fingerprints.length;o.fingerprint={type:n.fingerprints[a-1].algorithm,hash:n.fingerprints[a-1].value};var s=!0,c=!1,d=void 0;try{for(var l,p=e[Symbol.iterator]();!(s=(l=p.next()).done);s=!0){var f=l.value,m=f.closed,v=f.kind,y=void 0,_=void 0;"application"!==f.kind&&(y=this._rtpParametersByKind[v].codecs,_=this._rtpParametersByKind[v].headerExtensions);var g={};"application"!==f.kind?(g.type=v,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid,g.msid=f.streamId+" "+f.trackId):(g.type=v,g.port=9,g.protocol="DTLS/SCTP",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid),g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,w=!1,k=void 0;try{for(var P,S=r[Symbol.iterator]();!(b=(P=S.next()).done);b=!0){var E=P.value,x={};x.component=1,x.foundation=E.foundation,x.ip=E.ip,x.port=E.port,x.priority=E.priority,x.transport=E.protocol,x.type=E.type,E.tcpType&&(x.tcptype=E.tcpType),g.candidates.push(x)}}catch(e){w=!0,k=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw k}}if(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",g.setup="actpass","application"!==f.kind){g.direction=m?"inactive":"sendonly",g.rtp=[],g.rtcpFb=[],g.fmtp=[];var T=!0,R=!1,C=void 0;try{for(var O,j=y[Symbol.iterator]();!(T=(O=j.next()).done);T=!0){var A=O.value,I={payload:A.payloadType,codec:A.name,rate:A.clockRate};if(A.channels>1&&(I.encoding=A.channels),g.rtp.push(I),A.parameters){var D={payload:A.payloadType,config:""},M=!0,N=!1,L=void 0;try{for(var B,F=Object.keys(A.parameters)[Symbol.iterator]();!(M=(B=F.next()).done);M=!0){var U=B.value;D.config&&(D.config+=";"),D.config+=U+"="+A.parameters[U]}}catch(e){N=!0,L=e}finally{try{!M&&F.return&&F.return()}finally{if(N)throw L}}D.config&&g.fmtp.push(D)}if(A.rtcpFeedback){var q=!0,W=!1,z=void 0;try{for(var G,V=A.rtcpFeedback[Symbol.iterator]();!(q=(G=V.next()).done);q=!0){var K=G.value;g.rtcpFb.push({payload:A.payloadType,type:K.type,subtype:K.parameter||""})}}catch(e){W=!0,z=e}finally{try{!q&&V.return&&V.return()}finally{if(W)throw z}}}}}catch(e){R=!0,C=e}finally{try{!T&&j.return&&j.return()}finally{if(R)throw C}}if(g.payloads=y.map(function(e){return e.payloadType}).join(" "),!m){g.ext=[];var H=!0,X=!1,Y=void 0;try{for(var J,$=_[Symbol.iterator]();!(H=(J=$.next()).done);H=!0){var Q=J.value;g.ext.push({uri:Q.uri,value:Q.id})}}catch(e){X=!0,Y=e}finally{try{!H&&$.return&&$.return()}finally{if(X)throw Y}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",m||(g.ssrcs=[],g.ssrcGroups=[],g.ssrcs.push({id:f.ssrc,attribute:"cname",value:f.cname}),f.rtxSsrc&&(g.ssrcs.push({id:f.rtxSsrc,attribute:"cname",value:f.cname}),g.ssrcGroups.push({semantics:"FID",ssrcs:f.ssrc+" "+f.rtxSsrc})))}else g.payloads=5e3,g.sctpmap={app:"webrtc-datachannel",maxMessageSize:256,sctpmapNumber:5e3};o.media.push(g)}}catch(e){c=!0,d=e}finally{try{!s&&p.return&&p.return()}finally{if(c)throw d}}return u.default.write(o)}}]),t}(m),_=function e(t,r){switch(a(this,e),h.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new v(r);case"recv":return new y(r)}};r.default=_},{"../../Logger":168,"../../utils":189,"sdp-transform":206}],184:[function(e,t,r){"use strict";function n(e){var t=new Map,r=[],n=!1,o=!1,i=!0,a=!1,c=void 0;try{for(var u,d=e.media[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value,p=l.type;switch(p){case"audio":if(n)continue;n=!0;break;case"video":if(o)continue;o=!0;break;default:continue}var f=!0,h=!1,m=void 0;try{for(var v,y=l.rtp[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var _=v.value,g={name:_.codec,mimeType:p+"/"+_.codec,kind:p,clockRate:_.rate,preferredPayloadType:_.payload,channels:_.encoding,rtcpFeedback:[],parameters:{}};"audio"!==g.kind?delete g.channels:g.channels||(g.channels=1),t.set(g.preferredPayloadType,g)}}catch(e){h=!0,m=e}finally{try{!f&&y.return&&y.return()}finally{if(h)throw m}}var b=!0,w=!1,k=void 0;try{for(var P,S=(l.fmtp||[])[Symbol.iterator]();!(b=(P=S.next()).done);b=!0){var E=P.value,x=s.default.parseFmtpConfig(E.config),g=t.get(E.payload);g&&(g.parameters=x)}}catch(e){w=!0,k=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw k}}var T=!0,R=!1,C=void 0;try{for(var O,j=(l.rtcpFb||[])[Symbol.iterator]();!(T=(O=j.next()).done);T=!0){var A=O.value,g=t.get(A.payload);if(g){var I={type:A.type,parameter:A.subtype};I.parameter||delete I.parameter,g.rtcpFeedback.push(I)}}}catch(e){R=!0,C=e}finally{try{!T&&j.return&&j.return()}finally{if(R)throw C}}var D=!0,M=!1,N=void 0;try{for(var L,B=(l.ext||[])[Symbol.iterator]();!(D=(L=B.next()).done);D=!0){var F=L.value,U={kind:p,uri:F.uri,preferredId:F.value};r.push(U)}}catch(e){M=!0,N=e}finally{try{!D&&B.return&&B.return()}finally{if(M)throw N}}}}catch(e){a=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(a)throw c}}return{codecs:Array.from(t.values()),headerExtensions:r,fecMechanisms:[]}}function o(e){var t=i(e),r=t.fingerprint||e.fingerprint,n=void 0;switch(t.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}}function i(e){return(e.media||[]).find(function(e){return e.iceUfrag&&0!==e.port})}Object.defineProperty(r,"__esModule",{value:!0}),r.extractRtpCapabilities=n,r.extractDtlsParameters=o;var a=e("sdp-transform"),s=function(e){return e&&e.__esModule?e:{default:e}}(a)},{"sdp-transform":206}],185:[function(e,t,r){"use strict";function n(e,t,r){var n=r.kind,o={cname:null,reducedSize:!0,mux:!0},a=(t.media||[]).find(function(e){return e.type===n});if(!a)throw new Error("m="+n+" section not found");var s=void 0,c=new Set,u=!0,d=!1,l=void 0;try{for(var p,f=(a.ssrcs||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value;if("msid"===h.attribute){if(h.value.split(" ")[1]===r.id){var m=h.id;c.add(m),s||(s=m)}}}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}if(0===c.size)throw new Error("a=ssrc line not found for local track [track.id:"+r.id+"]");var v=new Map,y=!0,_=!1,g=void 0;try{for(var b,w=(a.ssrcGroups||[])[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var k=b.value;if("FID"===k.semantics){var P=k.ssrcs.split(/\s+/),S=i(P,2),E=S[0],x=S[1];E=Number(E),x=Number(x),c.has(E)&&(c.delete(E),c.delete(x),v.set(E,x))}}}catch(e){_=!0,g=e}finally{try{!y&&w.return&&w.return()}finally{if(_)throw g}}var T=!0,R=!1,C=void 0;try{for(var O,j=c[Symbol.iterator]();!(T=(O=j.next()).done);T=!0){var E=O.value;v.set(E,null)}}catch(e){R=!0,C=e}finally{try{!T&&j.return&&j.return()}finally{if(R)throw C}}var A=a.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===s});A&&(o.cname=A.value),e.rtcp=o,e.encodings=[];var I=v.size>1,D=["low","medium","high"],M=!0,N=!1,L=void 0;try{for(var B,F=v[Symbol.iterator]();!(M=(B=F.next()).done);M=!0){var U=B.value,q=i(U,2),W=q[0],x=q[1],z={ssrc:W};x&&(z.rtx={ssrc:x}),I&&(z.profile=D.shift()),e.encodings.push(z)}}catch(e){N=!0,L=e}finally{try{!M&&F.return&&F.return()}finally{if(N)throw L}}}function o(e,t){var r=t.kind,n=(e.media||[]).find(function(e){return e.type===r});if(!n)throw new Error("m="+r+" section not found");var o=void 0,i=void 0,a=void 0;if(!(n.ssrcs||[]).find(function(e){return"msid"===e.attribute&&(e.value.split(" ")[1]===t.id?(o=e.id,a=e.value.split(" ")[0],!0):void 0)}))throw new Error("a=ssrc line not found for local track [track.id:"+t.id+"]");(n.ssrcGroups||[]).some(function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===o?(i=Number(t[1]),!0):void 0}});var s=n.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===o});if(!s)throw new Error("CNAME line not found for local track [track.id:"+t.id+"]");var c=s.value,u=o+1,d=o+2;if(n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.push({semantics:"SIM",ssrcs:o+" "+u+" "+d}),n.ssrcs.push({id:u,attribute:"cname",value:c}),n.ssrcs.push({id:u,attribute:"msid",value:a+" "+t.id}),n.ssrcs.push({id:d,attribute:"cname",value:c}),n.ssrcs.push({id:d,attribute:"msid",value:a+" "+t.id}),i){var l=i+1,p=i+2;n.ssrcGroups.push({semantics:"FID",ssrcs:u+" "+l}),n.ssrcs.push({id:l,attribute:"cname",value:c}),n.ssrcs.push({id:l,attribute:"msid",value:a+" "+t.id}),n.ssrcGroups.push({semantics:"FID",ssrcs:d+" "+p}),n.ssrcs.push({id:p,attribute:"cname",value:c}),n.ssrcs.push({id:p,attribute:"msid",value:a+" "+t.id})}}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();r.fillRtpParametersForTrack=n,r.addSimulcastForTrack=o},{}],186:[function(e,t,r){"use strict";function n(e,t,r){var n=r.kind,o={cname:null,reducedSize:!0,mux:!0},i=(t.media||[]).find(function(e){if(e.type===n){var t=e.msid;if(t){return t.split(" ")[1]===r.id||void 0}}});if(!i)throw new Error("m="+n+" section not found");var a=(i.ssrcs||[]).find(function(e){return"cname"===e.attribute}),s=void 0;a&&(s=a.id,o.cname=a.value);var c=[],u=!0,d=!1,l=void 0;try{for(var p,f=(i.rids||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value;"send"===h.direction&&(/^low/.test(h.id)?c.push({rid:h.id,profile:"low"}):/^medium/.test(h.id)&&c.push({rid:h.id,profile:"medium"}),/^high/.test(h.id)&&c.push({rid:h.id,profile:"high"}))}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}if(e.rtcp=o,e.encodings=[],0===c.length){var m={ssrc:s};e.encodings.push(m)}else{var v=!0,y=!1,_=void 0;try{for(var g,b=c[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value,k={encodingId:w.rid,profile:w.profile};e.encodings.push(k)}}catch(e){y=!0,_=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw _}}}}Object.defineProperty(r,"__esModule",{value:!0}),r.fillRtpParametersForTrack=n},{}],187:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(){return d.default.isSupported()}function i(){return{flag:d.default.getFlag(),name:d.default.getName(),version:d.default.getVersion(),bowser:d.default.getBowser()}}function a(e){return d.default.isSupported()?d.default.Handler.getNativeRtpCapabilities().then(function(t){var r=c.getExtendedRtpCapabilities(t,e);return{audio:c.canSend("audio",r),video:c.canSend("video",r)}}):Promise.reject(new Error("current browser/device not supported"))}Object.defineProperty(r,"__esModule",{value:!0}),r.Room=void 0,r.isDeviceSupported=o,r.getDeviceInfo=i,r.checkCapabilitiesForRoom=a;var s=e("./ortc"),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(s),u=e("./Device"),d=n(u),l=e("./Room"),p=n(l);r.Room=p.default},{"./Device":166,"./Room":171,"./ortc":188}],188:[function(e,t,r){"use strict";function n(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=!0,o=!1,i=void 0;try{for(var a,s=(t.codecs||[])[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;(function(t){if("rtx"===t.name)return"continue";var n=(e.codecs||[]).find(function(e){return d(e,t)});if(n){var o={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:n.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:p(n,t),parameters:t.parameters};o.channels||delete o.channels,r.codecs.push(o)}})(c)}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}var u=!0,f=!1,h=void 0;try{for(var m,v=(r.codecs||[])[Symbol.iterator]();!(u=(m=v.next()).done);u=!0){var y=m.value;!function(r){var n=(e.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.sendPayloadType}),o=(t.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.recvPayloadType});n&&o&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=o.preferredPayloadType)}(y)}}catch(e){f=!0,h=e}finally{try{!u&&v.return&&v.return()}finally{if(f)throw h}}var _=!0,g=!1,b=void 0;try{for(var w,k=(t.headerExtensions||[])[Symbol.iterator]();!(_=(w=k.next()).done);_=!0){var P=w.value;!function(t){var n=(e.headerExtensions||[]).find(function(e){return l(e,t)});if(n){var o={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(o)}}(P)}}catch(e){g=!0,b=e}finally{try{!_&&k.return&&k.return()}finally{if(g)throw b}}return r}function o(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,o=void 0;try{for(var i,a=e.codecs[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value,c={name:s.name,mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvPayloadType,channels:s.channels,rtcpFeedback:s.rtcpFeedback,parameters:s.parameters};if(c.channels||delete c.channels,t.codecs.push(c),s.recvRtxPayloadType){var u={name:"rtx",mimeType:s.kind+"/rtx",kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvRtxPayloadType,parameters:{apt:s.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}var d=!0,l=!1,p=void 0;try{for(var f,h=e.headerExtensions[Symbol.iterator]();!(d=(f=h.next()).done);d=!0){var m=f.value,v={kind:m.kind,uri:m.uri,preferredId:m.recvId};t.headerExtensions.push(v)}}catch(e){l=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(l)throw p}}return t.fecMechanisms=e.fecMechanisms,t}function i(e,t,r){if(!Array.isArray(t))return[];var n=[],o=e.codecs,i=r.codecs,a=!0,s=!1,c=void 0;try{for(var u,d=t[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var l=u.value;!function(e){if(!i.some(function(t){return t.recvPayloadType===e})){var t=o.find(function(t){return t.preferredPayloadType===e});if(!t)throw new Error("mandatory codec PT "+e+" not found in remote codecs");n.push(t)}}(l)}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}return n}function a(e,t){return t.codecs.some(function(t){return t.kind===e})}function s(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some(function(e){return e.recvPayloadType===r.payloadType})}function c(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,i=void 0;try{for(var a,s=t.codecs[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.sendPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.sendRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.sendRtxPayloadType,parameters:{apt:c.sendPayloadType}};r.codecs.push(d)}break}}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}var l=!0,p=!1,f=void 0;try{for(var h,m=t.headerExtensions[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var v=h.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.sendId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{!l&&m.return&&m.return()}finally{if(p)throw f}}return r}function u(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,i=void 0;try{for(var a,s=t.codecs[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.recvRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};r.codecs.push(d)}}}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}var l=!0,p=!1,f=void 0;try{for(var h,m=t.headerExtensions[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var v=h.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.recvId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{!l&&m.return&&m.return()}finally{if(p)throw f}}return r}function d(e,t){var r=e.mimeType.toLowerCase();if(r!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if("video/h264"===r){if(((e.parameters||{})["packetization-mode"]||0)!==((t.parameters||{})["packetization-mode"]||0))return!1}return!0}function l(e,t){return(!e.kind||!t.kind||e.kind===t.kind)&&e.uri===t.uri}function p(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=(e.rtcpFeedback||[])[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;!function(e){var n=(t.rtcpFeedback||[]).find(function(t){return t.type===e.type&&t.parameter===e.parameter});n&&r.push(n)}(c)}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}Object.defineProperty(r,"__esModule",{value:!0}),r.getExtendedRtpCapabilities=n,r.getRtpCapabilities=o,r.getUnsupportedCodecs=i,r.canSend=a,r.canReceive=s,r.getSendingRtpParameters=c,r.getReceivingFullRtpParameters=u},{}],189:[function(e,t,r){"use strict";function n(){return s()}function o(e){return JSON.parse(JSON.stringify(e))}Object.defineProperty(r,"__esModule",{value:!0}),r.randomNumber=n,r.clone=o;var i=e("random-number"),a=function(e){return e&&e.__esModule?e:{default:e}}(i),s=a.default.generator({min:1e7,max:99999999,integer:!0})},{"random-number":194}],190:[function(e,t,r){function n(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*l;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*u;case"minutes":case"minute":case"mins":case"min":case"m":return r*c;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function o(e){return e>=d?Math.round(e/d)+"d":e>=u?Math.round(e/u)+"h":e>=c?Math.round(e/c)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function i(e){return a(e,d,"day")||a(e,u,"hour")||a(e,c,"minute")||a(e,s,"second")||e+" ms"}function a(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var s=1e3,c=60*s,u=60*c,d=24*u,l=365.25*d;t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return n(e);if("number"===r&&!1===isNaN(e))return t.long?i(e):o(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],
191:[function(e,t,r){r.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},r.decode=function(e){for(var t={},r=e.split("&"),n=0,o=r.length;n<o;n++){var i=r[n].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},{}],192:[function(e,t,r){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){var t=e,r=e.indexOf("["),i=e.indexOf("]");-1!=r&&-1!=i&&(e=e.substring(0,r)+e.substring(r,i).replace(/:/g,";")+e.substring(i,e.length));for(var a=n.exec(e||""),s={},c=14;c--;)s[o[c]]=a[c]||"";return-1!=r&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},{}],193:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function a(e){if(p===clearTimeout)return clearTimeout(e);if((p===o||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function s(){v&&h&&(v=!1,h.length?m=h.concat(m):y=-1,m.length&&c())}function c(){if(!v){var e=i(s);v=!0;for(var t=m.length;t;){for(h=m,m=[];++y<t;)h&&h[y].run();y=-1,t=m.length}h=null,v=!1,a(e)}}function u(e,t){this.fun=e,this.array=t}function d(){}var l,p,f=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{p="function"==typeof clearTimeout?clearTimeout:o}catch(e){p=o}}();var h,m=[],v=!1,y=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];m.push(new u(e,t)),1!==m.length||v||i(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=d,f.addListener=d,f.once=d,f.off=d,f.removeListener=d,f.removeAllListeners=d,f.emit=d,f.prependListener=d,f.prependOnceListener=d,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],194:[function(e,t,r){!function(e){function r(e){var e=e||{},t=e.min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error("invalid options, max must be >= min");return{min:t,max:r,integer:n}}function n(e){if(e=r(e),e.max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}function o(e){return e=r(e),function(t,r,o){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=o?o:e.integer,n(e)}}t.exports=n,t.exports.generator=o,t.exports.defaults=r}()},{}],195:[function(e,t,r){"use strict";function n(e){return e||(e={}),{length:e.length||8,numeric:"boolean"!=typeof e.numeric||e.numeric,letters:"boolean"!=typeof e.letters||e.letters,special:"boolean"==typeof e.special&&e.special,exclude:Array.isArray(e.exclude)?e.exclude:[]}}function o(e){var t="";e.numeric&&(t+=i),e.letters&&(t+=a),e.special&&(t+=s);for(var r=0;r<=e.exclude.length;r++)t=t.replace(e.exclude[r],"");return t}var i="0123456789",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",s="!$%^&*()_+|~-=`{}[]:;<>?,./";t.exports=function(e){e=n(e);var t,r,i="",a=e.length,s=(e.exclude,o(e));for(t=1;t<=a;t++)i+=s.substring(r=Math.floor(Math.random()*s.length),r+1);return i}},{}],196:[function(t,r,n){(function(t){!function(t,o){"object"==typeof n&&void 0!==r?o(n):"function"==typeof e&&e.amd?e(["exports"],o):o(t.reduxLogger=t.reduxLogger||{})}(this,function(e){"use strict";function r(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function n(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function o(e,t,r){o.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:r,enumerable:!0})}function i(e,t){i.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function a(e,t){a.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function s(e,t,r){s.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:r,enumerable:!0})}function c(e,t,r){var n=e.slice((r||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,n),e}function u(e){var t=void 0===e?"undefined":O(e);return"object"!==t?t:e===Math?"math":null===e?"null":Array.isArray(e)?"array":"[object Date]"===Object.prototype.toString.call(e)?"date":"function"==typeof e.toString&&/^\/.*\//.test(e.toString())?"regexp":"object"}function d(e,t,r,n,l,p,f){l=l||[],f=f||[];var h=l.slice(0);if(void 0!==p){if(n){if("function"==typeof n&&n(h,p))return;if("object"===(void 0===n?"undefined":O(n))){if(n.prefilter&&n.prefilter(h,p))return;if(n.normalize){var m=n.normalize(h,p,e,t);m&&(e=m[0],t=m[1])}}}h.push(p)}"regexp"===u(e)&&"regexp"===u(t)&&(e=e.toString(),t=t.toString());var v=void 0===e?"undefined":O(e),y=void 0===t?"undefined":O(t),_="undefined"!==v||f&&f[f.length-1].lhs&&f[f.length-1].lhs.hasOwnProperty(p),g="undefined"!==y||f&&f[f.length-1].rhs&&f[f.length-1].rhs.hasOwnProperty(p);if(!_&&g)r(new i(h,t));else if(!g&&_)r(new a(h,e));else if(u(e)!==u(t))r(new o(h,e,t));else if("date"===u(e)&&e-t!=0)r(new o(h,e,t));else if("object"===v&&null!==e&&null!==t)if(f.filter(function(t){return t.lhs===e}).length)e!==t&&r(new o(h,e,t));else{if(f.push({lhs:e,rhs:t}),Array.isArray(e)){var b;for(e.length,b=0;b<e.length;b++)b>=t.length?r(new s(h,b,new a(void 0,e[b]))):d(e[b],t[b],r,n,h,b,f);for(;b<t.length;)r(new s(h,b,new i(void 0,t[b++])))}else{var w=Object.keys(e),k=Object.keys(t);w.forEach(function(o,i){var a=k.indexOf(o);a>=0?(d(e[o],t[o],r,n,h,o,f),k=c(k,a)):d(e[o],void 0,r,n,h,o,f)}),k.forEach(function(e){d(void 0,t[e],r,n,h,e,f)})}f.length=f.length-1}else e!==t&&("number"===v&&isNaN(e)&&isNaN(t)||r(new o(h,e,t)))}function l(e,t,r,n){return n=n||[],d(e,t,function(e){e&&n.push(e)},r),n.length?n:void 0}function p(e,t,r){if(r.path&&r.path.length){var n,o=e[t],i=r.path.length-1;for(n=0;n<i;n++)o=o[r.path[n]];switch(r.kind){case"A":p(o[r.path[n]],r.index,r.item);break;case"D":delete o[r.path[n]];break;case"E":case"N":o[r.path[n]]=r.rhs}}else switch(r.kind){case"A":p(e[t],r.index,r.item);break;case"D":e=c(e,t);break;case"E":case"N":e[t]=r.rhs}return e}function f(e,t,r){if(e&&t&&r&&r.kind){for(var n=e,o=-1,i=r.path?r.path.length-1:0;++o<i;)void 0===n[r.path[o]]&&(n[r.path[o]]="number"==typeof r.path[o]?[]:{}),n=n[r.path[o]];switch(r.kind){case"A":p(r.path?n[r.path[o]]:n,r.index,r.item);break;case"D":delete n[r.path[o]];break;case"E":case"N":n[r.path[o]]=r.rhs}}}function h(e,t,r){if(r.path&&r.path.length){var n,o=e[t],i=r.path.length-1;for(n=0;n<i;n++)o=o[r.path[n]];switch(r.kind){case"A":h(o[r.path[n]],r.index,r.item);break;case"D":case"E":o[r.path[n]]=r.lhs;break;case"N":delete o[r.path[n]]}}else switch(r.kind){case"A":h(e[t],r.index,r.item);break;case"D":case"E":e[t]=r.lhs;break;case"N":e=c(e,t)}return e}function m(e,t,r){if(e&&t&&r&&r.kind){var n,o,i=e;for(o=r.path.length-1,n=0;n<o;n++)void 0===i[r.path[n]]&&(i[r.path[n]]={}),i=i[r.path[n]];switch(r.kind){case"A":h(i[r.path[n]],r.index,r.item);break;case"D":case"E":i[r.path[n]]=r.lhs;break;case"N":delete i[r.path[n]]}}}function v(e,t,r){if(e&&t){d(e,t,function(n){r&&!r(e,t,n)||f(e,t,n)})}}function y(e){return"color: "+I[e].color+"; font-weight: bold"}function _(e){var t=e.kind,r=e.path,n=e.lhs,o=e.rhs,i=e.index,a=e.item;switch(t){case"E":return[r.join("."),n,"",o];case"N":return[r.join("."),o];case"D":return[r.join(".")];case"A":return[r.join(".")+"["+i+"]",a];default:return[]}}function g(e,t,r,n){var o=l(e,t);try{n?r.groupCollapsed("diff"):r.group("diff")}catch(e){r.log("diff")}o?o.forEach(function(e){var t=e.kind,n=_(e);r.log.apply(r,["%c "+I[t].text,y(t)].concat(j(n)))}):r.log(" no diff ");try{r.groupEnd()}catch(e){r.log(" diff end  ")}}function b(e,t,r,n){switch(void 0===e?"undefined":O(e)){case"object":return"function"==typeof e[n]?e[n].apply(e,j(r)):e[n];case"function":return e(t);default:return e}}function w(e){var t=e.timestamp,r=e.duration;return function(e,n,o){var i=["action"];return i.push("%c"+String(e.type)),t&&i.push("%c@ "+n),r&&i.push("%c(in "+o.toFixed(2)+" ms)"),i.join(" ")}}function k(e,t){var r=t.logger,n=t.actionTransformer,o=t.titleFormatter,i=void 0===o?w(t):o,a=t.collapsed,s=t.colors,c=t.level,u=t.diff,d=void 0===t.titleFormatter;e.forEach(function(o,l){var p=o.started,f=o.startedTime,h=o.action,m=o.prevState,v=o.error,y=o.took,_=o.nextState,w=e[l+1];w&&(_=w.prevState,y=w.started-p);var k=n(h),P="function"==typeof a?a(function(){return _},h,o):a,S=R(f),E=s.title?"color: "+s.title(k)+";":"",x=["color: gray; font-weight: lighter;"];x.push(E),t.timestamp&&x.push("color: gray; font-weight: lighter;"),t.duration&&x.push("color: gray; font-weight: lighter;");var T=i(k,S,y);try{P?s.title&&d?r.groupCollapsed.apply(r,["%c "+T].concat(x)):r.groupCollapsed(T):s.title&&d?r.group.apply(r,["%c "+T].concat(x)):r.group(T)}catch(e){r.log(T)}var C=b(c,k,[m],"prevState"),O=b(c,k,[k],"action"),j=b(c,k,[v,m],"error"),A=b(c,k,[_],"nextState");if(C)if(s.prevState){var I="color: "+s.prevState(m)+"; font-weight: bold";r[C]("%c prev state",I,m)}else r[C]("prev state",m);if(O)if(s.action){var D="color: "+s.action(k)+"; font-weight: bold";r[O]("%c action    ",D,k)}else r[O]("action    ",k);if(v&&j)if(s.error){var M="color: "+s.error(v,m)+"; font-weight: bold;";r[j]("%c error     ",M,v)}else r[j]("error     ",v);if(A)if(s.nextState){var N="color: "+s.nextState(_)+"; font-weight: bold";r[A]("%c next state",N,_)}else r[A]("next state",_);u&&g(m,_,r,P);try{r.groupEnd()}catch(e){r.log(" log end ")}})}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},D,e),r=t.logger,n=t.stateTransformer,o=t.errorTransformer,i=t.predicate,a=t.logErrors,s=t.diffPredicate;if(void 0===r)return function(){return function(e){return function(t){return e(t)}}};if(e.getState&&e.dispatch)return console.error("[redux-logger] redux-logger not installed. Make sure to pass logger instance as middleware:\n// Logger with default options\nimport { logger } from 'redux-logger'\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n// Or you can create your own logger with custom options http://bit.ly/redux-logger-options\nimport createLogger from 'redux-logger'\nconst logger = createLogger({\n  // ...options\n});\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n"),function(){return function(e){return function(t){return e(t)}}};var c=[];return function(e){var r=e.getState;return function(e){return function(u){if("function"==typeof i&&!i(r,u))return e(u);var d={};c.push(d),d.started=C.now(),d.startedTime=new Date,d.prevState=n(r()),d.action=u;var l=void 0;if(a)try{l=e(u)}catch(e){d.error=o(e)}else l=e(u);d.took=C.now()-d.started,d.nextState=n(r());var p=t.diff&&"function"==typeof s?s(r,u):t.diff;if(k(c,Object.assign({},t,{diff:p})),c.length=0,d.error)throw d.error;return l}}}}var S,E,x=function(e,t){return new Array(t+1).join(e)},T=function(e,t){return x("0",t-e.toString().length)+e},R=function(e){return T(e.getHours(),2)+":"+T(e.getMinutes(),2)+":"+T(e.getSeconds(),2)+"."+T(e.getMilliseconds(),3)},C="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance:Date,O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},A=[];S="object"===(void 0===t?"undefined":O(t))&&t?t:"undefined"!=typeof window?window:{},E=S.DeepDiff,E&&A.push(function(){void 0!==E&&S.DeepDiff===l&&(S.DeepDiff=E,E=void 0)}),r(o,n),r(i,n),r(a,n),r(s,n),Object.defineProperties(l,{diff:{value:l,enumerable:!0},observableDiff:{value:d,enumerable:!0},applyDiff:{value:v,enumerable:!0},applyChange:{value:f,enumerable:!0},revertChange:{value:m,enumerable:!0},isConflict:{value:function(){return void 0!==E},enumerable:!0},noConflict:{value:function(){return A&&(A.forEach(function(e){e()}),A=null),l},enumerable:!0}});var I={E:{color:"#2196F3",text:"CHANGED:"},N:{color:"#4CAF50",text:"ADDED:"},D:{color:"#F44336",text:"DELETED:"},A:{color:"#2196F3",text:"ARRAY:"}},D={level:"log",logger:console,logErrors:!0,collapsed:void 0,predicate:void 0,duration:!1,timestamp:!0,stateTransformer:function(e){return e},actionTransformer:function(e){return e},errorTransformer:function(e){return e},colors:{title:function(){return"inherit"},prevState:function(){return"#9E9E9E"},action:function(){return"#03A9F4"},nextState:function(){return"#4CAF50"},error:function(){return"#F20404"}},diff:!1,diffPredicate:void 0,transformer:void 0},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dispatch,r=e.getState;return"function"==typeof t||"function"==typeof r?P()({dispatch:t,getState:r}):void console.error("\n[redux-logger v3] BREAKING CHANGE\n[redux-logger v3] Since 3.0.0 redux-logger exports by default logger with default settings.\n[redux-logger v3] Change\n[redux-logger v3] import createLogger from 'redux-logger'\n[redux-logger v3] to\n[redux-logger v3] import { createLogger } from 'redux-logger'\n")};e.defaults=D,e.createLogger=P,e.logger=M,e.default=M,Object.defineProperty(e,"__esModule",{value:!0})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],197:[function(e,t,r){"use strict";function n(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(o){return"function"==typeof o?o(r,n,e):t(o)}}}}r.__esModule=!0;var o=n();o.withExtraArgument=n,r.default=o},{}],198:[function(e,t,r){"use strict";function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(r,n,i){var s=e(r,n,i),c=s.dispatch,u=[],d={getState:s.getState,dispatch:function(e){return c(e)}};return u=t.map(function(e){return e(d)}),c=a.default.apply(void 0,u)(s.dispatch),o({},s,{dispatch:c})}}}r.__esModule=!0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};r.default=n;var i=e("./compose"),a=function(e){return e&&e.__esModule?e:{default:e}}(i)},{"./compose":201}],199:[function(e,t,r){"use strict";function n(e,t){return function(){return t(e.apply(void 0,arguments))}}function o(e,t){if("function"==typeof e)return n(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),o={},i=0;i<r.length;i++){var a=r[i],s=e[a];"function"==typeof s&&(o[a]=n(s,t))}return o}r.__esModule=!0,r.default=o},{}],200:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var r=t&&t.type;return"Given action "+(r&&'"'+r.toString()+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function i(e){Object.keys(e).forEach(function(t){var r=e[t];if(void 0===r(void 0,{type:s.ActionTypes.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+s.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}function a(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var a=t[n];"function"==typeof e[a]&&(r[a]=e[a])}var s=Object.keys(r),c=void 0;try{i(r)}catch(e){c=e}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];if(c)throw c;for(var n=!1,i={},a=0;a<s.length;a++){var u=s[a],d=r[u],l=e[u],p=d(l,t);if(void 0===p){var f=o(u,t);throw new Error(f)}i[u]=p,n=n||p!==l}return n?i:e}}r.__esModule=!0,r.default=a;var s=e("./createStore"),c=e("lodash/isPlainObject"),u=(n(c),e("./utils/warning"));n(u)},{"./createStore":202,"./utils/warning":204,"lodash/isPlainObject":163}],201:[function(e,t,r){"use strict";function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}r.__esModule=!0,r.default=n},{}],202:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r){function n(){y===v&&(y=v.slice())}function i(){return m}function s(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");var t=!0;return n(),y.push(e),function(){if(t){t=!1,n();var r=y.indexOf(e);y.splice(r,1)}}}function d(e){if(!(0,a.default)(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(_)throw new Error("Reducers may not dispatch actions.");try{_=!0,m=h(m,e)}finally{_=!1}for(var t=v=y,r=0;r<t.length;r++){(0,t[r])()}return e}function l(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");h=e,d({type:u.INIT})}function p(){var e,t=s;return e={subscribe:function(e){function r(){e.next&&e.next(i())}if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");return r(),{unsubscribe:t(r)}}},e[c.default]=function(){return this},e}var f;if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(o)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var h=e,m=t,v=[],y=v,_=!1;return d({type:u.INIT}),f={dispatch:d,subscribe:s,getState:i,replaceReducer:l},f[c.default]=p,f}r.__esModule=!0,r.ActionTypes=void 0,r.default=o;var i=e("lodash/isPlainObject"),a=n(i),s=e("symbol-observable"),c=n(s),u=r.ActionTypes={INIT:"@@redux/INIT"}},{"lodash/isPlainObject":163,"symbol-observable":218}],203:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}r.__esModule=!0,r.compose=r.applyMiddleware=r.bindActionCreators=r.combineReducers=r.createStore=void 0;var o=e("./createStore"),i=n(o),a=e("./combineReducers"),s=n(a),c=e("./bindActionCreators"),u=n(c),d=e("./applyMiddleware"),l=n(d),p=e("./compose"),f=n(p),h=e("./utils/warning");n(h);r.createStore=i.default,r.combineReducers=s.default,r.bindActionCreators=u.default,r.applyMiddleware=l.default,r.compose=f.default},{"./applyMiddleware":198,"./bindActionCreators":199,"./combineReducers":200,"./compose":201,"./createStore":202,"./utils/warning":204}],204:[function(e,t,r){"use strict";function n(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}r.__esModule=!0,r.default=n},{}],205:[function(e,t,r){var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],206:[function(e,t,r){var n=e("./parser"),o=e("./writer");r.write=o,r.parse=n.parse,r.parseFmtpConfig=n.parseFmtpConfig,r.parseParams=n.parseParams,r.parsePayloads=n.parsePayloads,r.parseRemoteCandidates=n.parseRemoteCandidates,r.parseImageAttributes=n.parseImageAttributes,r.parseSimulcastStreamList=n.parseSimulcastStreamList},{"./parser":207,"./writer":208}],207:[function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=n(e[i+1]))},i=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:n?t[e.name]:t;o(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},a=e("./grammar"),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(o))return i(c,n,o)}}),t.media=r,t};var c=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length&&(e[r[0]]=n(r[1])),e};r.parseParams=function(e){return e.split(/\;\s?/).reduce(c,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})})},r.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},{"./grammar":205}],208:[function(e,t,r){var n=e("./grammar"),o=/%[sdv%]/g,i=function(e){var t=1,r=arguments,n=r.length;return e.replace(o,function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})},a=function(e,t,r){var n=t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format,o=[e+"="+n];if(t.names)for(var a=0;a<t.names.length;a+=1){var s=t.names[a];t.name?o.push(r[t.name][s]):o.push(r[t.names[a]])}else o.push(r[t.name]);return i.apply(null,o)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||s,o=t.innerOrder||c,i=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?i.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){i.push(a(t,r,e))})})}),e.media.forEach(function(e){i.push(a("m",n.m[0],e)),o.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?i.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){i.push(a(t,r,e))})})})}),i.join("\r\n")+"\r\n"}},{"./grammar":205}],209:[function(e,t,r){function n(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,n=o(e),i=n.source,u=n.id,d=n.path,l=c[u]&&d in c[u].nsps,p=t.forceNew||t["force new connection"]||!1===t.multiplex||l;return p?(s("ignoring socket cache for %s",i),r=a(i,t)):(c[u]||(s("new io instance for %s",i),c[u]=a(i,t)),r=c[u]),n.query&&!t.query&&(t.query=n.query),r.socket(n.path,t)}var o=e("./url"),i=e("socket.io-parser"),a=e("./manager"),s=e("debug")("socket.io-client");t.exports=r=n;var c=r.managers={};r.protocol=i.protocol,r.connect=n,r.Manager=e("./manager"),r.Socket=e("./socket")},{"./manager":210,"./socket":212,"./url":213,debug:135,"socket.io-parser":215}],210:[function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);e&&"object"==typeof e&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||s;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var o=e("engine.io-client"),i=e("./socket"),a=e("component-emitter"),s=e("socket.io-parser"),c=e("./on"),u=e("component-bind"),d=e("debug")("socket.io-client:manager"),l=e("indexof"),p=e("backo2"),f=Object.prototype.hasOwnProperty;t.exports=n,n.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},n.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},n.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},a(n.prototype),n.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},n.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},n.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},n.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},
n.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},n.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},n.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},n.prototype.open=n.prototype.connect=function(e,t){if(d("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;d("opening %s",this.uri),this.engine=o(this.uri,this.opts);var r=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=c(r,"open",function(){n.onopen(),e&&e()}),a=c(r,"error",function(t){if(d("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;d("connect attempt will timeout after %d",s);var u=setTimeout(function(){d("connect attempt timed out after %d",s),i.destroy(),r.close(),r.emit("error","timeout"),n.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(i),this.subs.push(a),this},n.prototype.onopen=function(){d("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",u(this,"ondata"))),this.subs.push(c(e,"ping",u(this,"onping"))),this.subs.push(c(e,"pong",u(this,"onpong"))),this.subs.push(c(e,"error",u(this,"onerror"))),this.subs.push(c(e,"close",u(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",u(this,"ondecoded")))},n.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},n.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},n.prototype.ondata=function(e){this.decoder.add(e)},n.prototype.ondecoded=function(e){this.emit("packet",e)},n.prototype.onerror=function(e){d("error",e),this.emitAll("error",e)},n.prototype.socket=function(e,t){function r(){~l(o.connecting,n)||o.connecting.push(n)}var n=this.nsps[e];if(!n){n=new i(this,e,t),this.nsps[e]=n;var o=this;n.on("connecting",r),n.on("connect",function(){n.id=o.generateId(e)}),this.autoConnect&&r()}return n},n.prototype.destroy=function(e){var t=l(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},n.prototype.packet=function(e){d("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()}))},n.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},n.prototype.cleanup=function(){d("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},n.prototype.close=n.prototype.disconnect=function(){d("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},n.prototype.onclose=function(e){d("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},n.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)d("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();d("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){e.skipReconnect||(d("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(d("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(d("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},n.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":211,"./socket":212,backo2:29,"component-bind":34,"component-emitter":35,debug:135,"engine.io-client":137,indexof:153,"socket.io-parser":215}],211:[function(e,t,r){function n(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}t.exports=n},{}],212:[function(e,t,r){function n(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}var o=e("socket.io-parser"),i=e("component-emitter"),a=e("to-array"),s=e("./on"),c=e("component-bind"),u=e("debug")("socket.io-client:socket"),d=e("parseqs"),l=e("has-binary2");t.exports=n;var p={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=i.prototype.emit;i(n.prototype),n.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",c(this,"onopen")),s(e,"packet",c(this,"onpacket")),s(e,"close",c(this,"onclose"))]}},n.prototype.open=n.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},n.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},n.prototype.emit=function(e){if(p.hasOwnProperty(e))return f.apply(this,arguments),this;var t=a(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:l(t))?o.BINARY_EVENT:o.EVENT,data:t};return r.options={},r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},n.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},n.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?d.encode(this.query):this.query;u("sending connect packet with query %s",e),this.packet({type:o.CONNECT,query:e})}else this.packet({type:o.CONNECT})},n.prototype.onclose=function(e){u("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},n.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},n.prototype.onevent=function(e){var t=e.data||[];u("emitting event %j",t),null!=e.id&&(u("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?f.apply(this,t):this.receiveBuffer.push(t)},n.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var n=a(arguments);u("sending ack %j",n),t.packet({type:l(n)?o.BINARY_ACK:o.ACK,id:e,data:n})}}},n.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(u("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):u("bad ack %s",e.id)},n.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},n.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)f.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},n.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},n.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},n.prototype.close=n.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},n.prototype.compress=function(e){return this.flags.compress=e,this},n.prototype.binary=function(e){return this.flags.binary=e,this}},{"./on":211,"component-bind":34,"component-emitter":35,debug:135,"has-binary2":150,parseqs:191,"socket.io-parser":215,"to-array":221}],213:[function(e,t,r){(function(r){function n(e,t){var n=e;t=t||r.location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),n=o(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var a=-1!==n.host.indexOf(":"),s=a?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}var o=e("parseuri"),i=e("debug")("socket.io-client:url");t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:135,parseuri:192}],214:[function(e,t,r){(function(t){function n(e,t){if(!e)return e;if(a(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}if(i(e)){for(var o=new Array(e.length),s=0;s<e.length;s++)o[s]=n(e[s],t);return o}if("object"==typeof e&&!(e instanceof Date)){var o={};for(var c in e)o[c]=n(e[c],t);return o}return e}function o(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(i(e))for(var r=0;r<e.length;r++)e[r]=o(e[r],t);else if("object"==typeof e)for(var n in e)e[n]=o(e[n],t);return e}var i=e("isarray"),a=e("./is-buffer"),s=Object.prototype.toString,c="function"==typeof t.Blob||"[object BlobConstructor]"===s.call(t.Blob),u="function"==typeof t.File||"[object FileConstructor]"===s.call(t.File);r.deconstructPacket=function(e){var t=[],r=e.data,o=e;return o.data=n(r,t),o.attachments=t.length,{packet:o,buffers:t}},r.reconstructPacket=function(e,t){return e.data=o(e.data,t),e.attachments=void 0,e},r.removeBlobs=function(e,t){function r(e,s,d){if(!e)return e;if(c&&e instanceof Blob||u&&e instanceof File){n++;var l=new FileReader;l.onload=function(){d?d[s]=this.result:o=this.result,--n||t(o)},l.readAsArrayBuffer(e)}else if(i(e))for(var p=0;p<e.length;p++)r(e[p],p,e);else if("object"==typeof e&&!a(e))for(var f in e)r(e[f],f,e)}var n=0,o=e;r(o),n||t(o)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./is-buffer":216,isarray:217}],215:[function(e,t,r){function n(){}function o(e){var t=""+e.type;if(r.BINARY_EVENT!==e.type&&r.BINARY_ACK!==e.type||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data){var n=i(e.data);if(!1===n)return y;t+=n}return p("encoded %j as %s",e,t),t}function i(e){try{return JSON.stringify(e)}catch(e){return!1}}function a(e,t){function r(e){var r=h.deconstructPacket(e),n=o(r.packet),i=r.buffers;i.unshift(n),t(i)}h.removeBlobs(e,r)}function s(){this.reconstructor=null}function c(e){var t=0,n={type:Number(e.charAt(0))};if(null==r.types[n.type])return l("unknown packet type "+n.type);if(r.BINARY_EVENT===n.type||r.BINARY_ACK===n.type){for(var o="";"-"!==e.charAt(++t)&&(o+=e.charAt(t),t!=e.length););if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"===e.charAt(t+1))for(n.nsp="";++t;){var i=e.charAt(t);if(","===i)break;if(n.nsp+=i,t===e.length)break}else n.nsp="/";var a=e.charAt(t+1);if(""!==a&&Number(a)==a){for(n.id="";++t;){var i=e.charAt(t);if(null==i||Number(i)!=i){--t;break}if(n.id+=e.charAt(t),t===e.length)break}n.id=Number(n.id)}if(e.charAt(++t)){var s=u(e.substr(t));if(!(!1!==s&&(n.type===r.ERROR||m(s))))return l("invalid payload");n.data=s}return p("decoded %s as %j",e,n),n}function u(e){try{return JSON.parse(e)}catch(e){return!1}}function d(e){this.reconPack=e,this.buffers=[]}function l(e){return{type:r.ERROR,data:"parser error: "+e}}var p=e("debug")("socket.io-parser"),f=e("component-emitter"),h=e("./binary"),m=e("isarray"),v=e("./is-buffer");r.protocol=4,r.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],r.CONNECT=0,r.DISCONNECT=1,r.EVENT=2,r.ACK=3,r.ERROR=4,r.BINARY_EVENT=5,r.BINARY_ACK=6,r.Encoder=n,r.Decoder=s;var y=r.ERROR+'"encode error"';n.prototype.encode=function(e,t){if(p("encoding packet %j",e),r.BINARY_EVENT===e.type||r.BINARY_ACK===e.type)a(e,t);else{t([o(e)])}},f(s.prototype),s.prototype.add=function(e){var t;if("string"==typeof e)t=c(e),r.BINARY_EVENT===t.type||r.BINARY_ACK===t.type?(this.reconstructor=new d(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!v(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=h.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":214,"./is-buffer":216,"component-emitter":35,debug:135,isarray:217}],216:[function(e,t,r){(function(e){function r(t){return n&&e.Buffer.isBuffer(t)||o&&(t instanceof e.ArrayBuffer||i(t))}t.exports=r;var n="function"==typeof e.Buffer&&"function"==typeof e.Buffer.isBuffer,o="function"==typeof e.ArrayBuffer,i=function(){return o&&"function"==typeof e.ArrayBuffer.isView?e.ArrayBuffer.isView:function(t){return t.buffer instanceof e.ArrayBuffer}}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],217:[function(e,t,r){arguments[4][151][0].apply(r,arguments)},{dup:151}],218:[function(e,t,r){t.exports=e("./lib/index")},{"./lib/index":219}],219:[function(e,t,r){(function(n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o,i=e("./ponyfill.js"),a=function(e){return e&&e.__esModule?e:{default:e}}(i);o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:void 0!==t?t:Function("return this")();var s=(0,a.default)(o);r.default=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ponyfill.js":220}],220:[function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}Object.defineProperty(r,"__esModule",{value:!0}),r.default=n},{}],221:[function(e,t,r){function n(e,t){var r=[];t=t||0;for(var n=t||0;n<e.length;n++)r[n-t]=e[n];return r}t.exports=n},{}],222:[function(e,t,r){function n(){}t.exports=n,n.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,r){this.callbacks=this.callbacks||{};var n=3===arguments.length,o=n?arguments[1]:void 0,i=n?arguments[2]:arguments[1];return i._groupName=o,(this.callbacks[e]=this.callbacks[e]||[]).push(i),this},t.once=function(e,t,r){function n(){o.off(e,n),s.apply(this,arguments)}var o=this,i=3===arguments.length,a=i?arguments[1]:void 0,s=i?arguments[2]:arguments[1];return this.on(e,a,n),this},t.releaseGroup=function(e){this.callbacks=this.callbacks||{};var t,r,n,o;for(t in this.callbacks)for(o=this.callbacks[t],r=0,n=o.length;r<n;r++)o[r]._groupName===e&&(o.splice(r,1),r--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(r=n.indexOf(t),n.splice(r,1),0===n.length&&delete this.callbacks[e],this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,r,n,o=[].slice.call(arguments,1),i=this.callbacks[e],a=this.getWildcardCallbacks(e);if(i)for(n=i.slice(),t=0,r=n.length;t<r&&n[t];++t)n[t].apply(this,o);if(a)for(r=a.length,n=a.slice(),t=0,r=n.length;t<r&&n[t];++t)n[t].apply(this,[e].concat(o));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,r,n=[];for(t in this.callbacks)r=t.split("*"),("*"===t||2===r.length&&e.slice(0,r[0].length)===r[0])&&(n=n.concat(this.callbacks[t]));return n}},n.mixin(n)},{}],223:[function(e,t,r){"use strict";function n(e){var t="";do{t=s[e%c]+t,e=Math.floor(e/c)}while(e>0);return t}function o(e){var t=0;for(l=0;l<e.length;l++)t=t*c+u[e.charAt(l)];return t}function i(){var e=n(+new Date);return e!==a?(d=0,a=e):e+"."+n(d++)}for(var a,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),c=64,u={},d=0,l=0;l<c;l++)u[s[l]]=l;i.encode=n,i.decode=o,t.exports=i},{}]},{},[3])(3)});